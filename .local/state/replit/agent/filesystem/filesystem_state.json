{"file_contents":{"server/storage.ts":{"content":"// Implementación de almacenamiento usando PostgreSQL con Drizzle ORM\n// Todos los métodos CRUD están en español para consistencia\nimport { \n  users, \n  tokensBalance, \n  tokenTransactions,\n  karmaHistory, \n  news, \n  proposals, \n  polls, \n  pollOptions, \n  votes, \n  debates,\n  comments, \n  contacts,\n  badges,\n  userBadges,\n  type User, \n  type InsertUser,\n  type TokensBalance,\n  type TokenTransaction,\n  type InsertTokenTransaction,\n  type News,\n  type InsertNews,\n  type Proposal,\n  type InsertProposal,\n  type Poll,\n  type InsertPoll,\n  type PollOption,\n  type InsertPollOption,\n  type Vote,\n  type Debate,\n  type InsertDebate,\n  type Comment,\n  type InsertComment,\n  type Contact,\n  type InsertContact,\n  type KarmaHistory,\n  type Badge,\n  type UserBadge,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, sql } from \"drizzle-orm\";\n\n// Interfaz de almacenamiento con todos los métodos CRUD necesarios\nexport interface IStorage {\n  // Usuarios\n  getAllUsers(): Promise<User[]>;\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUser(id: string, data: Partial<User>): Promise<User | undefined>;\n\n  // Tokens\n  getTokensBalance(userId: string): Promise<TokensBalance | undefined>;\n  createTokensBalance(userId: string): Promise<TokensBalance>;\n  updateTokensBalance(userId: string, data: Partial<TokensBalance>): Promise<TokensBalance | undefined>;\n  \n  // Transacciones de tokens\n  createTokenTransaction(transactionData: InsertTokenTransaction): Promise<TokenTransaction>;\n  getTokenTransactions(userId: string): Promise<TokenTransaction[]>;\n  getTransactionByHash(txHash: string): Promise<TokenTransaction | undefined>;\n\n  // Karma\n  addKarma(userId: string, cantidad: number, razon: string): Promise<void>;\n  getKarmaHistory(userId: string): Promise<KarmaHistory[]>;\n\n  // Noticias\n  getAllNews(): Promise<News[]>;\n  getNewsById(id: string): Promise<News | undefined>;\n  createNews(newsData: InsertNews): Promise<News>;\n  updateNews(id: string, data: Partial<News>): Promise<News | undefined>;\n  deleteNews(id: string): Promise<void>;\n\n  // Propuestas\n  getAllProposals(): Promise<Proposal[]>;\n  getProposalById(id: string): Promise<Proposal | undefined>;\n  createProposal(proposalData: InsertProposal): Promise<Proposal>;\n  updateProposal(id: string, data: Partial<Proposal>): Promise<Proposal | undefined>;\n  deleteProposal(id: string): Promise<void>;\n\n  // Sondeos\n  getAllPolls(): Promise<Poll[]>;\n  getPollById(id: string): Promise<Poll | undefined>;\n  createPoll(pollData: InsertPoll): Promise<Poll>;\n  updatePoll(id: string, data: Partial<Poll>): Promise<Poll | undefined>;\n  deletePoll(id: string): Promise<void>;\n  getPollOptions(pollId: string): Promise<PollOption[]>;\n  createPollOption(optionData: InsertPollOption): Promise<PollOption>;\n  vote(userId: string, pollId: string, optionId: string): Promise<void>;\n  hasUserVoted(userId: string, pollId: string): Promise<boolean>;\n\n  // Debates\n  getAllDebates(): Promise<Debate[]>;\n  getDebateById(id: string): Promise<Debate | undefined>;\n  createDebate(debateData: InsertDebate): Promise<Debate>;\n  updateDebate(id: string, data: Partial<Debate>): Promise<Debate | undefined>;\n  deleteDebate(id: string): Promise<void>;\n  incrementDebateViews(id: string): Promise<void>;\n\n  // Comentarios\n  getCommentsByProposal(propuestaId: string): Promise<Comment[]>;\n  getCommentsByNews(noticiaId: string): Promise<Comment[]>;\n  getCommentsByDebate(debateId: string): Promise<Comment[]>;\n  createComment(commentData: InsertComment): Promise<Comment>;\n  updateComment(id: string, data: Partial<Comment>): Promise<Comment | undefined>;\n  deleteComment(id: string): Promise<void>;\n\n  // Contacto\n  createContact(contactData: InsertContact): Promise<Contact>;\n  getAllContacts(): Promise<Contact[]>;\n\n  // Insignias\n  getUserBadges(userId: string): Promise<Badge[]>;\n}\n\n// Implementación con PostgreSQL usando Drizzle ORM\nexport class DatabaseStorage implements IStorage {\n  // === USUARIOS ===\n  async getAllUsers(): Promise<User[]> {\n    const allUsers = await db.select().from(users).orderBy(desc(users.createdAt));\n    return allUsers;\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user || undefined;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values({\n        ...insertUser,\n        karmaTotal: 0,\n        nivelGamificacion: 1,\n      })\n      .returning();\n    \n    // Crear balance de tokens inicial\n    await this.createTokensBalance(user.id);\n    \n    return user;\n  }\n\n  async updateUser(id: string, data: Partial<User>): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(users.id, id))\n      .returning();\n    return user || undefined;\n  }\n\n  // === TOKENS ===\n  async getTokensBalance(userId: string): Promise<TokensBalance | undefined> {\n    const [balance] = await db\n      .select()\n      .from(tokensBalance)\n      .where(eq(tokensBalance.userId, userId));\n    return balance || undefined;\n  }\n\n  async createTokensBalance(userId: string): Promise<TokensBalance> {\n    const [balance] = await db\n      .insert(tokensBalance)\n      .values({\n        userId,\n        tokensParticipacion: 0,\n        tokensApoyo: 0,\n        tokensGobernanza: 0,\n      })\n      .returning();\n    return balance;\n  }\n\n  async updateTokensBalance(userId: string, data: Partial<TokensBalance>): Promise<TokensBalance | undefined> {\n    const [balance] = await db\n      .update(tokensBalance)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(tokensBalance.userId, userId))\n      .returning();\n    return balance || undefined;\n  }\n\n  // === TRANSACCIONES DE TOKENS ===\n  async createTokenTransaction(transactionData: InsertTokenTransaction): Promise<TokenTransaction> {\n    const [transaction] = await db\n      .insert(tokenTransactions)\n      .values(transactionData)\n      .returning();\n    return transaction;\n  }\n\n  async getTokenTransactions(userId: string): Promise<TokenTransaction[]> {\n    const transactions = await db\n      .select()\n      .from(tokenTransactions)\n      .where(eq(tokenTransactions.userId, userId))\n      .orderBy(desc(tokenTransactions.createdAt));\n    return transactions;\n  }\n\n  async getTransactionByHash(txHash: string): Promise<TokenTransaction | undefined> {\n    const [transaction] = await db\n      .select()\n      .from(tokenTransactions)\n      .where(eq(tokenTransactions.relacionadoId, txHash));\n    return transaction || undefined;\n  }\n\n  // === KARMA ===\n  async addKarma(userId: string, cantidad: number, razon: string): Promise<void> {\n    // Añadir a historial\n    await db.insert(karmaHistory).values({\n      userId,\n      cantidad,\n      razon,\n    });\n\n    // Actualizar karma total del usuario\n    const user = await this.getUser(userId);\n    if (user) {\n      const nuevoKarma = user.karmaTotal + cantidad;\n      const nuevoNivel = Math.floor(nuevoKarma / 500) + 1;\n      await this.updateUser(userId, {\n        karmaTotal: nuevoKarma,\n        nivelGamificacion: nuevoNivel,\n      });\n    }\n  }\n\n  async getKarmaHistory(userId: string): Promise<KarmaHistory[]> {\n    return await db\n      .select()\n      .from(karmaHistory)\n      .where(eq(karmaHistory.userId, userId))\n      .orderBy(desc(karmaHistory.createdAt));\n  }\n\n  // === NOTICIAS ===\n  async getAllNews(): Promise<News[]> {\n    return await db\n      .select()\n      .from(news)\n      .orderBy(desc(news.createdAt));\n  }\n\n  async getNewsById(id: string): Promise<News | undefined> {\n    const [noticia] = await db\n      .select()\n      .from(news)\n      .where(eq(news.id, id));\n    return noticia || undefined;\n  }\n\n  async createNews(newsData: InsertNews): Promise<News> {\n    const [noticia] = await db\n      .insert(news)\n      .values(newsData)\n      .returning();\n    return noticia;\n  }\n\n  async updateNews(id: string, data: Partial<News>): Promise<News | undefined> {\n    const [noticia] = await db\n      .update(news)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(news.id, id))\n      .returning();\n    return noticia || undefined;\n  }\n\n  async deleteNews(id: string): Promise<void> {\n    await db.delete(news).where(eq(news.id, id));\n  }\n\n  // === PROPUESTAS ===\n  async getAllProposals(): Promise<Proposal[]> {\n    return await db\n      .select()\n      .from(proposals)\n      .orderBy(desc(proposals.createdAt));\n  }\n\n  async getProposalById(id: string): Promise<Proposal | undefined> {\n    const [propuesta] = await db\n      .select()\n      .from(proposals)\n      .where(eq(proposals.id, id));\n    return propuesta || undefined;\n  }\n\n  async createProposal(proposalData: InsertProposal): Promise<Proposal> {\n    const [propuesta] = await db\n      .insert(proposals)\n      .values({\n        ...proposalData,\n        apoyosTP: 0,\n        apoyosTA: 0,\n      })\n      .returning();\n    return propuesta;\n  }\n\n  async updateProposal(id: string, data: Partial<Proposal>): Promise<Proposal | undefined> {\n    const [propuesta] = await db\n      .update(proposals)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(proposals.id, id))\n      .returning();\n    return propuesta || undefined;\n  }\n\n  async deleteProposal(id: string): Promise<void> {\n    await db.delete(proposals).where(eq(proposals.id, id));\n  }\n\n  // === SONDEOS ===\n  async getAllPolls(): Promise<Poll[]> {\n    return await db\n      .select()\n      .from(polls)\n      .orderBy(desc(polls.createdAt));\n  }\n\n  async getPollById(id: string): Promise<Poll | undefined> {\n    const [poll] = await db\n      .select()\n      .from(polls)\n      .where(eq(polls.id, id));\n    return poll || undefined;\n  }\n\n  async createPoll(pollData: InsertPoll): Promise<Poll> {\n    const [poll] = await db\n      .insert(polls)\n      .values(pollData)\n      .returning();\n    return poll;\n  }\n\n  async updatePoll(id: string, data: Partial<Poll>): Promise<Poll | undefined> {\n    const [poll] = await db\n      .update(polls)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(polls.id, id))\n      .returning();\n    return poll || undefined;\n  }\n\n  async deletePoll(id: string): Promise<void> {\n    // Primero eliminar opciones y votos relacionados\n    await db.delete(votes).where(eq(votes.pollId, id));\n    await db.delete(pollOptions).where(eq(pollOptions.pollId, id));\n    // Luego eliminar el sondeo\n    await db.delete(polls).where(eq(polls.id, id));\n  }\n\n  async getPollOptions(pollId: string): Promise<PollOption[]> {\n    return await db\n      .select()\n      .from(pollOptions)\n      .where(eq(pollOptions.pollId, pollId))\n      .orderBy(pollOptions.orden);\n  }\n\n  async createPollOption(optionData: InsertPollOption): Promise<PollOption> {\n    const [option] = await db\n      .insert(pollOptions)\n      .values({\n        ...optionData,\n        votos: 0,\n      })\n      .returning();\n    return option;\n  }\n\n  async vote(userId: string, pollId: string, optionId: string): Promise<void> {\n    // Verificar si ya votó\n    const hasVoted = await this.hasUserVoted(userId, pollId);\n    if (hasVoted) {\n      throw new Error(\"Ya has votado en este sondeo\");\n    }\n\n    // Registrar voto\n    await db.insert(votes).values({\n      userId,\n      pollId,\n      optionId,\n    });\n\n    // Incrementar contador de votos\n    await db\n      .update(pollOptions)\n      .set({\n        votos: sql`${pollOptions.votos} + 1`,\n      })\n      .where(eq(pollOptions.id, optionId));\n  }\n\n  async hasUserVoted(userId: string, pollId: string): Promise<boolean> {\n    const [voto] = await db\n      .select()\n      .from(votes)\n      .where(and(\n        eq(votes.userId, userId),\n        eq(votes.pollId, pollId)\n      ));\n    return !!voto;\n  }\n\n  // === COMENTARIOS ===\n  async getCommentsByProposal(propuestaId: string): Promise<Comment[]> {\n    return await db\n      .select()\n      .from(comments)\n      .where(eq(comments.propuestaId, propuestaId))\n      .orderBy(desc(comments.createdAt));\n  }\n\n  async getCommentsByNews(noticiaId: string): Promise<Comment[]> {\n    return await db\n      .select()\n      .from(comments)\n      .where(eq(comments.noticiaId, noticiaId))\n      .orderBy(desc(comments.createdAt));\n  }\n\n  async createComment(commentData: InsertComment): Promise<Comment> {\n    const [comment] = await db\n      .insert(comments)\n      .values({\n        ...commentData,\n        votosPositivos: 0,\n        votosNegativos: 0,\n      })\n      .returning();\n    return comment;\n  }\n\n  async updateComment(id: string, data: Partial<Comment>): Promise<Comment | undefined> {\n    const [comment] = await db\n      .update(comments)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(comments.id, id))\n      .returning();\n    return comment || undefined;\n  }\n\n  async getCommentsByDebate(debateId: string): Promise<Comment[]> {\n    return await db\n      .select()\n      .from(comments)\n      .where(eq(comments.debateId, debateId))\n      .orderBy(desc(comments.createdAt));\n  }\n\n  async deleteComment(id: string): Promise<void> {\n    await db.delete(comments).where(eq(comments.id, id));\n  }\n\n  // === DEBATES ===\n  async getAllDebates(): Promise<Debate[]> {\n    const debatesWithAuthor = await db\n      .select({\n        debate: debates,\n        autor: {\n          id: users.id,\n          username: users.username,\n        },\n      })\n      .from(debates)\n      .leftJoin(users, eq(debates.autorId, users.id))\n      .orderBy(desc(debates.createdAt));\n\n    return debatesWithAuthor.map(d => ({\n      ...d.debate,\n      autorNombre: d.autor?.username || \"Anónimo\",\n    }));\n  }\n\n  async getDebateById(id: string): Promise<Debate | undefined> {\n    const [debateWithAuthor] = await db\n      .select({\n        debate: debates,\n        autor: {\n          id: users.id,\n          username: users.username,\n        },\n      })\n      .from(debates)\n      .leftJoin(users, eq(debates.autorId, users.id))\n      .where(eq(debates.id, id));\n\n    if (!debateWithAuthor) return undefined;\n\n    return {\n      ...debateWithAuthor.debate,\n      autorNombre: debateWithAuthor.autor?.username || \"Anónimo\",\n    };\n  }\n\n  async createDebate(debateData: InsertDebate): Promise<Debate> {\n    const [debate] = await db\n      .insert(debates)\n      .values({\n        ...debateData,\n        numRespuestas: 0,\n        numVistas: 0,\n        destacado: debateData.destacado || false,\n      })\n      .returning();\n    return debate;\n  }\n\n  async updateDebate(id: string, data: Partial<Debate>): Promise<Debate | undefined> {\n    const [debate] = await db\n      .update(debates)\n      .set({ ...data, updatedAt: new Date() })\n      .where(eq(debates.id, id))\n      .returning();\n    return debate || undefined;\n  }\n\n  async deleteDebate(id: string): Promise<void> {\n    await db.delete(debates).where(eq(debates.id, id));\n  }\n\n  async incrementDebateViews(id: string): Promise<void> {\n    await db\n      .update(debates)\n      .set({ numVistas: sql`${debates.numVistas} + 1` })\n      .where(eq(debates.id, id));\n  }\n\n  // === CONTACTO ===\n  async createContact(contactData: InsertContact): Promise<Contact> {\n    const [contact] = await db\n      .insert(contacts)\n      .values(contactData)\n      .returning();\n    return contact;\n  }\n\n  async getAllContacts(): Promise<Contact[]> {\n    return await db\n      .select()\n      .from(contacts)\n      .orderBy(desc(contacts.createdAt));\n  }\n\n  // === INSIGNIAS ===\n  async getUserBadges(userId: string): Promise<Badge[]> {\n    const userBadgesData = await db\n      .select({\n        badge: badges,\n      })\n      .from(userBadges)\n      .innerJoin(badges, eq(userBadges.badgeId, badges.id))\n      .where(eq(userBadges.userId, userId));\n    \n    return userBadgesData.map(ub => ub.badge);\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":16369},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/NewsCard.tsx":{"content":"// Tarjeta de noticia para la plataforma Neurolex\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport { Link } from \"wouter\";\n\ninterface NewsCardProps {\n  id: string;\n  titulo: string;\n  resumen?: string;\n  imagenUrl?: string;\n  tipo: string;\n  partidoRelacionado?: string;\n  etiquetas?: string[];\n  fuente?: string;\n  createdAt: Date;\n}\n\nconst tipoColors: Record<string, string> = {\n  nacional: \"bg-blue-100 text-blue-800 dark:bg-blue-950 dark:text-blue-300\",\n  internacional: \"bg-purple-100 text-purple-800 dark:bg-purple-950 dark:text-purple-300\",\n  economia: \"bg-green-100 text-green-800 dark:bg-green-950 dark:text-green-300\",\n  social: \"bg-orange-100 text-orange-800 dark:bg-orange-950 dark:text-orange-300\",\n  tecnologia: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-950 dark:text-cyan-300\",\n  otro: \"bg-gray-100 text-gray-800 dark:bg-gray-950 dark:text-gray-300\",\n};\n\nexport function NewsCard({\n  id,\n  titulo,\n  resumen,\n  imagenUrl,\n  tipo,\n  partidoRelacionado,\n  etiquetas,\n  fuente,\n  createdAt,\n}: NewsCardProps) {\n  const tiempoRelativo = formatDistanceToNow(new Date(createdAt), { addSuffix: true, locale: es });\n\n  return (\n    <Link href={`/noticias/${id}`}>\n      <Card className=\"hover-elevate h-full flex flex-col overflow-hidden cursor-pointer\" data-testid={`card-news-${id}`}>\n        {imagenUrl && (\n          <div className=\"aspect-video w-full overflow-hidden bg-muted\">\n            <img\n              src={imagenUrl}\n              alt={titulo}\n              className=\"w-full h-full object-cover transition-transform duration-200 hover:scale-105\"\n              data-testid={`img-news-${id}`}\n            />\n          </div>\n        )}\n        \n        <CardHeader className=\"flex-none\">\n          <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n            <Badge className={tipoColors[tipo] || tipoColors.otro} data-testid={`badge-news-type-${id}`}>\n              {tipo.charAt(0).toUpperCase() + tipo.slice(1)}\n            </Badge>\n            {partidoRelacionado && (\n              <Badge variant=\"outline\" data-testid={`badge-party-${id}`}>\n                {partidoRelacionado}\n              </Badge>\n            )}\n          </div>\n          \n          <CardTitle className=\"text-lg line-clamp-2\" data-testid={`text-news-title-${id}`}>\n            {titulo}\n          </CardTitle>\n          \n          <CardDescription className=\"text-xs\">\n            {fuente && <span>{fuente} • </span>}\n            {tiempoRelativo}\n          </CardDescription>\n        </CardHeader>\n\n        <CardContent className=\"flex-1 flex flex-col\">\n          {resumen && (\n            <p className=\"text-sm text-muted-foreground line-clamp-3 mb-3\" data-testid={`text-news-summary-${id}`}>\n              {resumen}\n            </p>\n          )}\n          \n          {etiquetas && etiquetas.length > 0 && (\n            <div className=\"flex flex-wrap gap-1 mt-auto\">\n              {etiquetas.slice(0, 3).map((etiqueta, index) => (\n                <Badge key={index} variant=\"secondary\" className=\"text-xs\">\n                  {etiqueta}\n                </Badge>\n              ))}\n              {etiquetas.length > 3 && (\n                <Badge variant=\"secondary\" className=\"text-xs\">\n                  +{etiquetas.length - 3}\n                </Badge>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </Link>\n  );\n}\n","size_bytes":3550},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"design_guidelines.md":{"content":"# Guía de Diseño: Plataforma Neurolex\n\n## Enfoque de Diseño\n\n**Sistema Base:** Material Design adaptado para aplicaciones cívicas complejas, con influencias de plataformas gubernamentales modernas como GOV.UK y Estonia's e-Estonia para credibilidad institucional.\n\n**Principios Fundamentales:**\n- Transparencia visual que refleja transparencia democrática\n- Jerarquía clara para navegación en ecosistema complejo\n- Accesibilidad como prioridad (WCAG 2.1 AA mínimo)\n- Profesionalismo que inspire confianza ciudadana\n\n---\n\n## Tipografía\n\n**Familias de Fuentes:**\n- **Principal:** Inter (Google Fonts) - Todas las interfaces, botones, formularios\n- **Encabezados:** Poppins SemiBold/Bold (Google Fonts) - Títulos de sección, heroes\n- **Datos/Números:** JetBrains Mono (Google Fonts) - Contadores de tokens, estadísticas\n\n**Jerarquía Tipográfica:**\n- H1: Poppins Bold, text-4xl md:text-5xl lg:text-6xl\n- H2: Poppins SemiBold, text-3xl md:text-4xl\n- H3: Poppins SemiBold, text-2xl md:text-3xl\n- H4: Inter SemiBold, text-xl md:text-2xl\n- Body: Inter Regular, text-base (16px)\n- Small: Inter Regular, text-sm\n- Tokens/Stats: JetBrains Mono Medium, text-lg\n\n---\n\n## Sistema de Espaciado\n\n**Unidades Tailwind:** Consistencia estricta usando 2, 4, 6, 8, 12, 16, 20, 24\n- Padding interno componentes: p-4, p-6, p-8\n- Márgenes entre secciones: my-12, my-16, my-20\n- Gaps en grids: gap-4, gap-6, gap-8\n- Contenedores principales: max-w-7xl mx-auto px-4 md:px-6 lg:px-8\n\n---\n\n## Biblioteca de Componentes\n\n### Navegación Principal\n- **Header Superior:** Sticky navbar con logo Neurolex (izquierda), navegación central, iconos de usuario/tokens/notificaciones (derecha)\n- Altura: h-16 md:h-20\n- Navegación: Enlaces horizontales con hover underline animation\n- Mobile: Hamburger menu con slide-in drawer\n- **Breadcrumbs:** Siempre visibles en vistas internas para orientación\n\n### Tarjetas (Cards)\n**Estilo Base:** Bordes rounded-lg, shadow-md, hover:shadow-lg transition\n- **Card Propuesta:** Título, descripción corta, badges (categoría, partido), contador TP/TA, botón \"Ver Detalles\"\n- **Card Noticia:** Imagen thumbnail, titular, fuente, fecha, etiquetas partido\n- **Card Token:** Icono token, nombre (TP/TA/TGR), cantidad grande, descripción uso\n- **Card Estadística:** Número grande (JetBrains Mono), label descriptivo, icono contextual\n\n### Panel de Usuario (Dashboard)\n**Layout:** Grid responsivo con widgets reorganizables\n```\nDesktop: grid-cols-3 gap-6\nTablet: grid-cols-2 gap-4\nMobile: grid-cols-1 gap-4\n```\n**Widgets Principales:**\n- \"Mi Cartera\": Tres tarjetas horizontales mostrando TP, TA, TGR con iconos\n- \"Votaciones Activas\": Lista vertical con progress bars de tiempo restante\n- \"Feed Personalizado\": Cards de noticias/propuestas con scroll infinito\n- \"Mi Karma\": Círculo de progreso con nivel actual y puntos al próximo nivel\n\n### Formularios\n**Estructura Consistente:**\n- Labels: font-medium text-sm, siempre visibles arriba del input\n- Inputs: rounded-md, p-3, border-2, focus:ring-2 focus:border-current\n- Textarea: min-h-32 para comentarios, min-h-48 para propuestas\n- Botones: rounded-md px-6 py-3, font-semibold\n- Validación: Mensajes en text-sm debajo del campo con icono\n\n**Formulario Propuesta Ciudadana:**\n- Input título: text-xl font-semibold\n- Editor WYSIWYG para cuerpo (Quill o TinyMCE)\n- Selector categorías (multi-select con chips)\n- Preview en tiempo real (columna derecha en desktop)\n\n### Sistema de Votación\n**Interfaz de Voto:**\n- Opciones como botones grandes (min-h-20) con radio button integrado\n- Indicador visual de selección actual\n- Botón \"Confirmar Voto\" destacado, separado\n- Modal de confirmación con resumen antes de submitir\n\n**Resultados:**\n- Progress bars horizontales para cada opción\n- Porcentajes en JetBrains Mono\n- Total votos en la parte superior\n- Animación de llenado al cargar resultados\n\n### Monedero de Tokens\n**Vista Principal:**\n- Tres secciones en row (desktop) o stack (mobile)\n- Cada token: Icono grande arriba, cantidad central (text-4xl JetBrains Mono), nombre debajo\n- Botón \"Ver Historial\" expandible como accordion\n- Transacciones: Tabla con fecha, tipo, cantidad (+/-), descripción\n\n### Sistema de Comentarios\n**Estructura Anidada:**\n- Nivel 1: sin indent\n- Nivel 2-3: ml-8 con border-l-2\n- Cada comentario: Avatar (izquierda), contenido (derecha), acciones (abajo)\n- Upvote/Downvote: Iconos con contador entre ellos\n- Responder: Abre textarea colapsable debajo\n\n### Feed de Noticias\n**Dos Vistas:**\n1. **Grid View (default):** grid-cols-1 md:grid-cols-2 lg:grid-cols-3\n2. **List View:** Tarjetas anchas con imagen izquierda, contenido derecha\n\n**Filtros Laterales (Desktop):**\n- Sidebar izquierdo sticky con checkboxes\n- Categorías, Partidos, Fechas\n- Mobile: Sheet modal desde bottom\n\n---\n\n## Iconografía\n\n**Librería:** Heroicons (via CDN)\n- Navegación: outline icons\n- Acciones: solid icons para estados activos\n- Tokens: Custom SVGs proporcionados en assets\n\n**Tamaños Consistentes:**\n- Navegación: w-6 h-6\n- Botones: w-5 h-5\n- Iconos decorativos: w-8 h-8 o w-12 h-12\n\n---\n\n## Páginas Clave\n\n### Landing Page (Pública)\n**Estructura:**\n1. **Hero:** h-screen con video de fondo (Neurolex.mp4), título impactante, CTA \"Comenzar Ahora\", subtítulo explicativo\n2. **Tres Pilares:** Grid 3 columnas - Participación, Transparencia, Gobernanza (iconos grandes, títulos, descripciones)\n3. **Sistema de Tokens:** Sección explicativa con 3 cards interactivas para TP, TA, TGR\n4. **Cómo Funciona:** Timeline vertical (mobile) u horizontal (desktop) con 5 pasos\n5. **Testimonios:** Carousel de quotes ciudadanos con avatars\n6. **CTA Final:** Fondo destacado, título fuerte, botón grande registro\n7. **Footer:** 4 columnas - Enlaces, Redes, Newsletter, Legal\n\n### Dashboard Principal\n**Layout:** Sidebar izquierdo (desktop), top tabs (mobile)\n**Contenido Central:** Grid de widgets como descrito arriba\n**Sidebar Derecho (opcional desktop):** Notificaciones recientes, \"Tendencias\"\n\n### Página Propuesta Individual\n**Layout de Dos Columnas (Desktop):**\n- **Columna Izquierda (2/3):** Título, metadata (autor, fecha, categoría), contenido completo, comentarios anidados\n- **Columna Derecha (1/3):** Card sticky con estadísticas (apoyos TP/TA), botón \"Apoyar\", compartir, usuarios destacados que apoyan\n\n### Página de Noticias\n**Header:** Título sección, filtros en chip format\n**Grid Noticias:** Masonry layout en desktop (grid-cols-3 gap-6)\n**Sidebar Filtros:** Sticky en desktop, drawer en mobile\n\n### Página Votación Activa\n**Centrada:** max-w-4xl mx-auto\n**Secciones Verticales:** Título votación, descripción, opciones (botones grandes), temporizador countdown destacado, botón confirmar\n\n---\n\n## Imágenes\n\n**Hero Landing:** Video de fondo (Neurolex.mp4 o similar de assets) con overlay oscuro semitransparente, botones con backdrop-blur-md\n**Noticias:** Thumbnails rectangulares 16:9 ratio, object-cover\n**Logos Partidos:** Circular avatars pequeños como badges\n**Iconos Tokens:** SVGs personalizados (ia PNG assets) integrados en tarjetas\n**Banner E-voting:** Usar en sección explicativa \"Cómo Funciona\"\n\n---\n\n## Responsive Breakpoints\n- Mobile: < 768px (base Tailwind)\n- Tablet: 768px - 1024px (md:)\n- Desktop: > 1024px (lg:)\n\n**Comportamientos:**\n- Sidebar → Top navigation/Drawer\n- Grid 3 cols → 2 cols → 1 col\n- Sticky sidebars → Full width stacks\n- Horizontal tabs → Vertical stacks\n\n---\n\n## Animaciones\n**Mínimas y Funcionales:**\n- Transiciones de hover: transition-all duration-200\n- Carga de resultados votación: Progress bar fill animation\n- Aparición cards: fade-in stagger en scroll (usar Intersection Observer)\n- Confirmación acciones: Checkmark animation suave\n- **NO** parallax, **NO** animaciones complejas que distraigan","size_bytes":7779},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport connectPgSimple from \"connect-pg-simple\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { db } from \"./db\";\n\n// Extender tipos de sesión para TypeScript\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId: string;\n  }\n}\n\nconst app = express();\n\n// Configurar sesiones con PostgreSQL\nconst PgSession = connectPgSimple(session);\napp.use(\n  session({\n    store: new PgSession({\n      pool: db,\n      tableName: \"session\",\n      createTableIfMissing: true,\n    }),\n    secret: process.env.SESSION_SECRET || \"neurolex-secret-key-change-in-production\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      secure: process.env.NODE_ENV === \"production\",\n      httpOnly: true,\n      maxAge: 30 * 24 * 60 * 60 * 1000, // 30 días\n    },\n  })\n);\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2966},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1592},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":1080},"client/src/components/PollCard.tsx":{"content":"// Tarjeta de sondeo/encuesta para la plataforma Neurolex\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { BarChart3, Clock, Users } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\ninterface PollOption {\n  id: string;\n  texto: string;\n  votos: number;\n}\n\ninterface PollCardProps {\n  id: string;\n  pregunta: string;\n  descripcion?: string;\n  opciones: PollOption[];\n  totalVotos: number;\n  fechaFin?: Date;\n  hasVoted?: boolean;\n  onVote?: (pollId: string, optionId: string) => void;\n}\n\nexport function PollCard({\n  id,\n  pregunta,\n  descripcion,\n  opciones = [],\n  totalVotos,\n  fechaFin,\n  hasVoted = false,\n  onVote,\n}: PollCardProps) {\n  const tiempoRestante = fechaFin ? formatDistanceToNow(new Date(fechaFin), { addSuffix: false, locale: es }) : null;\n  const isActive = fechaFin ? new Date(fechaFin) > new Date() : true;\n\n  return (\n    <Card className=\"hover-elevate\" data-testid={`card-poll-${id}`}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between gap-2 mb-2\">\n          <Badge variant={isActive ? \"default\" : \"secondary\"} data-testid={`badge-poll-status-${id}`}>\n            <BarChart3 className=\"h-3 w-3 mr-1\" />\n            {isActive ? \"Activo\" : \"Cerrado\"}\n          </Badge>\n          {tiempoRestante && isActive && (\n            <Badge variant=\"outline\" className=\"text-xs\">\n              <Clock className=\"h-3 w-3 mr-1\" />\n              {tiempoRestante}\n            </Badge>\n          )}\n        </div>\n        \n        <CardTitle className=\"text-xl\" data-testid={`text-poll-question-${id}`}>\n          {pregunta}\n        </CardTitle>\n        \n        {descripcion && (\n          <CardDescription data-testid={`text-poll-description-${id}`}>\n            {descripcion}\n          </CardDescription>\n        )}\n      </CardHeader>\n\n      <CardContent className=\"space-y-4\">\n        {opciones.map((opcion) => {\n          const porcentaje = totalVotos > 0 ? (opcion.votos / totalVotos) * 100 : 0;\n\n          return (\n            <div key={opcion.id} className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <button\n                  onClick={() => !hasVoted && isActive && onVote?.(id, opcion.id)}\n                  disabled={hasVoted || !isActive}\n                  className={`text-sm font-medium text-left hover:text-primary transition-colors ${\n                    hasVoted || !isActive ? \"cursor-not-allowed\" : \"cursor-pointer\"\n                  }`}\n                  data-testid={`button-poll-option-${opcion.id}`}\n                >\n                  {opcion.texto}\n                </button>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm font-mono font-semibold\" data-testid={`text-poll-votes-${opcion.id}`}>\n                    {opcion.votos}\n                  </span>\n                  <span className=\"text-xs text-muted-foreground\">\n                    ({porcentaje.toFixed(1)}%)\n                  </span>\n                </div>\n              </div>\n              <Progress value={porcentaje} className=\"h-2\" />\n            </div>\n          );\n        })}\n      </CardContent>\n\n      <CardFooter className=\"flex items-center justify-between text-sm text-muted-foreground\">\n        <div className=\"flex items-center gap-1\">\n          <Users className=\"h-4 w-4\" />\n          <span className=\"font-mono\" data-testid={`text-poll-total-votes-${id}`}>\n            {totalVotos}\n          </span>\n          <span>votos</span>\n        </div>\n        {hasVoted && (\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            Ya has votado\n          </Badge>\n        )}\n      </CardFooter>\n    </Card>\n  );\n}\n","size_bytes":3939},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":4050},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/pages/Noticias.tsx":{"content":"// Página de noticias políticas para Neurolex\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { NewsCard } from \"@/components/NewsCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Search, Filter } from \"lucide-react\";\n\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function Noticias() {\n  // Obtener userId del localStorage\n  const userId = localStorage.getItem(\"userId\");\n\n  // Cargar datos del usuario si está autenticado\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens si está autenticado\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar noticias del backend\n  const { data: noticias = [], isLoading } = useQuery({\n    queryKey: [\"/api/news\"],\n  });\n\n  const tiposNoticia = [\"Todas\", \"Nacional\", \"Internacional\", \"Economía\", \"Social\", \"Tecnología\", \"Otro\"];\n  const partidos = [\"Todos\", \"Partido A\", \"Partido B\", \"Partido C\", \"Partido D\"];\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-2\" data-testid=\"text-page-title\">\n              Noticias Políticas\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Mantente informado sobre los últimos acontecimientos políticos y sociales\n            </p>\n          </div>\n\n          {/* Filtros y Búsqueda */}\n          <div className=\"mb-8 space-y-4\">\n            <div className=\"flex flex-col md:flex-row gap-4\">\n              {/* Barra de búsqueda */}\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                <Input\n                  placeholder=\"Buscar noticias...\"\n                  className=\"pl-10\"\n                  data-testid=\"input-search-news\"\n                />\n              </div>\n\n              {/* Filtros */}\n              <div className=\"flex gap-2\">\n                <Select defaultValue=\"todas\">\n                  <SelectTrigger className=\"w-[180px]\" data-testid=\"select-news-type\">\n                    <SelectValue placeholder=\"Tipo de noticia\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {tiposNoticia.map((tipo) => (\n                      <SelectItem key={tipo} value={tipo.toLowerCase()}>\n                        {tipo}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n\n                <Select defaultValue=\"todos\">\n                  <SelectTrigger className=\"w-[180px]\" data-testid=\"select-party\">\n                    <SelectValue placeholder=\"Partido político\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {partidos.map((partido) => (\n                      <SelectItem key={partido} value={partido.toLowerCase()}>\n                        {partido}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            {/* Tags populares */}\n            <div className=\"flex flex-wrap gap-2\">\n              <span className=\"text-sm text-muted-foreground\">Temas populares:</span>\n              {[\"transparencia\", \"educación\", \"salud\", \"economía\", \"tecnología\"].map((tag) => (\n                <Badge\n                  key={tag}\n                  variant=\"secondary\"\n                  className=\"cursor-pointer hover-elevate\"\n                  data-testid={`badge-tag-${tag}`}\n                >\n                  {tag}\n                </Badge>\n              ))}\n            </div>\n          </div>\n\n          {/* Grid de Noticias */}\n          {isLoading ? (\n            <div className=\"flex justify-center py-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n            </div>\n          ) : noticias.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground\">No hay noticias disponibles</p>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {noticias.map((noticia: any) => (\n                <NewsCard key={noticia.id} {...noticia} />\n              ))}\n            </div>\n          )}\n\n          {/* Paginación */}\n          <div className=\"mt-12 flex justify-center gap-2\">\n            <Button variant=\"outline\" disabled data-testid=\"button-prev-page\">\n              Anterior\n            </Button>\n            <Button variant=\"default\">1</Button>\n            <Button variant=\"outline\">2</Button>\n            <Button variant=\"outline\">3</Button>\n            <Button variant=\"outline\" data-testid=\"button-next-page\">\n              Siguiente\n            </Button>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":5537},"client/src/components/Navbar.tsx":{"content":"// Barra de navegación principal para la plataforma Neurolex\nimport { Link, useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Bell, Menu, User, Wallet, Shield } from \"lucide-react\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Badge } from \"@/components/ui/badge\";\nimport logoUrl from \"@assets/Main logo_1761708286562.jpg\";\n\ninterface NavbarProps {\n  user?: {\n    id: string;\n    username: string;\n    karmaTotal: number;\n    isAdmin?: boolean;\n  };\n  tokensBalance?: {\n    tokensParticipacion: number;\n    tokensApoyo: number;\n    tokensGobernanza: number;\n  };\n}\n\nexport function Navbar({ user, tokensBalance }: NavbarProps) {\n  const [location] = useLocation();\n\n  const navLinks = [\n    { href: \"/\", label: \"Inicio\" },\n    { href: \"/noticias\", label: \"Noticias\" },\n    { href: \"/propuestas\", label: \"Propuestas\" },\n    { href: \"/sondeos\", label: \"Sondeos\" },\n    { href: \"/foro\", label: \"Foro\" },\n    { href: \"/informacion\", label: \"Información\" },\n  ];\n\n  return (\n    <nav className=\"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60\">\n      <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n        <div className=\"flex h-16 md:h-20 items-center justify-between gap-4\">\n          {/* Logo */}\n          <Link href=\"/\" className=\"flex items-center gap-3 hover-elevate rounded-md px-2 py-1 -ml-2\" data-testid=\"link-home\">\n            <img src={logoUrl} alt=\"Neurolex\" className=\"h-10 w-10 md:h-12 md:w-12 rounded-md\" />\n            <span className=\"hidden sm:inline-block text-xl md:text-2xl font-bold font-[Poppins] bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent\">\n              Neurolex\n            </span>\n          </Link>\n\n          {/* Navegación central - Desktop */}\n          <div className=\"hidden lg:flex items-center gap-1\">\n            {navLinks.map((link) => {\n              const isActive = location === link.href;\n              return (\n                <Link key={link.href} href={link.href}>\n                  <Button\n                    variant=\"ghost\"\n                    className={isActive ? \"bg-accent\" : \"\"}\n                    data-testid={`link-${link.label.toLowerCase()}`}\n                  >\n                    {link.label}\n                  </Button>\n                </Link>\n              );\n            })}\n          </div>\n\n          {/* Acciones del usuario */}\n          <div className=\"flex items-center gap-2\">\n            {user ? (\n              <>\n                {/* Tokens - Desktop */}\n                {tokensBalance && (\n                  <div className=\"hidden md:flex items-center gap-2 mr-2\">\n                    <Badge variant=\"secondary\" className=\"font-mono text-xs\" data-testid=\"badge-tokens-tp\">\n                      TP: {tokensBalance.tokensParticipacion}\n                    </Badge>\n                    <Badge variant=\"secondary\" className=\"font-mono text-xs\" data-testid=\"badge-tokens-ta\">\n                      TA: {tokensBalance.tokensApoyo}\n                    </Badge>\n                    <Badge variant=\"secondary\" className=\"font-mono text-xs\" data-testid=\"badge-tokens-tgr\">\n                      TGR: {tokensBalance.tokensGobernanza}\n                    </Badge>\n                  </div>\n                )}\n\n                {/* Notificaciones */}\n                <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-notifications\">\n                  <Bell className=\"h-5 w-5\" />\n                </Button>\n\n                {/* Monedero */}\n                <Link href=\"/monedero\">\n                  <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-wallet\">\n                    <Wallet className=\"h-5 w-5\" />\n                  </Button>\n                </Link>\n\n                {/* Menú de usuario */}\n                <DropdownMenu>\n                  <DropdownMenuTrigger asChild>\n                    <Button variant=\"ghost\" size=\"icon\" className=\"rounded-full\" data-testid=\"button-user-menu\">\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                          {user.username.substring(0, 2).toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                    </Button>\n                  </DropdownMenuTrigger>\n                  <DropdownMenuContent align=\"end\" className=\"w-56\">\n                    <DropdownMenuLabel>\n                      <div className=\"flex flex-col gap-1\">\n                        <p className=\"text-sm font-semibold\">{user.username}</p>\n                        <p className=\"text-xs text-muted-foreground font-mono\">\n                          Karma: {user.karmaTotal}\n                        </p>\n                      </div>\n                    </DropdownMenuLabel>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/dashboard\" className=\"cursor-pointer\" data-testid=\"link-dashboard\">\n                        <User className=\"mr-2 h-4 w-4\" />\n                        Mi Panel\n                      </Link>\n                    </DropdownMenuItem>\n                    {user.isAdmin && (\n                      <DropdownMenuItem asChild>\n                        <Link href=\"/admin\" className=\"cursor-pointer\" data-testid=\"link-admin-panel\">\n                          <Shield className=\"mr-2 h-4 w-4\" />\n                          <span className=\"font-semibold\">Panel de Admin</span>\n                        </Link>\n                      </DropdownMenuItem>\n                    )}\n                    <DropdownMenuItem asChild>\n                      <Link href=\"/monedero\" className=\"cursor-pointer\" data-testid=\"link-wallet\">\n                        <Wallet className=\"mr-2 h-4 w-4\" />\n                        Monedero\n                      </Link>\n                    </DropdownMenuItem>\n                    <DropdownMenuSeparator />\n                    <DropdownMenuItem className=\"text-destructive cursor-pointer\" data-testid=\"button-logout\">\n                      Cerrar Sesión\n                    </DropdownMenuItem>\n                  </DropdownMenuContent>\n                </DropdownMenu>\n              </>\n            ) : (\n              <div className=\"flex items-center gap-2\">\n                <Link href=\"/login\">\n                  <Button variant=\"ghost\" data-testid=\"button-login\">\n                    Iniciar Sesión\n                  </Button>\n                </Link>\n                <Link href=\"/registro\">\n                  <Button data-testid=\"button-register\">\n                    Registrarse\n                  </Button>\n                </Link>\n              </div>\n            )}\n\n            {/* Menú hamburguesa - Mobile */}\n            <div className=\"lg:hidden\">\n              <Button variant=\"ghost\" size=\"icon\" data-testid=\"button-menu\">\n                <Menu className=\"h-6 w-6\" />\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </nav>\n  );\n}\n","size_bytes":7268},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/App.tsx":{"content":"// Aplicación principal de Neurolex - Plataforma de Gobernanza y Participación Cívica\nimport { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\n\n// Importar todas las páginas\nimport Home from \"@/pages/Home\";\nimport Register from \"@/pages/Register\";\nimport Login from \"@/pages/Login\";\nimport Dashboard from \"@/pages/Dashboard\";\nimport Monedero from \"@/pages/Monedero\";\nimport ComprarTokens from \"@/pages/ComprarTokens\";\nimport Admin from \"@/pages/Admin\";\nimport AdminNoticias from \"@/pages/AdminNoticias\";\nimport AdminPropuestas from \"@/pages/AdminPropuestas\";\nimport AdminSondeos from \"@/pages/AdminSondeos\";\nimport AdminDebates from \"@/pages/AdminDebates\";\nimport AdminUsuarios from \"@/pages/AdminUsuarios\";\nimport Noticias from \"@/pages/Noticias\";\nimport NoticiaDetalle from \"@/pages/NoticiaDetalle\";\nimport Propuestas from \"@/pages/Propuestas\";\nimport PropuestaDetalle from \"@/pages/PropuestaDetalle\";\nimport Sondeos from \"@/pages/Sondeos\";\nimport Foro from \"@/pages/Foro\";\nimport ForoDetalle from \"@/pages/ForoDetalle\";\nimport ForoNuevo from \"@/pages/ForoNuevo\";\nimport Informacion from \"@/pages/Informacion\";\nimport Contacto from \"@/pages/Contacto\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction Router() {\n  return (\n    <Switch>\n      {/* Página de inicio */}\n      <Route path=\"/\" component={Home} />\n      \n      {/* Autenticación */}\n      <Route path=\"/registro\" component={Register} />\n      <Route path=\"/login\" component={Login} />\n      \n      {/* Dashboard de usuario */}\n      <Route path=\"/dashboard\" component={Dashboard} />\n      <Route path=\"/monedero\" component={Monedero} />\n      <Route path=\"/comprar-tokens\" component={ComprarTokens} />\n      \n      {/* Panel de administrador */}\n      <Route path=\"/admin\" component={Admin} />\n      <Route path=\"/admin/noticias\" component={AdminNoticias} />\n      <Route path=\"/admin/propuestas\" component={AdminPropuestas} />\n      <Route path=\"/admin/sondeos\" component={AdminSondeos} />\n      <Route path=\"/admin/debates\" component={AdminDebates} />\n      <Route path=\"/admin/usuarios\" component={AdminUsuarios} />\n      \n      {/* Contenido principal */}\n      <Route path=\"/noticias/:id\" component={NoticiaDetalle} />\n      <Route path=\"/noticias\" component={Noticias} />\n      <Route path=\"/propuestas/:id\" component={PropuestaDetalle} />\n      <Route path=\"/propuestas\" component={Propuestas} />\n      <Route path=\"/sondeos\" component={Sondeos} />\n      <Route path=\"/foro/nuevo\" component={ForoNuevo} />\n      <Route path=\"/foro/:id\" component={ForoDetalle} />\n      <Route path=\"/foro\" component={Foro} />\n      \n      {/* Información y contacto */}\n      <Route path=\"/informacion\" component={Informacion} />\n      <Route path=\"/contacto\" component={Contacto} />\n      \n      {/* 404 - Página no encontrada */}\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nexport default function App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Router />\n        <Toaster />\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n","size_bytes":3270},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/Footer.tsx":{"content":"// Footer para la plataforma Neurolex\nimport { Link } from \"wouter\";\nimport { Mail, Phone, MapPin } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\n\nexport function Footer() {\n  return (\n    <footer className=\"border-t bg-card\">\n      <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-12\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8\">\n          {/* Información */}\n          <div>\n            <h3 className=\"font-bold text-lg mb-4 font-[Poppins]\">Neurolex</h3>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Plataforma de democracia digital para participación cívica y gobernanza comunitaria transparente.\n            </p>\n            <div className=\"flex gap-2\">\n              <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-social-twitter\">\n                <span className=\"sr-only\">Twitter</span>\n                <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\" />\n                </svg>\n              </Button>\n              <Button variant=\"outline\" size=\"icon\" className=\"h-8 w-8\" data-testid=\"button-social-facebook\">\n                <span className=\"sr-only\">Facebook</span>\n                <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path fillRule=\"evenodd\" d=\"M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z\" clipRule=\"evenodd\" />\n                </svg>\n              </Button>\n            </div>\n          </div>\n\n          {/* Enlaces */}\n          <div>\n            <h4 className=\"font-semibold text-sm mb-4\">Enlaces Rápidos</h4>\n            <ul className=\"space-y-2 text-sm\">\n              <li>\n                <Link href=\"/noticias\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Noticias\n                </Link>\n              </li>\n              <li>\n                <Link href=\"/propuestas\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Propuestas\n                </Link>\n              </li>\n              <li>\n                <Link href=\"/sondeos\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Sondeos\n                </Link>\n              </li>\n              <li>\n                <Link href=\"/informacion\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Información\n                </Link>\n              </li>\n            </ul>\n          </div>\n\n          {/* Recursos */}\n          <div>\n            <h4 className=\"font-semibold text-sm mb-4\">Recursos</h4>\n            <ul className=\"space-y-2 text-sm\">\n              <li>\n                <Link href=\"/contacto\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Contacto\n                </Link>\n              </li>\n              <li>\n                <a href=\"#\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Preguntas Frecuentes\n                </a>\n              </li>\n              <li>\n                <a href=\"#\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Términos de Servicio\n                </a>\n              </li>\n              <li>\n                <a href=\"#\" className=\"text-muted-foreground hover:text-foreground transition-colors\">\n                  Privacidad\n                </a>\n              </li>\n            </ul>\n          </div>\n\n          {/* Newsletter */}\n          <div>\n            <h4 className=\"font-semibold text-sm mb-4\">Mantente Informado</h4>\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Recibe actualizaciones sobre nuevas propuestas y votaciones.\n            </p>\n            <div className=\"flex gap-2\">\n              <Input \n                type=\"email\" \n                placeholder=\"tu@email.com\" \n                className=\"h-9 text-sm\"\n                data-testid=\"input-newsletter\"\n              />\n              <Button size=\"sm\" data-testid=\"button-subscribe\">\n                Suscribir\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        <div className=\"border-t mt-8 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-muted-foreground\">\n          <p>© 2025 Neurolex. Todos los derechos reservados.</p>\n          <div className=\"flex gap-6\">\n            <a href=\"#\" className=\"hover:text-foreground transition-colors\">\n              Política de Privacidad\n            </a>\n            <a href=\"#\" className=\"hover:text-foreground transition-colors\">\n              Términos de Uso\n            </a>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":5229},"client/src/pages/Informacion.tsx":{"content":"// Página de información sobre Neurolex\nimport { Link } from \"wouter\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { Shield, Users, TrendingUp, Coins, Award, Vote, MessageSquare, BarChart3, CheckCircle } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nexport default function Informacion() {\n  // Obtener userId del localStorage\n  const userId = localStorage.getItem(\"userId\");\n\n  // Cargar datos del usuario si está autenticado\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens si está autenticado\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const caracteristicas = [\n    {\n      icon: Vote,\n      titulo: \"E-voting Seguro\",\n      descripcion: \"Sistema de votación electrónica con tecnología blockchain para garantizar transparencia e inmutabilidad.\",\n    },\n    {\n      icon: Coins,\n      titulo: \"Sistema de Tokens\",\n      descripcion: \"Tres tipos de tokens (TP, TA, TGR) para incentivar la participación y permitir contribuciones económicas transparentes.\",\n    },\n    {\n      icon: TrendingUp,\n      titulo: \"Gamificación con Karma\",\n      descripcion: \"Sistema de puntos que recompensa la participación de calidad y desbloquea privilegios en la plataforma.\",\n    },\n    {\n      icon: MessageSquare,\n      titulo: \"Deliberación Ciudadana\",\n      descripcion: \"Espacios de debate estructurado para propuestas de ley y políticas públicas.\",\n    },\n    {\n      icon: Shield,\n      titulo: \"Verificación de Identidad\",\n      descripcion: \"Sistema progresivo de verificación para garantizar la legitimidad de los usuarios.\",\n    },\n    {\n      icon: BarChart3,\n      titulo: \"Transparencia Total\",\n      descripcion: \"Todas las transacciones, votos y decisiones son públicas y auditables.\",\n    },\n  ];\n\n  const faq = [\n    {\n      pregunta: \"¿Qué es Neurolex?\",\n      respuesta: \"Neurolex es una plataforma de democracia digital que facilita la participación cívica, el e-voting y la gobernanza comunitaria. Nuestro objetivo es crear un ecosistema transparente donde los ciudadanos puedan influir directamente en las decisiones que afectan su comunidad.\",\n    },\n    {\n      pregunta: \"¿Cómo funcionan los tokens?\",\n      respuesta: \"Tenemos tres tipos de tokens: Tokens de Participación (TP) que ganas al participar activamente, Tokens de Apoyo (TA) que puedes comprar para financiar propuestas o partidos, y Tokens de Gobernanza (TGR) otorgados a roles clave para votar en la evolución de la plataforma.\",\n    },\n    {\n      pregunta: \"¿Es seguro votar en línea?\",\n      respuesta: \"Sí. Utilizamos tecnología blockchain para garantizar que cada voto sea inmutable, verificable y anónimo. El sistema incluye verificación de identidad multinivel y auditorías públicas transparentes.\",\n    },\n    {\n      pregunta: \"¿Cómo gano Karma?\",\n      respuesta: \"Ganas Karma al votar en elecciones, escribir comentarios valorados positivamente, crear propuestas aceptadas, participar en sondeos y completar misiones cívicas. El Karma desbloquea privilegios como proponer leyes o participar en debates de alto nivel.\",\n    },\n    {\n      pregunta: \"¿Puedo proponer leyes?\",\n      respuesta: \"Sí, los usuarios verificados con suficiente Karma pueden crear propuestas ciudadanas. Estas pasan por fases de apoyo, deliberación y votación. Si alcanzan los umbrales necesarios, pueden convertirse en consultas oficiales.\",\n    },\n    {\n      pregunta: \"¿Cómo se protege mi privacidad?\",\n      respuesta: \"Tus datos personales están encriptados y nunca se comparten con terceros. Los votos son anónimos y solo tú puedes ver tu historial completo de actividad. Cumplimos con todas las regulaciones de protección de datos.\",\n    },\n  ];\n\n  const comoEmpezar = [\n    {\n      numero: 1,\n      titulo: \"Regístrate\",\n      descripcion: \"Crea tu cuenta gratuita con tu email. Solo toma un minuto.\",\n    },\n    {\n      numero: 2,\n      titulo: \"Verifica tu Identidad (Opcional)\",\n      descripcion: \"Para votar y proponer leyes, verifica tu identidad. Esto garantiza la legitimidad del sistema.\",\n    },\n    {\n      numero: 3,\n      titulo: \"Explora y Participa\",\n      descripcion: \"Lee noticias, vota en sondeos, comenta propuestas y gana tus primeros Tokens de Participación.\",\n    },\n    {\n      numero: 4,\n      titulo: \"Crea Propuestas\",\n      descripcion: \"Cuando acumules suficiente Karma, podrás crear tus propias propuestas ciudadanas.\",\n    },\n    {\n      numero: 5,\n      titulo: \"Influye y Gobierna\",\n      descripcion: \"Usa tus tokens para apoyar causas, vota en decisiones importantes y forma parte del cambio.\",\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        {/* Hero Section */}\n        <section className=\"bg-gradient-to-br from-primary/10 via-background to-background py-20\">\n          <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 text-center\">\n            <h1 className=\"text-4xl md:text-5xl font-bold font-[Poppins] mb-4\" data-testid=\"text-page-title\">\n              ¿Qué es Neurolex?\n            </h1>\n            <p className=\"text-lg text-muted-foreground max-w-3xl mx-auto mb-8\">\n              Somos una plataforma de democracia digital que empodera a los ciudadanos para participar \n              activamente en la toma de decisiones a través de votación electrónica, propuestas ciudadanas \n              y un sistema de incentivos transparente.\n            </p>\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n              <Link href=\"/registro\">\n                <Button size=\"lg\" data-testid=\"button-register\">\n                  Comenzar Ahora\n                </Button>\n              </Link>\n              <Link href=\"/contacto\">\n                <Button size=\"lg\" variant=\"outline\" data-testid=\"button-contact\">\n                  Contactar\n                </Button>\n              </Link>\n            </div>\n          </div>\n        </section>\n\n        {/* Características */}\n        <section className=\"py-20\">\n          <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] text-center mb-12\">\n              Características Principales\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {caracteristicas.map((feature, index) => {\n                const Icon = feature.icon;\n                return (\n                  <Card key={index} className=\"hover-elevate\">\n                    <CardHeader>\n                      <div className=\"mb-4 p-3 rounded-full bg-primary/10 w-fit\">\n                        <Icon className=\"h-6 w-6 text-primary\" />\n                      </div>\n                      <CardTitle className=\"text-lg\">{feature.titulo}</CardTitle>\n                    </CardHeader>\n                    <CardContent>\n                      <CardDescription>{feature.descripcion}</CardDescription>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        </section>\n\n        {/* Cómo Empezar */}\n        <section className=\"py-20 bg-card\">\n          <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] text-center mb-12\">\n              Cómo Empezar\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-5 gap-6\">\n              {comoEmpezar.map((paso) => (\n                <div key={paso.numero} className=\"text-center\">\n                  <div className=\"mx-auto mb-4 w-16 h-16 rounded-full bg-primary flex items-center justify-center\">\n                    <span className=\"text-2xl font-bold font-mono text-primary-foreground\">\n                      {paso.numero}\n                    </span>\n                  </div>\n                  <h3 className=\"font-semibold text-lg mb-2\">{paso.titulo}</h3>\n                  <p className=\"text-sm text-muted-foreground\">{paso.descripcion}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        </section>\n\n        {/* Preguntas Frecuentes */}\n        <section className=\"py-20\">\n          <div className=\"max-w-4xl mx-auto px-4 md:px-6 lg:px-8\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] text-center mb-12\">\n              Preguntas Frecuentes\n            </h2>\n            <Accordion type=\"single\" collapsible className=\"w-full\">\n              {faq.map((item, index) => (\n                <AccordionItem key={index} value={`item-${index}`}>\n                  <AccordionTrigger className=\"text-left\" data-testid={`faq-question-${index}`}>\n                    {item.pregunta}\n                  </AccordionTrigger>\n                  <AccordionContent className=\"text-muted-foreground\" data-testid={`faq-answer-${index}`}>\n                    {item.respuesta}\n                  </AccordionContent>\n                </AccordionItem>\n              ))}\n            </Accordion>\n          </div>\n        </section>\n\n        {/* Valores */}\n        <section className=\"py-20 bg-card\">\n          <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] text-center mb-12\">\n              Nuestros Valores\n            </h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8\">\n              <div className=\"text-center\">\n                <div className=\"mx-auto mb-4 p-4 rounded-full bg-primary/10 w-fit\">\n                  <Shield className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h3 className=\"font-semibold text-xl mb-2\">Transparencia</h3>\n                <p className=\"text-muted-foreground\">\n                  Todas las decisiones, votos y transacciones son públicas y verificables\n                </p>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"mx-auto mb-4 p-4 rounded-full bg-primary/10 w-fit\">\n                  <Users className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h3 className=\"font-semibold text-xl mb-2\">Participación</h3>\n                <p className=\"text-muted-foreground\">\n                  Incentivamos la participación activa de todos los ciudadanos\n                </p>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"mx-auto mb-4 p-4 rounded-full bg-primary/10 w-fit\">\n                  <CheckCircle className=\"h-8 w-8 text-primary\" />\n                </div>\n                <h3 className=\"font-semibold text-xl mb-2\">Descentralización</h3>\n                <p className=\"text-muted-foreground\">\n                  El poder está distribuido entre la comunidad, no centralizado\n                </p>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* CTA Final */}\n        <section className=\"py-20\">\n          <div className=\"max-w-4xl mx-auto px-4 md:px-6 lg:px-8 text-center\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-4\">\n              ¿Listo para participar?\n            </h2>\n            <p className=\"text-lg text-muted-foreground mb-8\">\n              Únete a miles de ciudadanos que ya están construyendo una democracia más transparente\n            </p>\n            <Link href=\"/registro\">\n              <Button size=\"lg\" className=\"text-lg px-8\" data-testid=\"button-final-cta\">\n                Crear Cuenta Gratuita\n              </Button>\n            </Link>\n          </div>\n        </section>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":12150},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"server/db.ts":{"content":"// Configuración de conexión a la base de datos PostgreSQL usando Drizzle ORM\n// Basado en el blueprint javascript_database\nimport { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":609},"client/src/pages/Propuestas.tsx":{"content":"// Página de propuestas ciudadanas para Neurolex\nimport { Link } from \"wouter\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { ProposalCard } from \"@/components/ProposalCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Search, Plus } from \"lucide-react\";\n\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function Propuestas() {\n  // Obtener userId del localStorage\n  const userId = localStorage.getItem(\"userId\");\n\n  // Cargar datos del usuario si está autenticado\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens si está autenticado\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar propuestas del backend\n  const { data: propuestas = [], isLoading } = useQuery({\n    queryKey: [\"/api/proposals\"],\n  });\n\n  const categorias = [\"Todas\", \"Medio Ambiente\", \"Transporte\", \"Educación\", \"Salud\", \"Seguridad\", \"Tecnología\", \"Economía\"];\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between mb-8 gap-4\">\n            <div>\n              <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-2\" data-testid=\"text-page-title\">\n                Propuestas Ciudadanas\n              </h1>\n              <p className=\"text-muted-foreground\">\n                Explora, apoya y crea propuestas para mejorar tu comunidad\n              </p>\n            </div>\n            <Link href=\"/propuestas/nueva\">\n              <Button className=\"flex-shrink-0\" data-testid=\"button-create-proposal\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Nueva Propuesta\n              </Button>\n            </Link>\n          </div>\n\n          {/* Pestañas de estado */}\n          <Tabs defaultValue=\"todas\" className=\"mb-8\">\n            <TabsList className=\"grid w-full grid-cols-3 lg:grid-cols-6\" data-testid=\"tabs-proposal-status\">\n              <TabsTrigger value=\"todas\">Todas</TabsTrigger>\n              <TabsTrigger value=\"en_deliberacion\">En Deliberación</TabsTrigger>\n              <TabsTrigger value=\"votacion\">En Votación</TabsTrigger>\n              <TabsTrigger value=\"aprobada\">Aprobadas</TabsTrigger>\n              <TabsTrigger value=\"rechazada\">Rechazadas</TabsTrigger>\n              <TabsTrigger value=\"archivada\">Archivadas</TabsTrigger>\n            </TabsList>\n\n            <TabsContent value=\"todas\" className=\"space-y-6 mt-6\">\n              {/* Filtros y Búsqueda */}\n              <div className=\"flex flex-col md:flex-row gap-4\">\n                {/* Barra de búsqueda */}\n                <div className=\"relative flex-1\">\n                  <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    placeholder=\"Buscar propuestas...\"\n                    className=\"pl-10\"\n                    data-testid=\"input-search-proposals\"\n                  />\n                </div>\n\n                {/* Filtros */}\n                <div className=\"flex gap-2\">\n                  <Select defaultValue=\"todas\">\n                    <SelectTrigger className=\"w-[180px]\" data-testid=\"select-category\">\n                      <SelectValue placeholder=\"Categoría\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {categorias.map((categoria) => (\n                        <SelectItem key={categoria} value={categoria.toLowerCase()}>\n                          {categoria}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n\n                  <Select defaultValue=\"recientes\">\n                    <SelectTrigger className=\"w-[180px]\" data-testid=\"select-sort\">\n                      <SelectValue placeholder=\"Ordenar por\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"recientes\">Más recientes</SelectItem>\n                      <SelectItem value=\"populares\">Más populares</SelectItem>\n                      <SelectItem value=\"apoyos\">Más apoyadas</SelectItem>\n                      <SelectItem value=\"comentarios\">Más comentadas</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* Categorías populares */}\n              <div className=\"flex flex-wrap gap-2\">\n                <span className=\"text-sm text-muted-foreground\">Categorías:</span>\n                {[\"Medio Ambiente\", \"Transporte\", \"Educación\", \"Salud\", \"Tecnología\"].map((cat) => (\n                  <Badge\n                    key={cat}\n                    variant=\"outline\"\n                    className=\"cursor-pointer hover-elevate\"\n                    data-testid={`badge-category-${cat}`}\n                  >\n                    {cat}\n                  </Badge>\n                ))}\n              </div>\n\n              {/* Grid de Propuestas */}\n              {isLoading ? (\n                <div className=\"flex justify-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : propuestas.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <p className=\"text-muted-foreground\">No hay propuestas disponibles</p>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {propuestas.map((propuesta: any) => (\n                    <ProposalCard \n                      key={propuesta.id} \n                      {...propuesta}\n                      autorNombre={propuesta.autorNombre || \"Usuario\"}\n                      numComentarios={0}\n                      userTokensBalance={tokensBalance}\n                    />\n                  ))}\n                </div>\n              )}\n\n              {/* Paginación */}\n              <div className=\"mt-8 flex justify-center gap-2\">\n                <Button variant=\"outline\" disabled data-testid=\"button-prev-page\">\n                  Anterior\n                </Button>\n                <Button variant=\"default\">1</Button>\n                <Button variant=\"outline\">2</Button>\n                <Button variant=\"outline\">3</Button>\n                <Button variant=\"outline\" data-testid=\"button-next-page\">\n                  Siguiente\n                </Button>\n              </div>\n            </TabsContent>\n\n            {/* Los otros tabs tendrían contenido filtrado similar */}\n            <TabsContent value=\"en_deliberacion\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {propuestas\n                  .filter((p: any) => p.estado === \"en_deliberacion\")\n                  .map((propuesta: any) => (\n                    <ProposalCard \n                      key={propuesta.id} \n                      {...propuesta}\n                      autorNombre={propuesta.autorNombre || \"Usuario\"}\n                      numComentarios={0}\n                      userTokensBalance={tokensBalance}\n                    />\n                  ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"votacion\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {propuestas\n                  .filter((p: any) => p.estado === \"votacion\")\n                  .map((propuesta: any) => (\n                    <ProposalCard \n                      key={propuesta.id} \n                      {...propuesta}\n                      autorNombre={propuesta.autorNombre || \"Usuario\"}\n                      numComentarios={0}\n                      userTokensBalance={tokensBalance}\n                    />\n                  ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"aprobada\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {propuestas\n                  .filter((p: any) => p.estado === \"aprobada\")\n                  .map((propuesta: any) => (\n                    <ProposalCard \n                      key={propuesta.id} \n                      {...propuesta}\n                      autorNombre={propuesta.autorNombre || \"Usuario\"}\n                      numComentarios={0}\n                      userTokensBalance={tokensBalance}\n                    />\n                  ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"rechazada\">\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                {propuestas\n                  .filter((p: any) => p.estado === \"rechazada\")\n                  .map((propuesta: any) => (\n                    <ProposalCard \n                      key={propuesta.id} \n                      {...propuesta}\n                      autorNombre={propuesta.autorNombre || \"Usuario\"}\n                      numComentarios={0}\n                      userTokensBalance={tokensBalance}\n                    />\n                  ))}\n              </div>\n            </TabsContent>\n\n            <TabsContent value=\"archivada\">\n              <div className=\"text-center py-12\">\n                <p className=\"text-muted-foreground\">No hay propuestas archivadas</p>\n              </div>\n            </TabsContent>\n          </Tabs>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":10019},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/pages/Contacto.tsx":{"content":"// Página de contacto para Neurolex\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Button } from \"@/components/ui/button\";\nimport { Mail, Phone, MapPin, Send } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nconst contactSchema = z.object({\n  nombre: z.string().min(2, \"El nombre debe tener al menos 2 caracteres\"),\n  email: z.string().email(\"El correo electrónico no es válido\"),\n  asunto: z.string().min(5, \"El asunto debe tener al menos 5 caracteres\"),\n  mensaje: z.string().min(10, \"El mensaje debe tener al menos 10 caracteres\"),\n});\n\ntype ContactFormValues = z.infer<typeof contactSchema>;\n\nexport default function Contacto() {\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n\n  // Obtener userId del localStorage\n  const userId = localStorage.getItem(\"userId\");\n\n  // Cargar datos del usuario si está autenticado\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens si está autenticado\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const form = useForm<ContactFormValues>({\n    resolver: zodResolver(contactSchema),\n    defaultValues: {\n      nombre: \"\",\n      email: \"\",\n      asunto: \"\",\n      mensaje: \"\",\n    },\n  });\n\n  const onSubmit = async (data: ContactFormValues) => {\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/contact\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(data),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || \"Error al enviar mensaje\");\n      }\n\n      toast({\n        title: \"Mensaje enviado\",\n        description: result.message || \"Gracias por contactarnos. Te responderemos pronto.\",\n      });\n      \n      form.reset();\n    } catch (error: any) {\n      console.error(\"Error al enviar contacto:\", error);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Error al enviar mensaje. Inténtalo de nuevo.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-12\">\n          {/* Header */}\n          <div className=\"text-center mb-12\">\n            <h1 className=\"text-4xl md:text-5xl font-bold font-[Poppins] mb-4\" data-testid=\"text-page-title\">\n              Contáctanos\n            </h1>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              ¿Tienes alguna pregunta o sugerencia? Estamos aquí para ayudarte.\n              Envíanos un mensaje y te responderemos lo antes posible.\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            {/* Información de contacto */}\n            <div className=\"space-y-6\">\n              <Card className=\"hover-elevate\">\n                <CardHeader>\n                  <div className=\"mb-2 p-3 rounded-full bg-primary/10 w-fit\">\n                    <Mail className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">Correo Electrónico</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <a href=\"mailto:contacto@neurolex.com\" className=\"text-primary hover:underline\">\n                    contacto@neurolex.com\n                  </a>\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                    Responderemos en 24-48 horas\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover-elevate\">\n                <CardHeader>\n                  <div className=\"mb-2 p-3 rounded-full bg-primary/10 w-fit\">\n                    <Phone className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">Teléfono</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <a href=\"tel:+34900123456\" className=\"text-primary hover:underline\">\n                    +34 900 123 456\n                  </a>\n                  <p className=\"text-sm text-muted-foreground mt-2\">\n                    Lun - Vie, 9:00 - 18:00\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"hover-elevate\">\n                <CardHeader>\n                  <div className=\"mb-2 p-3 rounded-full bg-primary/10 w-fit\">\n                    <MapPin className=\"h-6 w-6 text-primary\" />\n                  </div>\n                  <CardTitle className=\"text-lg\">Dirección</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"text-sm\">\n                    Calle Principal 123<br />\n                    28001 Madrid, España\n                  </p>\n                </CardContent>\n              </Card>\n\n              {/* Redes Sociales */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Síguenos</CardTitle>\n                  <CardDescription>\n                    Mantente al día con nuestras novedades\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"flex gap-3\">\n                    <Button variant=\"outline\" size=\"icon\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z\" />\n                      </svg>\n                    </Button>\n                    <Button variant=\"outline\" size=\"icon\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path fillRule=\"evenodd\" d=\"M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z\" clipRule=\"evenodd\" />\n                      </svg>\n                    </Button>\n                    <Button variant=\"outline\" size=\"icon\">\n                      <svg className=\"h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path d=\"M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z\" />\n                      </svg>\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            {/* Formulario de contacto */}\n            <div className=\"lg:col-span-2\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-2xl\">Envíanos un Mensaje</CardTitle>\n                  <CardDescription>\n                    Completa el formulario y nos pondremos en contacto contigo\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <Form {...form}>\n                    <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <FormField\n                          control={form.control}\n                          name=\"nombre\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Nombre Completo</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Juan Pérez\" {...field} data-testid=\"input-nombre\" />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n\n                        <FormField\n                          control={form.control}\n                          name=\"email\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Correo Electrónico</FormLabel>\n                              <FormControl>\n                                <Input\n                                  type=\"email\"\n                                  placeholder=\"juan@ejemplo.com\"\n                                  {...field}\n                                  data-testid=\"input-email\"\n                                />\n                              </FormControl>\n                              <FormMessage />\n                            </FormItem>\n                          )}\n                        />\n                      </div>\n\n                      <FormField\n                        control={form.control}\n                        name=\"asunto\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Asunto</FormLabel>\n                            <FormControl>\n                              <Input\n                                placeholder=\"¿En qué podemos ayudarte?\"\n                                {...field}\n                                data-testid=\"input-asunto\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"mensaje\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Mensaje</FormLabel>\n                            <FormControl>\n                              <Textarea\n                                placeholder=\"Escribe tu mensaje aquí...\"\n                                className=\"min-h-40 resize-none\"\n                                {...field}\n                                data-testid=\"input-mensaje\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <Button\n                        type=\"submit\"\n                        className=\"w-full\"\n                        disabled={isLoading}\n                        data-testid=\"button-submit-contact\"\n                      >\n                        {isLoading ? (\n                          \"Enviando...\"\n                        ) : (\n                          <>\n                            <Send className=\"h-4 w-4 mr-2\" />\n                            Enviar Mensaje\n                          </>\n                        )}\n                      </Button>\n                    </form>\n                  </Form>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":12681},"client/src/pages/Dashboard.tsx":{"content":"// Panel de control personalizable para usuarios de Neurolex\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { TokenCard } from \"@/components/TokenCard\";\nimport { ProposalCard } from \"@/components/ProposalCard\";\nimport { NewsCard } from \"@/components/NewsCard\";\nimport { PollCard } from \"@/components/PollCard\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { TrendingUp, Award, Clock, Loader2 } from \"lucide-react\";\nimport { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n\n  // Obtener userId del localStorage\n  const userId = localStorage.getItem(\"userId\");\n\n  // Redirigir al login si no está autenticado\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  // Cargar datos del usuario\n  const { data: user, isLoading: loadingUser } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens\n  const { data: tokensBalance, isLoading: loadingTokens } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar propuestas\n  const { data: propuestas = [], isLoading: loadingPropuestas } = useQuery({\n    queryKey: [\"/api/proposals\"],\n  });\n\n  // Cargar noticias\n  const { data: noticias = [], isLoading: loadingNoticias } = useQuery({\n    queryKey: [\"/api/news\"],\n  });\n\n  // Cargar sondeos\n  const { data: sondeos = [], isLoading: loadingSondeos } = useQuery({\n    queryKey: [\"/api/polls\"],\n  });\n\n  if (loadingUser || !user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  const progressToNextLevel = ((user.karmaTotal % 500) / 500) * 100;\n\n  // Tomar las primeras 2 propuestas\n  const propuestasActivas = propuestas.slice(0, 2);\n\n  // Tomar la primera noticia\n  const noticiasRecientes = noticias.slice(0, 1);\n\n  // Tomar el primer sondeo activo\n  const sondeoActivo = sondeos.length > 0 ? sondeos[0] : null;\n\n  // Insignias (datos estáticos por ahora)\n  const insignias = [\n    { nombre: \"Votante Fundador\", obtenida: true },\n    { nombre: \"Legislador Ciudadano\", obtenida: true },\n    { nombre: \"Experto en Debate\", obtenida: false },\n    { nombre: \"Influencer Cívico\", obtenida: false },\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header del Dashboard */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-2\" data-testid=\"text-dashboard-title\">\n              Bienvenido, {user.username}\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Aquí está tu resumen de actividad y contenido personalizado\n            </p>\n          </div>\n\n          {/* Grid de Widgets */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Columna izquierda - 2/3 */}\n            <div className=\"lg:col-span-2 space-y-6\">\n              {/* Mi Cartera - Tokens */}\n              <section>\n                <h2 className=\"text-xl font-semibold font-[Poppins] mb-4\">\n                  Mi Cartera\n                </h2>\n                {loadingTokens ? (\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    {[1, 2, 3].map((i) => (\n                      <Card key={i} className=\"h-32 flex items-center justify-center\">\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                      </Card>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                    <TokenCard\n                      tipo=\"TP\"\n                      cantidad={tokensBalance?.tokensParticipacion || 0}\n                      descripcion=\"Ganados por participación\"\n                    />\n                    <TokenCard\n                      tipo=\"TA\"\n                      cantidad={tokensBalance?.tokensApoyo || 0}\n                      descripcion=\"Disponibles para apoyo\"\n                    />\n                    <TokenCard\n                      tipo=\"TGR\"\n                      cantidad={tokensBalance?.tokensGobernanza || 0}\n                      descripcion=\"Poder de gobernanza\"\n                    />\n                  </div>\n                )}\n              </section>\n\n              {/* Propuestas Activas */}\n              <section>\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h2 className=\"text-xl font-semibold font-[Poppins]\">\n                    Propuestas que te pueden interesar\n                  </h2>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={() => setLocation(\"/propuestas\")} data-testid=\"button-view-all-proposals\">\n                    Ver todas\n                  </Button>\n                </div>\n                {loadingPropuestas ? (\n                  <div className=\"grid grid-cols-1 gap-4\">\n                    {[1, 2].map((i) => (\n                      <Card key={i} className=\"h-48 flex items-center justify-center\">\n                        <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                      </Card>\n                    ))}\n                  </div>\n                ) : propuestasActivas.length === 0 ? (\n                  <Card className=\"p-8 text-center text-muted-foreground\">\n                    No hay propuestas disponibles\n                  </Card>\n                ) : (\n                  <div className=\"grid grid-cols-1 gap-4\">\n                    {propuestasActivas.map((propuesta: any) => (\n                      <ProposalCard \n                        key={propuesta.id} \n                        {...propuesta}\n                        autorNombre={propuesta.autorNombre || \"Usuario\"}\n                        numComentarios={0}\n                      />\n                    ))}\n                  </div>\n                )}\n              </section>\n\n              {/* Sondeo Activo */}\n              {sondeoActivo && (\n                <section>\n                  <h2 className=\"text-xl font-semibold font-[Poppins] mb-4\">\n                    Sondeo Activo\n                  </h2>\n                  {loadingSondeos ? (\n                    <Card className=\"h-64 flex items-center justify-center\">\n                      <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                    </Card>\n                  ) : (\n                    <PollCard {...sondeoActivo} hasVoted={false} />\n                  )}\n                </section>\n              )}\n            </div>\n\n            {/* Columna derecha - 1/3 */}\n            <div className=\"space-y-6\">\n              {/* Mi Karma */}\n              <Card data-testid=\"card-karma\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"h-5 w-5 text-primary\" />\n                    Mi Karma\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-center mb-4\">\n                    <p className=\"text-5xl font-bold font-mono text-primary mb-2\" data-testid=\"text-karma-total\">\n                      {user.karmaTotal}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">Puntos totales</p>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <div className=\"flex items-center justify-between text-sm\">\n                      <span className=\"text-muted-foreground\">Nivel {user.nivelGamificacion}</span>\n                      <span className=\"font-semibold\">Nivel {user.nivelGamificacion + 1}</span>\n                    </div>\n                    <Progress value={progressToNextLevel} className=\"h-2\" />\n                    <p className=\"text-xs text-muted-foreground text-center\">\n                      {500 - (user.karmaTotal % 500)} puntos para el siguiente nivel\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Insignias */}\n              <Card data-testid=\"card-badges\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Award className=\"h-5 w-5 text-primary\" />\n                    Insignias\n                  </CardTitle>\n                  <CardDescription>\n                    {insignias.filter(i => i.obtenida).length} de {insignias.length} desbloqueadas\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    {insignias.map((insignia, index) => (\n                      <div\n                        key={index}\n                        className={`p-3 rounded-md border text-center ${\n                          insignia.obtenida\n                            ? \"bg-primary/10 border-primary/20\"\n                            : \"bg-muted border-border opacity-50\"\n                        }`}\n                        data-testid={`badge-item-${index}`}\n                      >\n                        <Award className={`h-6 w-6 mx-auto mb-1 ${insignia.obtenida ? \"text-primary\" : \"text-muted-foreground\"}`} />\n                        <p className=\"text-xs font-medium\">{insignia.nombre}</p>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Noticias Recientes */}\n              <section>\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h2 className=\"text-lg font-semibold font-[Poppins]\">\n                    Noticias Recientes\n                  </h2>\n                  <Button variant=\"ghost\" size=\"sm\" onClick={() => setLocation(\"/noticias\")} data-testid=\"button-view-all-news\">\n                    Ver todas\n                  </Button>\n                </div>\n                {loadingNoticias ? (\n                  <Card className=\"h-32 flex items-center justify-center\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                  </Card>\n                ) : noticiasRecientes.length === 0 ? (\n                  <Card className=\"p-6 text-center text-sm text-muted-foreground\">\n                    No hay noticias recientes\n                  </Card>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {noticiasRecientes.map((noticia: any) => (\n                      <NewsCard key={noticia.id} {...noticia} />\n                    ))}\n                  </div>\n                )}\n              </section>\n\n              {/* Actividad Próxima */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Clock className=\"h-5 w-5 text-primary\" />\n                    Próximas Votaciones\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"flex items-start gap-3 p-3 rounded-md bg-muted\">\n                    <div className=\"flex-shrink-0\">\n                      <Badge variant=\"default\">3 días</Badge>\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium\">Presupuesto Municipal 2025</p>\n                      <p className=\"text-xs text-muted-foreground\">Votación vinculante</p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-start gap-3 p-3 rounded-md bg-muted\">\n                    <div className=\"flex-shrink-0\">\n                      <Badge variant=\"secondary\">7 días</Badge>\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium\">Reforma del transporte público</p>\n                      <p className=\"text-xs text-muted-foreground\">Sondeo ciudadano</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":12746},"server/routes.ts":{"content":"// Rutas API para la plataforma Neurolex\n// Todas las respuestas y mensajes de error están en español\nimport type { Express, Request, Response } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { insertUserSchema, insertNewsSchema, insertProposalSchema, insertPollSchema, insertPollOptionSchema, insertDebateSchema, insertCommentSchema, insertContactSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { fromZodError } from \"zod-validation-error\";\nimport bcrypt from \"bcrypt\";\n\n// Helper para validar datos con Zod\nfunction validateRequest<T>(schema: z.ZodSchema<T>, data: any): { success: boolean; data?: T; error?: string } {\n  try {\n    const validated = schema.parse(data);\n    return { success: true, data: validated };\n  } catch (error) {\n    if (error instanceof z.ZodError) {\n      const validationError = fromZodError(error, { prefix: null });\n      return { success: false, error: validationError.message };\n    }\n    return { success: false, error: \"Error de validación\" };\n  }\n}\n\n// Middleware para requerir autenticación\nfunction requireAuth(req: Request, res: Response, next: any) {\n  if (!req.session.userId) {\n    return res.status(401).json({ error: \"Debes iniciar sesión\" });\n  }\n  next();\n}\n\n// Middleware para requerir rol de admin\nfunction requireAdmin(req: Request, res: Response, next: any) {\n  if (!req.session.userId) {\n    return res.status(401).json({ error: \"Debes iniciar sesión\" });\n  }\n  // La verificación de isAdmin se hace en el handler\n  next();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // ===========================================================================\n  // AUTENTICACIÓN\n  // ===========================================================================\n\n  // Registro de usuarios\n  app.post(\"/api/auth/register\", async (req: Request, res: Response) => {\n    try {\n      const validation = validateRequest(insertUserSchema, req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const { username, email, password, ...rest } = validation.data!;\n\n      // Verificar si el usuario ya existe\n      const existingUser = await storage.getUserByEmail(email);\n      if (existingUser) {\n        return res.status(400).json({ error: \"El correo electrónico ya está registrado\" });\n      }\n\n      const existingUsername = await storage.getUserByUsername(username);\n      if (existingUsername) {\n        return res.status(400).json({ error: \"El nombre de usuario ya existe\" });\n      }\n\n      // Encriptar contraseña\n      const hashedPassword = await bcrypt.hash(password, 10);\n\n      // Crear usuario\n      const user = await storage.createUser({\n        username,\n        email,\n        password: hashedPassword,\n        ...rest,\n      });\n\n      // Dar tokens de bienvenida\n      await storage.updateTokensBalance(user.id, {\n        tokensParticipacion: 100, // Tokens de bienvenida\n      });\n\n      // Dar karma inicial\n      await storage.addKarma(user.id, 50, \"Bienvenida a Neurolex\");\n\n      // Guardar userId en sesión\n      req.session.userId = user.id;\n\n      // No devolver la contraseña\n      const { password: _, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Error en registro:\", error);\n      res.status(500).json({ error: \"Error al registrar usuario\" });\n    }\n  });\n\n  // Inicio de sesión\n  app.post(\"/api/auth/login\", async (req: Request, res: Response) => {\n    try {\n      const { email, password } = req.body;\n\n      if (!email || !password) {\n        return res.status(400).json({ error: \"Correo y contraseña son requeridos\" });\n      }\n\n      const user = await storage.getUserByEmail(email);\n      if (!user) {\n        return res.status(401).json({ error: \"Credenciales inválidas\" });\n      }\n\n      const isValidPassword = await bcrypt.compare(password, user.password);\n      if (!isValidPassword) {\n        return res.status(401).json({ error: \"Credenciales inválidas\" });\n      }\n\n      // Guardar userId en sesión\n      req.session.userId = user.id;\n\n      // No devolver la contraseña\n      const { password: _, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Error en login:\", error);\n      res.status(500).json({ error: \"Error al iniciar sesión\" });\n    }\n  });\n\n  // ===========================================================================\n  // USUARIOS\n  // ===========================================================================\n\n  // Obtener información del usuario actual\n  app.get(\"/api/users/me\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"Usuario no encontrado\" });\n      }\n\n      const { password: _, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Error al obtener usuario:\", error);\n      res.status(500).json({ error: \"Error al obtener información del usuario\" });\n    }\n  });\n\n  // Backward compatibility: ruta antigua (deprecated)\n  app.get(\"/api/users/me/:userId\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"Usuario no encontrado\" });\n      }\n\n      const { password: _, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Error al obtener usuario:\", error);\n      res.status(500).json({ error: \"Error al obtener información del usuario\" });\n    }\n  });\n\n  // ===========================================================================\n  // TOKENS\n  // ===========================================================================\n\n  // Obtener balance de tokens del usuario autenticado\n  app.get(\"/api/tokens\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const balance = await storage.getTokensBalance(userId);\n      res.json(balance);\n    } catch (error) {\n      console.error(\"Error al obtener balance de tokens:\", error);\n      res.status(500).json({ error: \"Error al obtener balance de tokens\" });\n    }\n  });\n\n  // Backward compatibility: ruta antigua (deprecated)\n  app.get(\"/api/tokens/:userId\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const balance = await storage.getTokensBalance(userId);\n      res.json(balance);\n    } catch (error) {\n      console.error(\"Error al obtener balance de tokens:\", error);\n      res.status(500).json({ error: \"Error al obtener balance de tokens\" });\n    }\n  });\n\n  // Vincular wallet de MetaMask al usuario (CON VERIFICACIÓN DE FIRMA)\n  app.post(\"/api/users/link-wallet\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const { walletAddress, message, signature } = req.body;\n\n      if (!walletAddress || !message || !signature) {\n        return res.status(400).json({ error: \"Wallet, mensaje y firma requeridos\" });\n      }\n\n      // Validar formato de dirección Ethereum\n      if (!walletAddress.match(/^0x[a-fA-F0-9]{40}$/)) {\n        return res.status(400).json({ error: \"Formato de dirección Ethereum inválido\" });\n      }\n\n      // Verificar que el usuario existe\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"Usuario no encontrado\" });\n      }\n\n      // CRÍTICO: Verificar firma criptográfica para demostrar propiedad de la wallet\n      const { verifyMessage } = await import(\"ethers\");\n      try {\n        const recoveredAddress = verifyMessage(message, signature);\n        \n        // Validar que la firma corresponda a la wallet\n        if (recoveredAddress.toLowerCase() !== walletAddress.toLowerCase()) {\n          return res.status(403).json({ \n            error: \"Firma inválida. No puedes demostrar propiedad de esta wallet.\" \n          });\n        }\n\n        // CRÍTICO: Validar que el mensaje incluya el userId correcto\n        // Esto previene que un atacante firme con su wallet y la vincule a otro userId\n        if (!message.includes(`Usuario: ${userId}`)) {\n          return res.status(403).json({ \n            error: \"El mensaje firmado no corresponde a este usuario\" \n          });\n        }\n\n        console.log(`✅ Firma verificada para wallet ${walletAddress} y usuario ${userId}`);\n      } catch (error) {\n        console.error(\"Error al verificar firma:\", error);\n        return res.status(403).json({ error: \"Firma inválida o corrupta\" });\n      }\n\n      // TODO: Verificar que la wallet no esté ya vinculada a otro usuario\n      // Para implementar esto, se necesitaría agregar getUserByWallet al storage\n\n      // Vincular wallet al usuario (solo después de verificar firma)\n      const updatedUser = await storage.updateUser(userId, {\n        walletAddress: walletAddress.toLowerCase(), // Normalizar a minúsculas\n      });\n\n      console.log(`Wallet ${walletAddress} vinculada exitosamente al usuario ${userId}`);\n\n      res.json({\n        success: true,\n        message: \"Wallet vinculada exitosamente\",\n        walletAddress: updatedUser?.walletAddress,\n      });\n    } catch (error: any) {\n      console.error(\"Error al vincular wallet:\", error);\n      res.status(500).json({ error: error.message || \"Error al vincular wallet\" });\n    }\n  });\n\n  // ===========================================================================\n  // TOKENS\n  // ===========================================================================\n\n  // Obtener balance de tokens de un usuario\n  app.get(\"/api/tokens/:userId\", async (req: Request, res: Response) => {\n    try {\n      const { userId } = req.params;\n      const balance = await storage.getTokensBalance(userId);\n      \n      if (!balance) {\n        // Crear balance si no existe\n        const newBalance = await storage.createTokensBalance(userId);\n        return res.json(newBalance);\n      }\n\n      res.json(balance);\n    } catch (error) {\n      console.error(\"Error al obtener tokens:\", error);\n      res.status(500).json({ error: \"Error al obtener balance de tokens\" });\n    }\n  });\n\n  // Obtener historial de transacciones del usuario autenticado\n  app.get(\"/api/transactions\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const transactions = await storage.getTokenTransactions(userId);\n      res.json(transactions);\n    } catch (error) {\n      console.error(\"Error al obtener transacciones:\", error);\n      res.status(500).json({ error: \"Error al obtener historial de transacciones\" });\n    }\n  });\n\n  // Backward compatibility: ruta antigua (deprecated)\n  app.get(\"/api/transactions/:userId\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const transactions = await storage.getTokenTransactions(userId);\n      res.json(transactions);\n    } catch (error) {\n      console.error(\"Error al obtener transacciones:\", error);\n      res.status(500).json({ error: \"Error al obtener historial de transacciones\" });\n    }\n  });\n\n  // Procesar compra de tokens con criptomonedas (CON VERIFICACIÓN BLOCKCHAIN)\n  app.post(\"/api/tokens/purchase\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const { taAmount, ethAmount, txHash } = req.body;\n\n      // 1. Validar datos básicos\n      if (!taAmount || !ethAmount || !txHash) {\n        return res.status(400).json({ error: \"Datos incompletos para la compra\" });\n      }\n\n      // 2. Validar parámetros de compra (rangos, congruencia TA↔ETH)\n      const { verifyTransaction, validatePurchaseParams } = await import(\"./blockchain-verifier\");\n      const { BLOCKCHAIN_CONFIG } = await import(\"../shared/blockchain-config\");\n      \n      const paramValidation = validatePurchaseParams(taAmount, ethAmount);\n      if (!paramValidation.valid) {\n        return res.status(400).json({ error: paramValidation.error });\n      }\n\n      // 3. Validar que el usuario existe\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ error: \"Usuario no encontrado\" });\n      }\n\n      // 3.5 CRÍTICO: Validar que el usuario tenga una wallet vinculada\n      if (!user.walletAddress) {\n        return res.status(400).json({ \n          error: \"Debes vincular tu wallet de MetaMask antes de comprar tokens. Conecta tu wallet primero.\" \n        });\n      }\n\n      // 4. VERIFICAR TRANSACCIÓN EN LA BLOCKCHAIN (CRÍTICO)\n      console.log(`Verificando transacción blockchain: ${txHash} desde ${user.walletAddress}`);\n      const verification = await verifyTransaction(\n        txHash,\n        ethAmount,\n        BLOCKCHAIN_CONFIG.platformWallet,\n        user.walletAddress // CRÍTICO: Validar que tx.from coincida con la wallet del usuario\n      );\n\n      if (!verification.valid) {\n        console.error(`Verificación blockchain falló: ${verification.error}`);\n        return res.status(400).json({ \n          error: verification.error || \"Transacción blockchain inválida\" \n        });\n      }\n\n      console.log(`✅ Transacción verificada exitosamente: ${txHash}`);\n\n      // 5. Verificar que el txHash no haya sido usado antes (doble verificación con BD)\n      const existingTx = await storage.getTransactionByHash(txHash);\n      if (existingTx) {\n        return res.status(400).json({ \n          error: \"Esta transacción ya fue procesada anteriormente\" \n        });\n      }\n\n      // 6. Obtener o crear balance de tokens\n      let balance = await storage.getTokensBalance(userId);\n      if (!balance) {\n        balance = await storage.createTokensBalance(userId);\n      }\n\n      // 7. Actualizar balance (agregar TA tokens)\n      const newBalance = await storage.updateTokensBalance(userId, {\n        tokensApoyo: balance.tokensApoyo + taAmount,\n      });\n\n      // 8. Registrar transacción con txHash para prevenir duplicados\n      await storage.createTokenTransaction({\n        userId,\n        tipoToken: \"TA\",\n        cantidad: taAmount,\n        tipoTransaccion: \"comprado\",\n        descripcion: `Compra de ${taAmount} TA por ${ethAmount} ETH`,\n        relacionadoId: txHash, // Guardamos el hash completo\n      });\n\n      res.json({\n        success: true,\n        balance: newBalance,\n        message: `Compra exitosa: ${taAmount} TA tokens agregados`,\n        txHash,\n      });\n    } catch (error: any) {\n      console.error(\"Error al procesar compra de tokens:\", error);\n      res.status(500).json({ \n        error: error.message || \"Error al procesar la compra\" \n      });\n    }\n  });\n\n  // ===========================================================================\n  // KARMA\n  // ===========================================================================\n\n  // Obtener historial de karma de un usuario\n  app.get(\"/api/karma/:userId\", async (req: Request, res: Response) => {\n    try {\n      const { userId } = req.params;\n      const history = await storage.getKarmaHistory(userId);\n      res.json(history);\n    } catch (error) {\n      console.error(\"Error al obtener karma:\", error);\n      res.status(500).json({ error: \"Error al obtener historial de karma\" });\n    }\n  });\n\n  // ===========================================================================\n  // NOTICIAS\n  // ===========================================================================\n\n  // Obtener todas las noticias\n  app.get(\"/api/news\", async (req: Request, res: Response) => {\n    try {\n      const noticias = await storage.getAllNews();\n      res.json(noticias);\n    } catch (error) {\n      console.error(\"Error al obtener noticias:\", error);\n      res.status(500).json({ error: \"Error al obtener noticias\" });\n    }\n  });\n\n  // Obtener una noticia por ID\n  app.get(\"/api/news/:id\", async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const noticia = await storage.getNewsById(id);\n      \n      if (!noticia) {\n        return res.status(404).json({ error: \"Noticia no encontrada\" });\n      }\n\n      res.json(noticia);\n    } catch (error) {\n      console.error(\"Error al obtener noticia:\", error);\n      res.status(500).json({ error: \"Error al obtener noticia\" });\n    }\n  });\n\n  // Crear nueva noticia\n  app.post(\"/api/news\", async (req: Request, res: Response) => {\n    try {\n      const validation = validateRequest(insertNewsSchema, req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const noticia = await storage.createNews(validation.data!);\n      res.status(201).json(noticia);\n    } catch (error) {\n      console.error(\"Error al crear noticia:\", error);\n      res.status(500).json({ error: \"Error al crear noticia\" });\n    }\n  });\n\n  // ===========================================================================\n  // PROPUESTAS\n  // ===========================================================================\n\n  // Obtener todas las propuestas\n  app.get(\"/api/proposals\", async (req: Request, res: Response) => {\n    try {\n      const propuestas = await storage.getAllProposals();\n      res.json(propuestas);\n    } catch (error) {\n      console.error(\"Error al obtener propuestas:\", error);\n      res.status(500).json({ error: \"Error al obtener propuestas\" });\n    }\n  });\n\n  // Obtener una propuesta por ID\n  app.get(\"/api/proposals/:id\", async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const propuesta = await storage.getProposalById(id);\n      \n      if (!propuesta) {\n        return res.status(404).json({ error: \"Propuesta no encontrada\" });\n      }\n\n      res.json(propuesta);\n    } catch (error) {\n      console.error(\"Error al obtener propuesta:\", error);\n      res.status(500).json({ error: \"Error al obtener propuesta\" });\n    }\n  });\n\n  // Crear nueva propuesta\n  app.post(\"/api/proposals\", async (req: Request, res: Response) => {\n    try {\n      const validation = validateRequest(insertProposalSchema, req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const propuesta = await storage.createProposal(validation.data!);\n      \n      // Dar karma al usuario por crear propuesta\n      await storage.addKarma(propuesta.autorId, 20, \"Propuesta creada\");\n\n      res.status(201).json(propuesta);\n    } catch (error) {\n      console.error(\"Error al crear propuesta:\", error);\n      res.status(500).json({ error: \"Error al crear propuesta\" });\n    }\n  });\n\n  // Apoyar una propuesta con tokens\n  app.post(\"/api/proposals/:id/support\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const userId = req.session.userId!;\n      const { tipoToken, cantidad } = req.body;\n\n      if (!tipoToken || !cantidad) {\n        return res.status(400).json({ error: \"Faltan parámetros requeridos\" });\n      }\n\n      const propuesta = await storage.getProposalById(id);\n      if (!propuesta) {\n        return res.status(404).json({ error: \"Propuesta no encontrada\" });\n      }\n\n      const balance = await storage.getTokensBalance(userId);\n      if (!balance) {\n        return res.status(404).json({ error: \"Balance de tokens no encontrado\" });\n      }\n\n      // Verificar que el usuario tenga suficientes tokens\n      if (tipoToken === \"TP\" && balance.tokensParticipacion < cantidad) {\n        return res.status(400).json({ error: \"No tienes suficientes Tokens de Participación\" });\n      }\n      if (tipoToken === \"TA\" && balance.tokensApoyo < cantidad) {\n        return res.status(400).json({ error: \"No tienes suficientes Tokens de Apoyo\" });\n      }\n\n      // Descontar tokens del usuario\n      if (tipoToken === \"TP\") {\n        await storage.updateTokensBalance(userId, {\n          tokensParticipacion: balance.tokensParticipacion - cantidad,\n        });\n        await storage.updateProposal(id, {\n          apoyosTP: propuesta.apoyosTP + cantidad,\n        });\n      } else if (tipoToken === \"TA\") {\n        await storage.updateTokensBalance(userId, {\n          tokensApoyo: balance.tokensApoyo - cantidad,\n        });\n        await storage.updateProposal(id, {\n          apoyosTA: propuesta.apoyosTA + cantidad,\n        });\n      }\n\n      // Dar karma al usuario por apoyar\n      await storage.addKarma(userId, 5, \"Propuesta apoyada\");\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error al apoyar propuesta:\", error);\n      res.status(500).json({ error: \"Error al apoyar propuesta\" });\n    }\n  });\n\n  // Donar tokens de apoyo (TA) a una propuesta\n  app.post(\"/api/proposals/donate\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const { proposalId, amount } = req.body;\n\n      if (!proposalId || !amount) {\n        return res.status(400).json({ error: \"Datos incompletos para la donación\" });\n      }\n\n      if (amount <= 0) {\n        return res.status(400).json({ error: \"La cantidad debe ser mayor a 0\" });\n      }\n\n      // Validar que la propuesta existe\n      const propuesta = await storage.getProposalById(proposalId);\n      if (!propuesta) {\n        return res.status(404).json({ error: \"Propuesta no encontrada\" });\n      }\n\n      // Obtener balance del usuario\n      const balance = await storage.getTokensBalance(userId);\n      if (!balance) {\n        return res.status(404).json({ error: \"Balance de tokens no encontrado\" });\n      }\n\n      // Verificar que el usuario tenga suficientes TA tokens\n      if (balance.tokensApoyo < amount) {\n        return res.status(400).json({ error: \"No tienes suficientes Tokens de Apoyo\" });\n      }\n\n      // Descontar TA tokens del usuario\n      await storage.updateTokensBalance(userId, {\n        tokensApoyo: balance.tokensApoyo - amount,\n      });\n\n      // Incrementar apoyos TA de la propuesta\n      await storage.updateProposal(proposalId, {\n        apoyosTA: propuesta.apoyosTA + amount,\n      });\n\n      // Registrar transacción\n      await storage.createTokenTransaction({\n        userId,\n        tipoToken: \"TA\",\n        cantidad: -amount, // Negativo porque se gasta\n        tipoTransaccion: \"gastado_apoyo\",\n        descripcion: `Donación de ${amount} TA a propuesta: ${propuesta.titulo}`,\n        relacionadoId: proposalId,\n      });\n\n      // Dar karma al usuario por donar\n      await storage.addKarma(userId, 10, \"Donación a propuesta\");\n\n      res.json({\n        success: true,\n        message: `Has donado ${amount} TA a la propuesta`,\n      });\n    } catch (error) {\n      console.error(\"Error al procesar donación:\", error);\n      res.status(500).json({ error: \"Error al procesar la donación\" });\n    }\n  });\n\n  // ===========================================================================\n  // SONDEOS\n  // ===========================================================================\n\n  // Obtener todos los sondeos\n  app.get(\"/api/polls\", async (req: Request, res: Response) => {\n    try {\n      const polls = await storage.getAllPolls();\n      \n      // Obtener opciones para cada sondeo\n      const pollsWithOptions = await Promise.all(\n        polls.map(async (poll) => {\n          const opciones = await storage.getPollOptions(poll.id);\n          return { ...poll, opciones };\n        })\n      );\n\n      res.json(pollsWithOptions);\n    } catch (error) {\n      console.error(\"Error al obtener sondeos:\", error);\n      res.status(500).json({ error: \"Error al obtener sondeos\" });\n    }\n  });\n\n  // Obtener un sondeo por ID\n  app.get(\"/api/polls/:id\", async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const poll = await storage.getPollById(id);\n      \n      if (!poll) {\n        return res.status(404).json({ error: \"Sondeo no encontrado\" });\n      }\n\n      const opciones = await storage.getPollOptions(id);\n      res.json({ ...poll, opciones });\n    } catch (error) {\n      console.error(\"Error al obtener sondeo:\", error);\n      res.status(500).json({ error: \"Error al obtener sondeo\" });\n    }\n  });\n\n  // Crear nuevo sondeo\n  app.post(\"/api/polls\", async (req: Request, res: Response) => {\n    try {\n      const { opciones, ...pollData } = req.body;\n      \n      const validation = validateRequest(insertPollSchema, pollData);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const poll = await storage.createPoll(validation.data!);\n      \n      // Crear opciones del sondeo\n      if (opciones && Array.isArray(opciones)) {\n        for (let i = 0; i < opciones.length; i++) {\n          await storage.createPollOption({\n            pollId: poll.id,\n            texto: opciones[i],\n            orden: i,\n          });\n        }\n      }\n\n      const options = await storage.getPollOptions(poll.id);\n      res.status(201).json({ ...poll, options });\n    } catch (error) {\n      console.error(\"Error al crear sondeo:\", error);\n      res.status(500).json({ error: \"Error al crear sondeo\" });\n    }\n  });\n\n  // Votar en un sondeo\n  app.post(\"/api/polls/:pollId/vote\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { pollId } = req.params;\n      const userId = req.session.userId!;\n      const { optionId } = req.body;\n\n      if (!optionId) {\n        return res.status(400).json({ error: \"Faltan parámetros requeridos\" });\n      }\n\n      await storage.vote(userId, pollId, optionId);\n      \n      // Dar tokens y karma por votar\n      const balance = await storage.getTokensBalance(userId);\n      if (balance) {\n        await storage.updateTokensBalance(userId, {\n          tokensParticipacion: balance.tokensParticipacion + 10,\n        });\n      }\n      await storage.addKarma(userId, 5, \"Voto en sondeo\");\n\n      res.json({ success: true });\n    } catch (error: any) {\n      console.error(\"Error al votar:\", error);\n      if (error.message === \"Ya has votado en este sondeo\") {\n        return res.status(400).json({ error: error.message });\n      }\n      res.status(500).json({ error: \"Error al registrar voto\" });\n    }\n  });\n\n  // Obtener los sondeos en los que el usuario ha votado\n  app.get(\"/api/polls/user/voted\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const polls = await storage.getAllPolls();\n      \n      // Verificar cada sondeo para ver si el usuario ha votado\n      const votedPolls = await Promise.all(\n        polls.map(async (poll) => {\n          const hasVoted = await storage.hasUserVoted(userId, poll.id);\n          return hasVoted ? poll.id : null;\n        })\n      );\n      \n      const votedPollIds = votedPolls.filter((id): id is string => id !== null);\n      res.json(votedPollIds);\n    } catch (error) {\n      console.error(\"Error al obtener sondeos votados:\", error);\n      res.status(500).json({ error: \"Error al obtener sondeos votados\" });\n    }\n  });\n\n  // Backward compatibility: ruta antigua (deprecated)\n  app.get(\"/api/polls/user/:userId/voted\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const polls = await storage.getAllPolls();\n      \n      // Verificar cada sondeo para ver si el usuario ha votado\n      const votedPolls = await Promise.all(\n        polls.map(async (poll) => {\n          const hasVoted = await storage.hasUserVoted(userId, poll.id);\n          return hasVoted ? poll.id : null;\n        })\n      );\n      \n      // Filtrar los nulls y devolver solo los IDs de sondeos votados\n      const votedPollIds = votedPolls.filter((id) => id !== null);\n      res.json(votedPollIds);\n    } catch (error) {\n      console.error(\"Error al obtener votos del usuario:\", error);\n      res.status(500).json({ error: \"Error al obtener votos\" });\n    }\n  });\n\n  // ===========================================================================\n  // COMENTARIOS\n  // ===========================================================================\n\n  // Obtener comentarios de una propuesta\n  app.get(\"/api/comments/proposal/:propuestaId\", async (req: Request, res: Response) => {\n    try {\n      const { propuestaId } = req.params;\n      const comentarios = await storage.getCommentsByProposal(propuestaId);\n      res.json(comentarios);\n    } catch (error) {\n      console.error(\"Error al obtener comentarios:\", error);\n      res.status(500).json({ error: \"Error al obtener comentarios\" });\n    }\n  });\n\n  // Obtener comentarios de una noticia\n  app.get(\"/api/comments/news/:noticiaId\", async (req: Request, res: Response) => {\n    try {\n      const { noticiaId } = req.params;\n      const comentarios = await storage.getCommentsByNews(noticiaId);\n      res.json(comentarios);\n    } catch (error) {\n      console.error(\"Error al obtener comentarios:\", error);\n      res.status(500).json({ error: \"Error al obtener comentarios\" });\n    }\n  });\n\n  // Crear comentario\n  app.post(\"/api/comments\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const userId = req.session.userId!;\n      const commentData = { ...req.body, autorId: userId };\n      \n      const validation = validateRequest(insertCommentSchema, commentData);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const comentario = await storage.createComment(validation.data!);\n      \n      // Dar karma por comentar\n      await storage.addKarma(userId, 2, \"Comentario creado\");\n\n      res.status(201).json(comentario);\n    } catch (error) {\n      console.error(\"Error al crear comentario:\", error);\n      res.status(500).json({ error: \"Error al crear comentario\" });\n    }\n  });\n\n  // ===========================================================================\n  // CONTACTO\n  // ===========================================================================\n\n  // Enviar formulario de contacto\n  app.post(\"/api/contact\", async (req: Request, res: Response) => {\n    try {\n      const validation = validateRequest(insertContactSchema, req.body);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const contact = await storage.createContact(validation.data!);\n      res.status(201).json({ \n        success: true,\n        message: \"Mensaje enviado correctamente. Te responderemos pronto.\",\n        contact\n      });\n    } catch (error) {\n      console.error(\"Error al enviar contacto:\", error);\n      res.status(500).json({ error: \"Error al enviar mensaje de contacto\" });\n    }\n  });\n\n  // ===========================================================================\n  // DEBATES\n  // ===========================================================================\n\n  // Obtener todos los debates\n  app.get(\"/api/debates\", async (req: Request, res: Response) => {\n    try {\n      const debates = await storage.getAllDebates();\n      res.json(debates);\n    } catch (error) {\n      console.error(\"Error al obtener debates:\", error);\n      res.status(500).json({ error: \"Error al obtener debates\" });\n    }\n  });\n\n  // Obtener un debate por ID\n  app.get(\"/api/debates/:id\", async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const debate = await storage.getDebateById(id);\n      \n      if (!debate) {\n        return res.status(404).json({ error: \"Debate no encontrado\" });\n      }\n\n      // Incrementar vistas\n      await storage.incrementDebateViews(id);\n\n      res.json(debate);\n    } catch (error) {\n      console.error(\"Error al obtener debate:\", error);\n      res.status(500).json({ error: \"Error al obtener debate\" });\n    }\n  });\n\n  // Obtener comentarios de un debate\n  app.get(\"/api/debates/:id/comments\", async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const comentarios = await storage.getCommentsByDebate(id);\n      \n      // Obtener información del autor para cada comentario\n      const comentariosConAutor = await Promise.all(\n        comentarios.map(async (comentario) => {\n          const autor = await storage.getUser(comentario.autorId);\n          return {\n            ...comentario,\n            autorNombre: autor?.username || \"Anónimo\",\n          };\n        })\n      );\n\n      res.json(comentariosConAutor);\n    } catch (error) {\n      console.error(\"Error al obtener comentarios del debate:\", error);\n      res.status(500).json({ error: \"Error al obtener comentarios\" });\n    }\n  });\n\n  // Crear comentario en un debate\n  app.post(\"/api/debates/:id/comments\", requireAuth, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const userId = req.session.userId!;\n      const commentData = { ...req.body, autorId: userId, debateId: id };\n      \n      const validation = validateRequest(insertCommentSchema.extend({ debateId: z.string() }).partial({ propuestaId: true, noticiaId: true }), commentData);\n\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const comentario = await storage.createComment(validation.data!);\n\n      // Incrementar contador de respuestas del debate\n      const debate = await storage.getDebateById(id);\n      if (debate) {\n        await storage.updateDebate(id, {\n          numRespuestas: (debate.numRespuestas || 0) + 1,\n        });\n      }\n\n      // Dar karma por comentar\n      await storage.addKarma(userId, 2, \"Comentario en debate\");\n\n      res.status(201).json(comentario);\n    } catch (error) {\n      console.error(\"Error al crear comentario:\", error);\n      res.status(500).json({ error: \"Error al crear comentario\" });\n    }\n  });\n\n  // ===========================================================================\n  // ADMINISTRACIÓN\n  // ===========================================================================\n\n  // Middleware para verificar si el usuario es administrador\n  const isAdmin = async (req: Request, res: Response, next: Function) => {\n    try {\n      const userId = req.session.userId;\n      if (!userId) {\n        return res.status(401).json({ error: \"No autenticado\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user || !user.isAdmin) {\n        return res.status(403).json({ error: \"No tienes permisos de administrador\" });\n      }\n\n      next();\n    } catch (error) {\n      console.error(\"Error en middleware de admin:\", error);\n      res.status(500).json({ error: \"Error al verificar permisos\" });\n    }\n  };\n\n  // --- NOTICIAS (Admin) ---\n\n  // Crear noticia (Admin)\n  app.post(\"/api/admin/news\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { adminId, ...newsData } = req.body;\n      const validation = validateRequest(insertNewsSchema, newsData);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const news = await storage.createNews(validation.data!);\n      res.status(201).json(news);\n    } catch (error) {\n      console.error(\"Error al crear noticia:\", error);\n      res.status(500).json({ error: \"Error al crear noticia\" });\n    }\n  });\n\n  // Editar noticia (Admin)\n  app.put(\"/api/admin/news/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { adminId, ...newsData } = req.body;\n      \n      const updated = await storage.updateNews(id, newsData);\n      if (!updated) {\n        return res.status(404).json({ error: \"Noticia no encontrada\" });\n      }\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error al actualizar noticia:\", error);\n      res.status(500).json({ error: \"Error al actualizar noticia\" });\n    }\n  });\n\n  // Eliminar noticia (Admin)\n  app.delete(\"/api/admin/news/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      await storage.deleteNews(id);\n      res.json({ success: true, message: \"Noticia eliminada correctamente\" });\n    } catch (error) {\n      console.error(\"Error al eliminar noticia:\", error);\n      res.status(500).json({ error: \"Error al eliminar noticia\" });\n    }\n  });\n\n  // --- PROPUESTAS (Admin) ---\n\n  // Cambiar estado de propuesta (Admin)\n  app.put(\"/api/admin/proposals/:id/status\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { estado } = req.body;\n\n      const updated = await storage.updateProposal(id, { estado });\n      if (!updated) {\n        return res.status(404).json({ error: \"Propuesta no encontrada\" });\n      }\n\n      res.json(updated);\n    } catch (error) {\n      console.error(\"Error al actualizar estado de propuesta:\", error);\n      res.status(500).json({ error: \"Error al actualizar estado de propuesta\" });\n    }\n  });\n\n  // Eliminar propuesta (Admin)\n  app.delete(\"/api/admin/proposals/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      await storage.deleteProposal(id);\n      res.json({ success: true, message: \"Propuesta eliminada correctamente\" });\n    } catch (error) {\n      console.error(\"Error al eliminar propuesta:\", error);\n      res.status(500).json({ error: \"Error al eliminar propuesta\" });\n    }\n  });\n\n  // --- SONDEOS (Admin) ---\n\n  // Crear sondeo completo con opciones (Admin)\n  app.post(\"/api/admin/polls\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { adminId, opciones, fechaFin, ...pollData } = req.body;\n      \n      // Convertir fechaFin de string a Date o null\n      const parsedFechaFin = fechaFin && fechaFin.trim() !== \"\" ? new Date(fechaFin) : null;\n      \n      const finalPollData = {\n        ...pollData,\n        fechaFin: parsedFechaFin,\n      };\n      \n      // Crear el sondeo\n      const poll = await storage.createPoll(finalPollData);\n      \n      // Crear las opciones\n      if (opciones && Array.isArray(opciones)) {\n        for (const opcion of opciones) {\n          await storage.createPollOption({\n            pollId: poll.id,\n            texto: opcion,\n          });\n        }\n      }\n\n      res.status(201).json(poll);\n    } catch (error) {\n      console.error(\"Error al crear sondeo:\", error);\n      res.status(500).json({ error: \"Error al crear sondeo\" });\n    }\n  });\n\n  // Editar sondeo (Admin)\n  app.put(\"/api/admin/polls/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { adminId, fechaFin, ...pollData } = req.body;\n      \n      // Convertir fechaFin de string a Date o null si está presente\n      const finalPollData: any = { ...pollData };\n      if (fechaFin !== undefined) {\n        finalPollData.fechaFin = fechaFin && fechaFin.trim() !== \"\" ? new Date(fechaFin) : null;\n      }\n      \n      const poll = await storage.updatePoll(id, finalPollData);\n      if (!poll) {\n        return res.status(404).json({ error: \"Sondeo no encontrado\" });\n      }\n\n      res.json(poll);\n    } catch (error) {\n      console.error(\"Error al editar sondeo:\", error);\n      res.status(500).json({ error: \"Error al editar sondeo\" });\n    }\n  });\n\n  // Eliminar sondeo (Admin)\n  app.delete(\"/api/admin/polls/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      await storage.deletePoll(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error al eliminar sondeo:\", error);\n      res.status(500).json({ error: \"Error al eliminar sondeo\" });\n    }\n  });\n\n  // --- DEBATES (Admin) ---\n\n  // Obtener todos los debates (Admin)\n  app.get(\"/api/admin/debates\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const debates = await storage.getAllDebates();\n      res.json(debates);\n    } catch (error) {\n      console.error(\"Error al obtener debates:\", error);\n      res.status(500).json({ error: \"Error al obtener debates\" });\n    }\n  });\n\n  // Crear debate (Admin)\n  app.post(\"/api/admin/debates\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { adminId, ...debateData } = req.body;\n      const validation = validateRequest(insertDebateSchema, debateData);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const debate = await storage.createDebate(validation.data!);\n      res.status(201).json(debate);\n    } catch (error) {\n      console.error(\"Error al crear debate:\", error);\n      res.status(500).json({ error: \"Error al crear debate\" });\n    }\n  });\n\n  // Editar debate (Admin)\n  app.put(\"/api/admin/debates/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { adminId, ...debateData } = req.body;\n      const validation = validateRequest(insertDebateSchema.partial(), debateData);\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error });\n      }\n\n      const debate = await storage.updateDebate(id, validation.data!);\n      if (!debate) {\n        return res.status(404).json({ error: \"Debate no encontrado\" });\n      }\n\n      res.json(debate);\n    } catch (error) {\n      console.error(\"Error al editar debate:\", error);\n      res.status(500).json({ error: \"Error al editar debate\" });\n    }\n  });\n\n  // Eliminar debate (Admin)\n  app.delete(\"/api/admin/debates/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      await storage.deleteDebate(id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error al eliminar debate:\", error);\n      res.status(500).json({ error: \"Error al eliminar debate\" });\n    }\n  });\n\n  // --- USUARIOS (Admin) ---\n\n  // Obtener todos los usuarios (Admin)\n  app.get(\"/api/admin/users\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const users = await storage.getAllUsers();\n      // Remover contraseñas\n      const usersWithoutPasswords = users.map(({ password, ...user }) => user);\n      res.json(usersWithoutPasswords);\n    } catch (error) {\n      console.error(\"Error al obtener usuarios:\", error);\n      res.status(500).json({ error: \"Error al obtener usuarios\" });\n    }\n  });\n\n  // Cambiar nivel o rol de admin de un usuario (Admin)\n  app.put(\"/api/admin/users/:id\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const { id } = req.params;\n      const { nivel, isAdmin: setAdmin } = req.body;\n      \n      const updateData: any = {};\n      if (nivel) updateData.nivel = nivel;\n      if (setAdmin !== undefined) updateData.isAdmin = setAdmin;\n\n      const updated = await storage.updateUser(id, updateData);\n      if (!updated) {\n        return res.status(404).json({ error: \"Usuario no encontrado\" });\n      }\n\n      const { password, ...userWithoutPassword } = updated;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Error al actualizar usuario:\", error);\n      res.status(500).json({ error: \"Error al actualizar usuario\" });\n    }\n  });\n\n  // Estadísticas generales (Admin)\n  app.get(\"/api/admin/stats\", isAdmin, async (req: Request, res: Response) => {\n    try {\n      const [users, news, proposals, polls] = await Promise.all([\n        storage.getAllUsers(),\n        storage.getAllNews(),\n        storage.getAllProposals(),\n        storage.getAllPolls(),\n      ]);\n\n      res.json({\n        totalUsers: users.length,\n        totalNews: news.length,\n        totalProposals: proposals.length,\n        totalPolls: polls.length,\n        verifiedUsers: users.filter(u => u.nivel === \"verificado\").length,\n        adminUsers: users.filter(u => u.isAdmin).length,\n      });\n    } catch (error) {\n      console.error(\"Error al obtener estadísticas:\", error);\n      res.status(500).json({ error: \"Error al obtener estadísticas\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":44058},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1383},"shared/schema.ts":{"content":"// Schema para la plataforma Neurolex de Gobernanza y Participación Cívica\n// Todos los modelos de datos están en español para consistencia\n\nimport { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, pgEnum } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema, createSelectSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enumeraciones para tipos de datos\n\nexport const nivelUsuarioEnum = pgEnum(\"nivel_usuario\", [\"basico\", \"verificado\"]);\nexport const tipoTokenEnum = pgEnum(\"tipo_token\", [\"TP\", \"TA\", \"TGR\"]);\nexport const estadoPropuestaEnum = pgEnum(\"estado_propuesta\", [\"borrador\", \"en_deliberacion\", \"votacion\", \"aprobada\", \"rechazada\", \"archivada\"]);\nexport const tipoNoticiaEnum = pgEnum(\"tipo_noticia\", [\"nacional\", \"internacional\", \"economia\", \"social\", \"tecnologia\", \"otro\"]);\nexport const tipoTransaccionEnum = pgEnum(\"tipo_transaccion\", [\n  \"ganado_participacion\", \n  \"ganado_recompensa\", \n  \"comprado\", \n  \"gastado_apoyo\", \n  \"gastado_gobernanza\",\n  \"transferido\"\n]);\n\n// Tabla de Usuarios\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  nombre: text(\"nombre\"),\n  apellido: text(\"apellido\"),\n  \n  // Nivel de usuario (básico o verificado)\n  nivel: nivelUsuarioEnum(\"nivel\").notNull().default(\"basico\"),\n  \n  // Rol de administrador\n  isAdmin: boolean(\"is_admin\").notNull().default(false),\n  \n  // Afinidad política para personalización del feed\n  afinidadPolitica: text(\"afinidad_politica\"), // nombre del partido o \"Ninguno/Otros\"\n  \n  // Wallet Web3 vinculada para compras crypto\n  walletAddress: text(\"wallet_address\").unique(), // Dirección Ethereum del usuario\n  \n  // Gamificación\n  karmaTotal: integer(\"karma_total\").notNull().default(0),\n  nivelGamificacion: integer(\"nivel_gamificacion\").notNull().default(1),\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Balance de Tokens de usuario\nexport const tokensBalance = pgTable(\"tokens_balance\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  // Tokens de Participación (TP)\n  tokensParticipacion: integer(\"tokens_participacion\").notNull().default(0),\n  \n  // Tokens de Apoyo (TA) - se compran con dinero\n  tokensApoyo: integer(\"tokens_apoyo\").notNull().default(0),\n  \n  // Tokens de Gobernanza y Recompensa (TGR)\n  tokensGobernanza: integer(\"tokens_gobernanza\").notNull().default(0),\n  \n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Historial de transacciones de Tokens\nexport const tokenTransactions = pgTable(\"token_transactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  tipoToken: tipoTokenEnum(\"tipo_token\").notNull(), // TP, TA, o TGR\n  cantidad: integer(\"cantidad\").notNull(), // puede ser positivo (ganado/comprado) o negativo (gastado)\n  tipoTransaccion: tipoTransaccionEnum(\"tipo_transaccion\").notNull(),\n  descripcion: text(\"descripcion\").notNull(), // ej: \"Votaste en una propuesta\", \"Compraste 100 TA\"\n  relacionadoId: varchar(\"relacionado_id\"), // ID de propuesta, sondeo, etc. que generó la transacción\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Historial de transacciones de Karma\nexport const karmaHistory = pgTable(\"karma_history\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  cantidad: integer(\"cantidad\").notNull(), // puede ser positivo o negativo\n  razon: text(\"razon\").notNull(), // ej: \"Comentario votado positivamente\", \"Propuesta aceptada\"\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Noticias políticas\nexport const news = pgTable(\"news\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  titulo: text(\"titulo\").notNull(),\n  contenido: text(\"contenido\").notNull(),\n  resumen: text(\"resumen\"), // breve descripción para las tarjetas\n  imagenUrl: text(\"imagen_url\"),\n  \n  // Clasificación\n  tipo: tipoNoticiaEnum(\"tipo\").notNull().default(\"nacional\"),\n  partidoRelacionado: text(\"partido_relacionado\"), // para personalización\n  etiquetas: text(\"etiquetas\").array(), // [\"economía\", \"salud\", etc]\n  \n  // Fuente\n  fuente: text(\"fuente\"), // nombre del medio\n  urlOriginal: text(\"url_original\"),\n  \n  // Metadata\n  publicadoPor: varchar(\"publicado_por\").references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Propuestas ciudadanas\nexport const proposals = pgTable(\"proposals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  titulo: text(\"titulo\").notNull(),\n  descripcion: text(\"descripcion\").notNull(),\n  contenidoCompleto: text(\"contenido_completo\").notNull(), // texto completo de la propuesta\n  \n  // Estado y clasificación\n  estado: estadoPropuestaEnum(\"estado\").notNull().default(\"borrador\"),\n  categoria: text(\"categoria\").notNull(), // ej: \"Educación\", \"Salud\", \"Economía\"\n  partidoRelacionado: text(\"partido_relacionado\"),\n  \n  // Apoyo mediante tokens\n  apoyosTP: integer(\"apoyos_tp\").notNull().default(0),\n  apoyosTA: integer(\"apoyos_ta\").notNull().default(0),\n  \n  // Autor\n  autorId: varchar(\"autor_id\").notNull().references(() => users.id),\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Sondeos/Encuestas\nexport const polls = pgTable(\"polls\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  pregunta: text(\"pregunta\").notNull(),\n  descripcion: text(\"descripcion\"),\n  \n  // Configuración\n  permitirMultiplesRespuestas: boolean(\"permitir_multiples_respuestas\").notNull().default(false),\n  requiereNivelVerificado: boolean(\"requiere_nivel_verificado\").notNull().default(false),\n  \n  // Fechas\n  fechaInicio: timestamp(\"fecha_inicio\").notNull().defaultNow(),\n  fechaFin: timestamp(\"fecha_fin\"),\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Opciones de sondeos\nexport const pollOptions = pgTable(\"poll_options\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  pollId: varchar(\"poll_id\").notNull().references(() => polls.id, { onDelete: \"cascade\" }),\n  texto: text(\"texto\").notNull(),\n  votos: integer(\"votos\").notNull().default(0),\n  orden: integer(\"orden\").notNull().default(0),\n});\n\n// Votos en sondeos\nexport const votes = pgTable(\"votes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  pollId: varchar(\"poll_id\").notNull().references(() => polls.id, { onDelete: \"cascade\" }),\n  optionId: varchar(\"option_id\").notNull().references(() => pollOptions.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Debates del foro\nexport const debates = pgTable(\"debates\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  titulo: text(\"titulo\").notNull(),\n  contenido: text(\"contenido\").notNull(),\n  \n  // Clasificación\n  categoria: text(\"categoria\").notNull(), // \"politica\", \"economia\", \"social\", \"tecnologia\", \"medioambiente\", \"general\"\n  \n  // Autor\n  autorId: varchar(\"autor_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  // Estadísticas\n  numRespuestas: integer(\"num_respuestas\").notNull().default(0),\n  numVistas: integer(\"num_vistas\").notNull().default(0),\n  \n  // Destacado\n  destacado: boolean(\"destacado\").notNull().default(false),\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Comentarios en propuestas, noticias y debates\nexport const comments = pgTable(\"comments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contenido: text(\"contenido\").notNull(),\n  \n  // Puede ser comentario en propuesta, noticia o debate\n  propuestaId: varchar(\"propuesta_id\").references(() => proposals.id, { onDelete: \"cascade\" }),\n  noticiaId: varchar(\"noticia_id\").references(() => news.id, { onDelete: \"cascade\" }),\n  debateId: varchar(\"debate_id\").references(() => debates.id, { onDelete: \"cascade\" }),\n  \n  // Comentarios anidados\n  parentId: varchar(\"parent_id\").references((): any => comments.id, { onDelete: \"cascade\" }),\n  \n  // Autor\n  autorId: varchar(\"autor_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  // Votación del comentario\n  votosPositivos: integer(\"votos_positivos\").notNull().default(0),\n  votosNegativos: integer(\"votos_negativos\").notNull().default(0),\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Formulario de contacto\nexport const contacts = pgTable(\"contacts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  nombre: text(\"nombre\").notNull(),\n  email: text(\"email\").notNull(),\n  asunto: text(\"asunto\").notNull(),\n  mensaje: text(\"mensaje\").notNull(),\n  respondido: boolean(\"respondido\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Insignias/Badges de gamificación\nexport const badges = pgTable(\"badges\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  nombre: text(\"nombre\").notNull().unique(),\n  descripcion: text(\"descripcion\").notNull(),\n  iconoUrl: text(\"icono_url\"),\n  nivelRequerido: integer(\"nivel_requerido\").notNull().default(1),\n});\n\n// Insignias de usuarios\nexport const userBadges = pgTable(\"user_badges\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  badgeId: varchar(\"badge_id\").notNull().references(() => badges.id, { onDelete: \"cascade\" }),\n  obtenidoEn: timestamp(\"obtenido_en\").notNull().defaultNow(),\n});\n\n// Relaciones\n\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  tokensBalance: one(tokensBalance, {\n    fields: [users.id],\n    references: [tokensBalance.userId],\n  }),\n  proposals: many(proposals),\n  debates: many(debates),\n  comments: many(comments),\n  karmaHistory: many(karmaHistory),\n  userBadges: many(userBadges),\n  votes: many(votes),\n}));\n\nexport const tokensBalanceRelations = relations(tokensBalance, ({ one }) => ({\n  user: one(users, {\n    fields: [tokensBalance.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const proposalsRelations = relations(proposals, ({ one, many }) => ({\n  autor: one(users, {\n    fields: [proposals.autorId],\n    references: [users.id],\n  }),\n  comments: many(comments),\n}));\n\nexport const newsRelations = relations(news, ({ one, many }) => ({\n  publicadoPor: one(users, {\n    fields: [news.publicadoPor],\n    references: [users.id],\n  }),\n  comments: many(comments),\n}));\n\nexport const pollsRelations = relations(polls, ({ many }) => ({\n  options: many(pollOptions),\n  votes: many(votes),\n}));\n\nexport const pollOptionsRelations = relations(pollOptions, ({ one, many }) => ({\n  poll: one(polls, {\n    fields: [pollOptions.pollId],\n    references: [polls.id],\n  }),\n  votes: many(votes),\n}));\n\nexport const debatesRelations = relations(debates, ({ one, many }) => ({\n  autor: one(users, {\n    fields: [debates.autorId],\n    references: [users.id],\n  }),\n  comments: many(comments),\n}));\n\nexport const commentsRelations = relations(comments, ({ one, many }) => ({\n  autor: one(users, {\n    fields: [comments.autorId],\n    references: [users.id],\n  }),\n  propuesta: one(proposals, {\n    fields: [comments.propuestaId],\n    references: [proposals.id],\n  }),\n  noticia: one(news, {\n    fields: [comments.noticiaId],\n    references: [news.id],\n  }),\n  debate: one(debates, {\n    fields: [comments.debateId],\n    references: [debates.id],\n  }),\n  parent: one(comments, {\n    fields: [comments.parentId],\n    references: [comments.id],\n  }),\n  replies: many(comments),\n}));\n\nexport const userBadgesRelations = relations(userBadges, ({ one }) => ({\n  user: one(users, {\n    fields: [userBadges.userId],\n    references: [users.id],\n  }),\n  badge: one(badges, {\n    fields: [userBadges.badgeId],\n    references: [badges.id],\n  }),\n}));\n\n// Schemas de validación con Zod\n\n// Usuarios\nexport const insertUserSchema = createInsertSchema(users, {\n  email: z.string().email(\"El correo electrónico no es válido\"),\n  username: z.string().min(3, \"El nombre de usuario debe tener al menos 3 caracteres\"),\n  password: z.string().min(6, \"La contraseña debe tener al menos 6 caracteres\"),\n}).omit({\n  id: true,\n  karmaTotal: true,\n  nivelGamificacion: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const selectUserSchema = createSelectSchema(users);\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\n// Noticias\nexport const insertNewsSchema = createInsertSchema(news).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertNews = z.infer<typeof insertNewsSchema>;\nexport type News = typeof news.$inferSelect;\n\n// Propuestas\nexport const insertProposalSchema = createInsertSchema(proposals, {\n  titulo: z.string().min(10, \"El título debe tener al menos 10 caracteres\"),\n  descripcion: z.string().min(20, \"La descripción debe tener al menos 20 caracteres\"),\n  contenidoCompleto: z.string().min(50, \"El contenido debe tener al menos 50 caracteres\"),\n}).omit({\n  id: true,\n  apoyosTP: true,\n  apoyosTA: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertProposal = z.infer<typeof insertProposalSchema>;\nexport type Proposal = typeof proposals.$inferSelect;\n\n// Debates\nexport const insertDebateSchema = createInsertSchema(debates, {\n  titulo: z.string().min(10, \"El título debe tener al menos 10 caracteres\"),\n  contenido: z.string().min(20, \"El contenido debe tener al menos 20 caracteres\"),\n  categoria: z.string().min(1, \"La categoría es obligatoria\"),\n}).omit({\n  id: true,\n  numRespuestas: true,\n  numVistas: true,\n  destacado: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertDebate = z.infer<typeof insertDebateSchema>;\nexport type Debate = typeof debates.$inferSelect;\n\n// Sondeos\nexport const insertPollSchema = createInsertSchema(polls).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertPoll = z.infer<typeof insertPollSchema>;\nexport type Poll = typeof polls.$inferSelect;\n\n// Opciones de sondeo\nexport const insertPollOptionSchema = createInsertSchema(pollOptions).omit({\n  id: true,\n  votos: true,\n});\n\nexport type InsertPollOption = z.infer<typeof insertPollOptionSchema>;\nexport type PollOption = typeof pollOptions.$inferSelect;\n\n// Comentarios\nexport const insertCommentSchema = createInsertSchema(comments, {\n  contenido: z.string().min(1, \"El comentario no puede estar vacío\"),\n}).omit({\n  id: true,\n  votosPositivos: true,\n  votosNegativos: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertComment = z.infer<typeof insertCommentSchema>;\nexport type Comment = typeof comments.$inferSelect;\n\n// Contacto\nexport const insertContactSchema = createInsertSchema(contacts, {\n  nombre: z.string().min(2, \"El nombre debe tener al menos 2 caracteres\"),\n  email: z.string().email(\"El correo electrónico no es válido\"),\n  asunto: z.string().min(5, \"El asunto debe tener al menos 5 caracteres\"),\n  mensaje: z.string().min(10, \"El mensaje debe tener al menos 10 caracteres\"),\n}).omit({\n  id: true,\n  respondido: true,\n  createdAt: true,\n});\n\nexport type InsertContact = z.infer<typeof insertContactSchema>;\nexport type Contact = typeof contacts.$inferSelect;\n\n// Transacciones de tokens\nexport const insertTokenTransactionSchema = createInsertSchema(tokenTransactions, {\n  cantidad: z.number().int(\"La cantidad debe ser un número entero\"),\n  descripcion: z.string().min(1, \"La descripción no puede estar vacía\"),\n}).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertTokenTransaction = z.infer<typeof insertTokenTransactionSchema>;\nexport type TokenTransaction = typeof tokenTransactions.$inferSelect;\n\n// Tipos de balance de tokens\nexport type TokensBalance = typeof tokensBalance.$inferSelect;\nexport type KarmaHistory = typeof karmaHistory.$inferSelect;\nexport type Vote = typeof votes.$inferSelect;\nexport type Badge = typeof badges.$inferSelect;\nexport type UserBadge = typeof userBadges.$inferSelect;\n","size_bytes":16817},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":21846},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 210 5% 98%;\n\n  --foreground: 210 6% 12%;\n\n  --border: 210 6% 88%;\n\n  --card: 210 5% 96%;\n\n  --card-foreground: 210 6% 12%;\n\n  --card-border: 210 6% 90%;\n\n  --sidebar: 210 5% 94%;\n\n  --sidebar-foreground: 210 6% 12%;\n\n  --sidebar-border: 210 6% 86%;\n\n  --sidebar-primary: 178 45% 55%;\n\n  --sidebar-primary-foreground: 178 45% 98%;\n\n  --sidebar-accent: 210 8% 88%;\n\n  --sidebar-accent-foreground: 210 6% 15%;\n\n  --sidebar-ring: 178 45% 55%;\n\n  --popover: 210 6% 92%;\n\n  --popover-foreground: 210 6% 12%;\n\n  --popover-border: 210 6% 84%;\n\n  --primary: 178 45% 55%;\n\n  --primary-foreground: 178 45% 98%;\n\n  --secondary: 210 8% 86%;\n\n  --secondary-foreground: 210 6% 15%;\n\n  --muted: 210 10% 90%;\n\n  --muted-foreground: 210 6% 35%;\n\n  --accent: 210 12% 88%;\n\n  --accent-foreground: 210 6% 18%;\n\n  --destructive: 0 72% 45%;\n\n  --destructive-foreground: 0 72% 98%;\n\n  --input: 210 12% 75%;\n  --ring: 178 45% 55%;\n  --chart-1: 176 65% 35%;\n  --chart-2: 142 62% 38%;\n  --chart-3: 200 70% 40%;\n  --chart-4: 35 75% 48%;\n  --chart-5: 280 60% 45%;\n\n  --font-sans: Inter, -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif;\n  --font-serif: Georgia, Cambria, \"Times New Roman\", Times, serif;\n  --font-mono: \"JetBrains Mono\", Menlo, Monaco, Consolas, \"Courier New\", monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 1px 2px 0px hsl(210 10% 15% / 0.05);\n  --shadow-xs: 0px 1px 3px 0px hsl(210 10% 15% / 0.08);\n  --shadow-sm: 0px 2px 4px 0px hsl(210 10% 15% / 0.06), 0px 1px 2px -1px hsl(210 10% 15% / 0.04);\n  --shadow: 0px 4px 6px -1px hsl(210 10% 15% / 0.08), 0px 2px 4px -2px hsl(210 10% 15% / 0.04);\n  --shadow-md: 0px 6px 12px -2px hsl(210 10% 15% / 0.10), 0px 3px 6px -3px hsl(210 10% 15% / 0.05);\n  --shadow-lg: 0px 10px 20px -4px hsl(210 10% 15% / 0.12), 0px 4px 8px -4px hsl(210 10% 15% / 0.06);\n  --shadow-xl: 0px 20px 30px -6px hsl(210 10% 15% / 0.14), 0px 8px 12px -6px hsl(210 10% 15% / 0.08);\n  --shadow-2xl: 0px 25px 50px -12px hsl(210 10% 15% / 0.20);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 210 6% 8%;\n\n  --foreground: 210 6% 95%;\n\n  --border: 210 6% 18%;\n\n  --card: 210 6% 11%;\n\n  --card-foreground: 210 6% 95%;\n\n  --card-border: 210 6% 20%;\n\n  --sidebar: 210 6% 14%;\n\n  --sidebar-foreground: 210 6% 95%;\n\n  --sidebar-border: 210 6% 24%;\n\n  --sidebar-primary: 178 45% 48%;\n\n  --sidebar-primary-foreground: 178 45% 98%;\n\n  --sidebar-accent: 210 12% 18%;\n\n  --sidebar-accent-foreground: 210 6% 92%;\n\n  --sidebar-ring: 178 45% 48%;\n\n  --popover: 210 6% 16%;\n\n  --popover-foreground: 210 6% 95%;\n\n  --popover-border: 210 6% 26%;\n\n  --primary: 178 45% 48%;\n\n  --primary-foreground: 178 45% 98%;\n\n  --secondary: 210 10% 20%;\n\n  --secondary-foreground: 210 6% 92%;\n\n  --muted: 210 12% 18%;\n\n  --muted-foreground: 210 8% 70%;\n\n  --accent: 210 15% 20%;\n\n  --accent-foreground: 210 6% 92%;\n\n  --destructive: 0 72% 35%;\n\n  --destructive-foreground: 0 72% 98%;\n\n  --input: 210 15% 35%;\n  --ring: 178 45% 48%;\n  --chart-1: 176 65% 65%;\n  --chart-2: 142 62% 62%;\n  --chart-3: 200 70% 60%;\n  --chart-4: 35 75% 68%;\n  --chart-5: 280 60% 65%;\n\n  --shadow-2xs: 0px 1px 2px 0px hsl(210 10% 0% / 0.20);\n  --shadow-xs: 0px 1px 3px 0px hsl(210 10% 0% / 0.25);\n  --shadow-sm: 0px 2px 4px 0px hsl(210 10% 0% / 0.22), 0px 1px 2px -1px hsl(210 10% 0% / 0.18);\n  --shadow: 0px 4px 6px -1px hsl(210 10% 0% / 0.28), 0px 2px 4px -2px hsl(210 10% 0% / 0.20);\n  --shadow-md: 0px 6px 12px -2px hsl(210 10% 0% / 0.35), 0px 3px 6px -3px hsl(210 10% 0% / 0.25);\n  --shadow-lg: 0px 10px 20px -4px hsl(210 10% 0% / 0.40), 0px 4px 8px -4px hsl(210 10% 0% / 0.28);\n  --shadow-xl: 0px 20px 30px -6px hsl(210 10% 0% / 0.45), 0px 8px 12px -6px hsl(210 10% 0% / 0.32);\n  --shadow-2xl: 0px 25px 50px -12px hsl(210 10% 0% / 0.50);\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n}","size_bytes":11512},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1202},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":844},"client/src/pages/Login.tsx":{"content":"// Página de inicio de sesión para la plataforma Neurolex\nimport { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Navbar } from \"@/components/Navbar\";\nimport logoUrl from \"@assets/Main logo_1761708286562.jpg\";\n\nconst loginSchema = z.object({\n  email: z.string().email(\"El correo electrónico no es válido\"),\n  password: z.string().min(1, \"La contraseña es requerida\"),\n  recordarme: z.boolean().optional(),\n});\n\ntype LoginFormValues = z.infer<typeof loginSchema>;\n\nexport default function Login() {\n  const [, setLocation] = useLocation();\n  const [isLoading, setIsLoading] = useState(false);\n\n  const form = useForm<LoginFormValues>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      email: \"\",\n      password: \"\",\n      recordarme: false,\n    },\n  });\n\n  const onSubmit = async (data: LoginFormValues) => {\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          email: data.email,\n          password: data.password,\n        }),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || \"Error al iniciar sesión\");\n      }\n\n      // Guardar información del usuario en localStorage\n      localStorage.setItem(\"userId\", result.id);\n      localStorage.setItem(\"user\", JSON.stringify(result));\n\n      setLocation(\"/dashboard\");\n    } catch (error: any) {\n      console.error(\"Error en login:\", error);\n      alert(error.message || \"Error al iniciar sesión\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-br from-primary/5 via-background to-background\">\n      <Navbar />\n      \n      <div className=\"flex-1 flex items-center justify-center p-4\">\n        <Card className=\"w-full max-w-md\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto mb-4\">\n              <img src={logoUrl} alt=\"Neurolex\" className=\"h-16 w-16 mx-auto rounded-md\" />\n            </div>\n            <CardTitle className=\"text-3xl font-bold font-[Poppins]\">\n              Bienvenido de Vuelta\n            </CardTitle>\n            <CardDescription>\n              Inicia sesión en tu cuenta de Neurolex\n            </CardDescription>\n          </CardHeader>\n\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Correo Electrónico</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"email\" \n                          placeholder=\"tu@email.com\" \n                          {...field} \n                          data-testid=\"input-email\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"password\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Contraseña</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"password\" \n                          placeholder=\"••••••\" \n                          {...field} \n                          data-testid=\"input-password\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex items-center justify-between\">\n                  <FormField\n                    control={form.control}\n                    name=\"recordarme\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-row items-center space-x-2 space-y-0\">\n                        <FormControl>\n                          <Checkbox\n                            checked={field.value}\n                            onCheckedChange={field.onChange}\n                            data-testid=\"checkbox-remember\"\n                          />\n                        </FormControl>\n                        <FormLabel className=\"text-sm font-normal cursor-pointer\">\n                          Recordarme\n                        </FormLabel>\n                      </FormItem>\n                    )}\n                  />\n\n                  <a href=\"#\" className=\"text-sm text-primary hover:underline\">\n                    ¿Olvidaste tu contraseña?\n                  </a>\n                </div>\n\n                <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-submit-login\">\n                  {isLoading ? \"Iniciando sesión...\" : \"Iniciar Sesión\"}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n\n          <CardFooter className=\"flex flex-col gap-4\">\n            <div className=\"relative w-full\">\n              <div className=\"absolute inset-0 flex items-center\">\n                <span className=\"w-full border-t\" />\n              </div>\n              <div className=\"relative flex justify-center text-xs uppercase\">\n                <span className=\"bg-card px-2 text-muted-foreground\">\n                  o continúa con\n                </span>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <Button variant=\"outline\" type=\"button\" data-testid=\"button-google-login\">\n                <svg className=\"mr-2 h-4 w-4\" viewBox=\"0 0 24 24\">\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"\n                  />\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"\n                  />\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"\n                  />\n                  <path\n                    fill=\"currentColor\"\n                    d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"\n                  />\n                </svg>\n                Google\n              </Button>\n              <Button variant=\"outline\" type=\"button\" data-testid=\"button-facebook-login\">\n                <svg className=\"mr-2 h-4 w-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path d=\"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z\" />\n                </svg>\n                Facebook\n              </Button>\n            </div>\n\n            <p className=\"text-sm text-muted-foreground text-center\">\n              ¿No tienes una cuenta?{\" \"}\n              <Link href=\"/registro\" className=\"text-primary hover:underline font-semibold\" data-testid=\"link-register\">\n                Regístrate\n              </Link>\n            </p>\n          </CardFooter>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":8371},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":2359},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","size_bytes":1904},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/pages/Register.tsx":{"content":"// Página de registro para la plataforma Neurolex\nimport { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Navbar } from \"@/components/Navbar\";\nimport logoUrl from \"@assets/Main logo_1761708286562.jpg\";\n\n// Schema de validación para registro\nconst registerSchema = z.object({\n  username: z.string().min(3, \"El nombre de usuario debe tener al menos 3 caracteres\"),\n  email: z.string().email(\"El correo electrónico no es válido\"),\n  password: z.string().min(6, \"La contraseña debe tener al menos 6 caracteres\"),\n  confirmPassword: z.string(),\n  nombre: z.string().min(2, \"El nombre debe tener al menos 2 caracteres\"),\n  apellido: z.string().min(2, \"El apellido debe tener al menos 2 caracteres\"),\n  afinidadPolitica: z.string().optional(),\n  aceptaTerminos: z.boolean().refine(val => val === true, {\n    message: \"Debes aceptar los términos y condiciones\",\n  }),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Las contraseñas no coinciden\",\n  path: [\"confirmPassword\"],\n});\n\ntype RegisterFormValues = z.infer<typeof registerSchema>;\n\nexport default function Register() {\n  const [, setLocation] = useLocation();\n  const [isLoading, setIsLoading] = useState(false);\n\n  const form = useForm<RegisterFormValues>({\n    resolver: zodResolver(registerSchema),\n    defaultValues: {\n      username: \"\",\n      email: \"\",\n      password: \"\",\n      confirmPassword: \"\",\n      nombre: \"\",\n      apellido: \"\",\n      afinidadPolitica: \"\",\n      aceptaTerminos: false,\n    },\n  });\n\n  const onSubmit = async (data: RegisterFormValues) => {\n    setIsLoading(true);\n    try {\n      const { confirmPassword, aceptaTerminos, ...userData } = data;\n      \n      const response = await fetch(\"/api/auth/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(userData),\n      });\n\n      const result = await response.json();\n\n      if (!response.ok) {\n        throw new Error(result.error || \"Error al registrarse\");\n      }\n\n      // Guardar información del usuario en localStorage\n      localStorage.setItem(\"userId\", result.id);\n      localStorage.setItem(\"user\", JSON.stringify(result));\n\n      setLocation(\"/dashboard\");\n    } catch (error: any) {\n      console.error(\"Error en registro:\", error);\n      alert(error.message || \"Error al registrarse\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const partidosPoliticos = [\n    \"Ninguno/Otros\",\n    \"Partido A\",\n    \"Partido B\",\n    \"Partido C\",\n    \"Partido D\",\n    \"Independiente\",\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-br from-primary/5 via-background to-background\">\n      <Navbar />\n      \n      <div className=\"flex-1 flex items-center justify-center p-4 py-12\">\n        <Card className=\"w-full max-w-2xl\">\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto mb-4\">\n              <img src={logoUrl} alt=\"Neurolex\" className=\"h-16 w-16 mx-auto rounded-md\" />\n            </div>\n            <CardTitle className=\"text-3xl font-bold font-[Poppins]\">\n              Únete a Neurolex\n            </CardTitle>\n            <CardDescription>\n              Crea tu cuenta gratuita y comienza a participar en la democracia digital\n            </CardDescription>\n          </CardHeader>\n\n          <CardContent>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n                {/* Nombre y Apellido */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"nombre\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nombre</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Juan\" {...field} data-testid=\"input-nombre\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"apellido\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Apellido</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"Pérez\" {...field} data-testid=\"input-apellido\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Username y Email */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"username\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Nombre de Usuario</FormLabel>\n                        <FormControl>\n                          <Input placeholder=\"juanperez\" {...field} data-testid=\"input-username\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"email\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Correo Electrónico</FormLabel>\n                        <FormControl>\n                          <Input type=\"email\" placeholder=\"juan@ejemplo.com\" {...field} data-testid=\"input-email\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Contraseñas */}\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"password\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Contraseña</FormLabel>\n                        <FormControl>\n                          <Input type=\"password\" placeholder=\"••••••\" {...field} data-testid=\"input-password\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <FormField\n                    control={form.control}\n                    name=\"confirmPassword\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Confirmar Contraseña</FormLabel>\n                        <FormControl>\n                          <Input type=\"password\" placeholder=\"••••••\" {...field} data-testid=\"input-confirm-password\" />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                {/* Afinidad Política */}\n                <FormField\n                  control={form.control}\n                  name=\"afinidadPolitica\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Afinidad Política (Opcional)</FormLabel>\n                      <Select onValueChange={field.onChange} defaultValue={field.value}>\n                        <FormControl>\n                          <SelectTrigger data-testid=\"select-afinidad-politica\">\n                            <SelectValue placeholder=\"Selecciona tu afinidad política\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {partidosPoliticos.map((partido) => (\n                            <SelectItem key={partido} value={partido}>\n                              {partido}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                      <FormDescription>\n                        Esto nos ayuda a personalizar tu feed de noticias y propuestas\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Términos y condiciones */}\n                <FormField\n                  control={form.control}\n                  name=\"aceptaTerminos\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                      <FormControl>\n                        <Checkbox\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"checkbox-terms\"\n                        />\n                      </FormControl>\n                      <div className=\"space-y-1 leading-none\">\n                        <FormLabel>\n                          Acepto los{\" \"}\n                          <a href=\"#\" className=\"text-primary hover:underline\">\n                            Términos y Condiciones\n                          </a>{\" \"}\n                          y la{\" \"}\n                          <a href=\"#\" className=\"text-primary hover:underline\">\n                            Política de Privacidad\n                          </a>\n                        </FormLabel>\n                        <FormMessage />\n                      </div>\n                    </FormItem>\n                  )}\n                />\n\n                <Button type=\"submit\" className=\"w-full\" disabled={isLoading} data-testid=\"button-submit-register\">\n                  {isLoading ? \"Creando cuenta...\" : \"Crear Cuenta\"}\n                </Button>\n              </form>\n            </Form>\n          </CardContent>\n\n          <CardFooter className=\"flex justify-center\">\n            <p className=\"text-sm text-muted-foreground\">\n              ¿Ya tienes una cuenta?{\" \"}\n              <Link href=\"/login\" className=\"text-primary hover:underline font-semibold\" data-testid=\"link-login\">\n                Iniciar Sesión\n              </Link>\n            </p>\n          </CardFooter>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","size_bytes":11091},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/Sondeos.tsx":{"content":"// Página de sondeos y encuestas para Neurolex\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { PollCard } from \"@/components/PollCard\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { BarChart3, Clock, TrendingUp } from \"lucide-react\";\n\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Loader2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nexport default function Sondeos() {\n  const { toast } = useToast();\n  \n  // Obtener userId del localStorage\n  const userId = localStorage.getItem(\"userId\");\n\n  // Cargar datos del usuario si está autenticado\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens si está autenticado\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar sondeos del backend\n  const { data: allPolls = [], isLoading } = useQuery({\n    queryKey: [\"/api/polls\"],\n  });\n\n  // Cargar sondeos en los que el usuario ya votó\n  const { data: votedPollIds = [] } = useQuery({\n    queryKey: [\"/api/polls/user\", userId, \"voted\"],\n    enabled: !!userId,\n  });\n\n  // Mutación para votar\n  const voteMutation = useMutation({\n    mutationFn: async ({ pollId, optionId }: { pollId: string; optionId: string }) => {\n      if (!userId) {\n        throw new Error(\"Debes iniciar sesión para votar\");\n      }\n      return apiRequest(\"POST\", `/api/polls/${pollId}/vote`, { userId, optionId });\n    },\n    onSuccess: () => {\n      // Invalidar queries para actualizar los datos\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls/user\", userId, \"voted\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens\", userId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/me\", userId] });\n      \n      toast({\n        title: \"¡Voto registrado!\",\n        description: \"Has ganado 10 TP y 5 puntos de karma\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error al votar\",\n        description: error.message || \"No se pudo registrar tu voto\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Función para manejar el voto\n  const handleVote = (pollId: string, optionId: string) => {\n    if (!userId) {\n      toast({\n        title: \"Inicia sesión\",\n        description: \"Debes iniciar sesión para votar en sondeos\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    voteMutation.mutate({ pollId, optionId });\n  };\n\n  // Filtrar sondeos activos y cerrados basándose en la fecha de finalización\n  const now = new Date();\n  const sondeosActivos = allPolls.filter((poll: any) => {\n    // Si no tiene fechaFin, está siempre activo\n    if (!poll.fechaFin) return true;\n    // Si tiene fechaFin, verificar que sea mayor a ahora\n    return new Date(poll.fechaFin) > now;\n  });\n  const sondeosCerrados = allPolls.filter((poll: any) => {\n    // Si no tiene fechaFin, nunca está cerrado\n    if (!poll.fechaFin) return false;\n    // Si tiene fechaFin, está cerrado si es menor o igual a ahora\n    return new Date(poll.fechaFin) <= now;\n  });\n\n  const estadisticasGenerales = [\n    { label: \"Sondeos Activos\", valor: String(sondeosActivos.length), icon: BarChart3, color: \"text-blue-600\" },\n    { label: \"Sondeos Cerrados\", valor: String(sondeosCerrados.length), icon: Clock, color: \"text-gray-600\" },\n    { label: \"Total de Sondeos\", valor: String(allPolls.length), icon: TrendingUp, color: \"text-purple-600\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-2\" data-testid=\"text-page-title\">\n              Sondeos y Encuestas\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Participa en encuestas ciudadanas y ayuda a tomar decisiones informadas\n            </p>\n          </div>\n\n          {/* Estadísticas generales */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n            {estadisticasGenerales.map((stat, index) => {\n              const Icon = stat.icon;\n              return (\n                <Card key={index}>\n                  <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                    <CardTitle className=\"text-sm font-medium\">\n                      {stat.label}\n                    </CardTitle>\n                    <Icon className={`h-4 w-4 ${stat.color}`} />\n                  </CardHeader>\n                  <CardContent>\n                    <div className={`text-3xl font-bold font-mono ${stat.color}`}>\n                      {stat.valor}\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n\n          {/* Sondeos Activos */}\n          <section className=\"mb-12\">\n            <div className=\"flex items-center gap-2 mb-6\">\n              <h2 className=\"text-2xl font-semibold font-[Poppins]\">\n                Sondeos Activos\n              </h2>\n              <Badge variant=\"default\" className=\"font-mono\">\n                {sondeosActivos.length}\n              </Badge>\n            </div>\n\n            {isLoading ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : sondeosActivos.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <p className=\"text-muted-foreground\">No hay sondeos activos en este momento</p>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {sondeosActivos.map((sondeo: any) => (\n                  <PollCard \n                    key={sondeo.id} \n                    {...sondeo} \n                    hasVoted={votedPollIds.includes(sondeo.id)}\n                    onVote={handleVote}\n                  />\n                ))}\n              </div>\n            )}\n          </section>\n\n          {/* Sondeos Cerrados */}\n          <section>\n            <div className=\"flex items-center gap-2 mb-6\">\n              <h2 className=\"text-2xl font-semibold font-[Poppins]\">\n                Resultados de Sondeos Anteriores\n              </h2>\n              <Badge variant=\"secondary\" className=\"font-mono\">\n                {sondeosCerrados.length}\n              </Badge>\n            </div>\n\n            {isLoading ? (\n              <div className=\"flex justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : sondeosCerrados.length === 0 ? (\n              <div className=\"text-center py-12\">\n                <p className=\"text-muted-foreground\">No hay sondeos cerrados disponibles</p>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n                {sondeosCerrados.map((sondeo: any) => (\n                  <PollCard \n                    key={sondeo.id} \n                    {...sondeo} \n                    hasVoted={true}\n                    onVote={handleVote}\n                  />\n                ))}\n              </div>\n            )}\n          </section>\n\n          {/* Información sobre participación */}\n          <Card className=\"mt-12\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"h-5 w-5 text-primary\" />\n                ¿Por qué participar en sondeos?\n              </CardTitle>\n              <CardDescription>\n                Tu opinión ayuda a tomar mejores decisiones\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div className=\"p-4 rounded-md bg-muted\">\n                  <h3 className=\"font-semibold mb-2\">Gana Tokens TP</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Obtén 10 TP por cada sondeo en el que participes\n                  </p>\n                </div>\n                <div className=\"p-4 rounded-md bg-muted\">\n                  <h3 className=\"font-semibold mb-2\">Influye en Decisiones</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Los resultados se usan para guiar políticas públicas\n                  </p>\n                </div>\n                <div className=\"p-4 rounded-md bg-muted\">\n                  <h3 className=\"font-semibold mb-2\">Transparencia Total</h3>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Todos los resultados son públicos y verificables\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":9413},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/pages/Home.tsx":{"content":"// Página de inicio/landing para la plataforma Neurolex\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, Vote, TrendingUp, Coins, Award, Shield, MessageSquare, BarChart3 } from \"lucide-react\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport evotingBannerUrl from \"@assets/Evoting banner_1761708286562.png\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nexport default function Home() {\n  // Obtener userId del localStorage\n  const userId = localStorage.getItem(\"userId\");\n\n  // Cargar datos del usuario si está autenticado\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens si está autenticado\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const features = [\n    {\n      icon: Vote,\n      titulo: \"Votación Transparente\",\n      descripcion: \"Sistema de e-voting seguro y transparente con verificación en blockchain\",\n    },\n    {\n      icon: TrendingUp,\n      titulo: \"Participación Incentivada\",\n      descripcion: \"Gana tokens por participar activamente en la plataforma\",\n    },\n    {\n      icon: MessageSquare,\n      titulo: \"Deliberación Informada\",\n      descripcion: \"Debate y discute propuestas con otros ciudadanos\",\n    },\n    {\n      icon: Shield,\n      titulo: \"Gobernanza Comunitaria\",\n      descripcion: \"Participa en decisiones que afectan a tu comunidad\",\n    },\n  ];\n\n  const tokenTypes = [\n    {\n      tipo: \"TP\",\n      nombre: \"Tokens de Participación\",\n      descripcion: \"Obtén TP al votar, comentar y participar activamente. Úsalos para apoyar propuestas y acceder a contenido premium.\",\n      icon: TrendingUp,\n      color: \"from-blue-500 to-blue-700\",\n    },\n    {\n      tipo: \"TA\",\n      nombre: \"Tokens de Apoyo\",\n      descripcion: \"Compra TA para financiar propuestas ciudadanas y partidos políticos. Total transparencia en las donaciones.\",\n      icon: Coins,\n      color: \"from-green-500 to-green-700\",\n    },\n    {\n      tipo: \"TGR\",\n      nombre: \"Tokens de Gobernanza\",\n      descripcion: \"Otorgados a roles clave de la plataforma. Participan en decisiones sobre la evolución de Neurolex.\",\n      icon: Award,\n      color: \"from-purple-500 to-purple-700\",\n    },\n  ];\n\n  const steps = [\n    { numero: 1, titulo: \"Regístrate\", descripcion: \"Crea tu cuenta gratuita en menos de 1 minuto\" },\n    { numero: 2, titulo: \"Explora\", descripcion: \"Descubre propuestas, noticias y sondeos activos\" },\n    { numero: 3, titulo: \"Participa\", descripcion: \"Vota, comenta y crea propuestas ciudadanas\" },\n    { numero: 4, titulo: \"Gana Tokens\", descripcion: \"Acumula TP por tu participación activa\" },\n    { numero: 5, titulo: \"Influye\", descripcion: \"Usa tus tokens para apoyar causas que te importan\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n      \n      {/* Hero Section */}\n      <section className=\"relative min-h-[600px] md:min-h-[700px] flex items-center justify-center overflow-hidden bg-gradient-to-br from-primary/20 via-background to-background\">\n        <div className=\"absolute inset-0 bg-gradient-to-b from-transparent via-background/50 to-background z-10\" />\n        <div className=\"absolute inset-0 opacity-10\">\n          <div className=\"absolute top-0 left-0 w-96 h-96 bg-primary rounded-full blur-3xl\" />\n          <div className=\"absolute bottom-0 right-0 w-96 h-96 bg-primary rounded-full blur-3xl\" />\n        </div>\n        \n        <div className=\"relative z-20 max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-20 text-center\">\n          <Badge className=\"mb-6\" data-testid=\"badge-hero-tag\">\n            Plataforma de Democracia Digital\n          </Badge>\n          \n          <h1 className=\"text-4xl md:text-5xl lg:text-6xl font-bold font-[Poppins] mb-6 bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent\">\n            Tu Voz, Tu Futuro\n          </h1>\n          \n          <p className=\"text-lg md:text-xl text-muted-foreground max-w-3xl mx-auto mb-8\">\n            Neurolex es la plataforma de gobernanza y participación cívica que empodera a los ciudadanos \n            para tomar decisiones informadas y transparentes sobre su futuro.\n          </p>\n          \n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center items-center\">\n            <Link href=\"/registro\">\n              <Button size=\"lg\" className=\"text-lg px-8\" data-testid=\"button-hero-register\">\n                Comenzar Ahora\n              </Button>\n            </Link>\n            <Link href=\"/informacion\">\n              <Button size=\"lg\" variant=\"outline\" className=\"text-lg px-8\" data-testid=\"button-hero-learn\">\n                Saber Más\n              </Button>\n            </Link>\n          </div>\n\n          <div className=\"mt-12 grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto\">\n            {[\n              { numero: \"10K+\", label: \"Usuarios Activos\" },\n              { numero: \"500+\", label: \"Propuestas\" },\n              { numero: \"50K+\", label: \"Votos Emitidos\" },\n              { numero: \"100%\", label: \"Transparente\" },\n            ].map((stat, index) => (\n              <div key={index} className=\"text-center\">\n                <p className=\"text-3xl md:text-4xl font-bold font-mono text-primary\">{stat.numero}</p>\n                <p className=\"text-sm text-muted-foreground mt-1\">{stat.label}</p>\n              </div>\n            ))}\n          </div>\n        </div>\n      </section>\n\n      {/* Características Principales */}\n      <section className=\"py-20 bg-card\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-4\">\n              Tres Pilares de la Democracia Digital\n            </h2>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Participación, Transparencia y Gobernanza al alcance de todos\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n            {features.map((feature, index) => {\n              const Icon = feature.icon;\n              return (\n                <Card key={index} className=\"hover-elevate text-center\">\n                  <CardHeader>\n                    <div className=\"mx-auto mb-4 p-4 rounded-full bg-primary/10 w-fit\">\n                      <Icon className=\"h-8 w-8 text-primary\" />\n                    </div>\n                    <CardTitle className=\"text-lg\">{feature.titulo}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <CardDescription>{feature.descripcion}</CardDescription>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* Sistema de Tokens */}\n      <section className=\"py-20\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-4\">\n              Sistema de Tokens\n            </h2>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Incentivamos la participación cívica con un sistema de tokens transparente\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            {tokenTypes.map((token, index) => {\n              const Icon = token.icon;\n              return (\n                <Card key={index} className=\"hover-elevate overflow-hidden\">\n                  <div className={`h-2 bg-gradient-to-r ${token.color}`} />\n                  <CardHeader>\n                    <div className=\"flex items-center gap-3 mb-2\">\n                      <div className={`p-2 rounded-md bg-gradient-to-br ${token.color}`}>\n                        <Icon className=\"h-5 w-5 text-white\" />\n                      </div>\n                      <div>\n                        <Badge variant=\"outline\" className=\"font-mono font-bold\">\n                          {token.tipo}\n                        </Badge>\n                      </div>\n                    </div>\n                    <CardTitle className=\"text-xl\">{token.nombre}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <CardDescription>{token.descripcion}</CardDescription>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n      </section>\n\n      {/* Cómo Funciona */}\n      <section className=\"py-20 bg-card\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-4\">\n              Cómo Funciona\n            </h2>\n            <p className=\"text-lg text-muted-foreground max-w-2xl mx-auto\">\n              Comienza tu viaje en la democracia digital en 5 simples pasos\n            </p>\n          </div>\n\n          <div className=\"relative\">\n            {/* Timeline conectora - Desktop */}\n            <div className=\"hidden md:block absolute top-1/2 left-0 right-0 h-1 bg-primary/20 -translate-y-1/2 z-0\" />\n\n            <div className=\"grid grid-cols-1 md:grid-cols-5 gap-6 relative z-10\">\n              {steps.map((step) => (\n                <div key={step.numero} className=\"text-center\">\n                  <div className=\"mx-auto mb-4 w-16 h-16 rounded-full bg-primary flex items-center justify-center text-2xl font-bold font-mono text-primary-foreground\">\n                    {step.numero}\n                  </div>\n                  <h3 className=\"font-semibold text-lg mb-2\">{step.titulo}</h3>\n                  <p className=\"text-sm text-muted-foreground\">{step.descripcion}</p>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Banner E-voting */}\n      <section className=\"py-20\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8\">\n          <Card className=\"overflow-hidden\">\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-0\">\n              <div className=\"p-8 md:p-12 flex flex-col justify-center\">\n                <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-4\">\n                  Votación Electrónica Segura\n                </h2>\n                <p className=\"text-lg text-muted-foreground mb-6\">\n                  Nuestro sistema de e-voting utiliza tecnología blockchain para garantizar \n                  la transparencia, seguridad e inmutabilidad de cada voto.\n                </p>\n                <ul className=\"space-y-3 mb-6\">\n                  <li className=\"flex items-start gap-2\">\n                    <Shield className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                    <span className=\"text-sm\">Verificación de identidad multinivel</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <BarChart3 className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                    <span className=\"text-sm\">Resultados en tiempo real</span>\n                  </li>\n                  <li className=\"flex items-start gap-2\">\n                    <Users className=\"h-5 w-5 text-primary mt-0.5 flex-shrink-0\" />\n                    <span className=\"text-sm\">Auditoría pública transparente</span>\n                  </li>\n                </ul>\n                <Link href=\"/registro\">\n                  <Button size=\"lg\" data-testid=\"button-evoting-cta\">\n                    Participar Ahora\n                  </Button>\n                </Link>\n              </div>\n              <div className=\"bg-muted flex items-center justify-center p-8\">\n                <img \n                  src={evotingBannerUrl} \n                  alt=\"E-voting Neurolex\" \n                  className=\"w-full h-full object-contain\"\n                />\n              </div>\n            </div>\n          </Card>\n        </div>\n      </section>\n\n      {/* CTA Final */}\n      <section className=\"py-20 bg-primary/5\">\n        <div className=\"max-w-4xl mx-auto px-4 md:px-6 lg:px-8 text-center\">\n          <h2 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-4\">\n            Haz que tu voz cuente\n          </h2>\n          <p className=\"text-lg text-muted-foreground mb-8 max-w-2xl mx-auto\">\n            Únete a miles de ciudadanos que ya están participando activamente en la construcción \n            de una democracia más transparente y participativa.\n          </p>\n          <Link href=\"/registro\">\n            <Button size=\"lg\" className=\"text-lg px-8\" data-testid=\"button-final-cta\">\n              Crear Cuenta Gratuita\n            </Button>\n          </Link>\n        </div>\n      </section>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":13170},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/TokenCard.tsx":{"content":"// Tarjeta de visualización de tokens para la plataforma Neurolex\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Coins, TrendingUp, Award } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface TokenCardProps {\n  tipo: \"TP\" | \"TA\" | \"TGR\";\n  cantidad: number;\n  descripcion: string;\n  className?: string;\n}\n\nconst tokenConfig = {\n  TP: {\n    nombre: \"Tokens de Participación\",\n    icon: TrendingUp,\n    color: \"text-blue-600 dark:text-blue-400\",\n    bgColor: \"bg-blue-100 dark:bg-blue-950\",\n  },\n  TA: {\n    nombre: \"Tokens de Apoyo\",\n    icon: Coins,\n    color: \"text-green-600 dark:text-green-400\",\n    bgColor: \"bg-green-100 dark:bg-green-950\",\n  },\n  TGR: {\n    nombre: \"Tokens de Gobernanza\",\n    icon: Award,\n    color: \"text-purple-600 dark:text-purple-400\",\n    bgColor: \"bg-purple-100 dark:bg-purple-950\",\n  },\n};\n\nexport function TokenCard({ tipo, cantidad, descripcion, className }: TokenCardProps) {\n  const config = tokenConfig[tipo];\n  const Icon = config.icon;\n\n  return (\n    <Card className={cn(\"hover-elevate\", className)} data-testid={`card-token-${tipo}`}>\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n            {config.nombre}\n          </CardTitle>\n          <div className={cn(\"p-2 rounded-md\", config.bgColor)}>\n            <Icon className={cn(\"h-4 w-4\", config.color)} />\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col gap-1\">\n          <p className={cn(\"text-4xl font-bold font-mono\", config.color)} data-testid={`text-token-amount-${tipo}`}>\n            {cantidad.toLocaleString()}\n          </p>\n          <CardDescription className=\"text-xs\">\n            {descripcion}\n          </CardDescription>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1948},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ProposalCard.tsx":{"content":"// Tarjeta de propuesta ciudadana para la plataforma Neurolex\nimport { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { ThumbsUp, MessageSquare, TrendingUp, Coins, Heart } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport { Link } from \"wouter\";\nimport { DonateModal } from \"./DonateModal\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface ProposalCardProps {\n  id: string;\n  titulo: string;\n  descripcion: string;\n  categoria: string;\n  estado: string;\n  apoyosTP: number;\n  apoyosTA: number;\n  autorNombre: string;\n  createdAt: Date;\n  numComentarios?: number;\n  userTokensBalance?: { tokensParticipacion: number; tokensApoyo: number; tokensGobernanza: number } | null;\n}\n\nconst estadoConfig: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  borrador: { label: \"Borrador\", variant: \"secondary\" },\n  en_deliberacion: { label: \"En Deliberación\", variant: \"default\" },\n  votacion: { label: \"En Votación\", variant: \"default\" },\n  aprobada: { label: \"Aprobada\", variant: \"default\" },\n  rechazada: { label: \"Rechazada\", variant: \"destructive\" },\n  archivada: { label: \"Archivada\", variant: \"outline\" },\n};\n\nexport function ProposalCard({\n  id,\n  titulo,\n  descripcion,\n  categoria,\n  estado,\n  apoyosTP,\n  apoyosTA,\n  autorNombre,\n  createdAt,\n  numComentarios = 0,\n  userTokensBalance = null,\n}: ProposalCardProps) {\n  const estadoInfo = estadoConfig[estado] || estadoConfig.borrador;\n  const tiempoRelativo = formatDistanceToNow(new Date(createdAt), { addSuffix: true, locale: es });\n  const [isDonateModalOpen, setIsDonateModalOpen] = useState(false);\n  const { toast } = useToast();\n  const userId = localStorage.getItem(\"userId\");\n  \n  const hasEnoughTokens = userTokensBalance && userTokensBalance.tokensParticipacion >= 1;\n\n  const supportMutation = useMutation({\n    mutationFn: async () => {\n      if (!userId) {\n        throw new Error(\"Debes iniciar sesión para apoyar una propuesta\");\n      }\n      return apiRequest(\"POST\", `/api/proposals/${id}/support`, {\n        userId,\n        tipoToken: \"TP\",\n        cantidad: 1,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens\", userId] });\n      toast({\n        title: \"¡Apoyo enviado!\",\n        description: \"Has apoyado esta propuesta con 1 Token de Participación\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo enviar el apoyo\",\n      });\n    },\n  });\n\n  const handleSupport = () => {\n    if (!userId) {\n      toast({\n        variant: \"destructive\",\n        title: \"Inicia sesión\",\n        description: \"Debes iniciar sesión para apoyar propuestas\",\n      });\n      return;\n    }\n    if (!hasEnoughTokens) {\n      toast({\n        variant: \"destructive\",\n        title: \"Tokens insuficientes\",\n        description: \"Necesitas al menos 1 Token de Participación para apoyar una propuesta\",\n      });\n      return;\n    }\n    supportMutation.mutate();\n  };\n\n  return (\n    <Card className=\"hover-elevate h-full flex flex-col\" data-testid={`card-proposal-${id}`}>\n      <CardHeader className=\"flex-none\">\n        <div className=\"flex items-start justify-between gap-2 mb-2\">\n          <Badge variant=\"outline\" data-testid={`badge-category-${id}`}>\n            {categoria}\n          </Badge>\n          <Badge variant={estadoInfo.variant} data-testid={`badge-status-${id}`}>\n            {estadoInfo.label}\n          </Badge>\n        </div>\n        <CardTitle className=\"text-xl line-clamp-2\" data-testid={`text-proposal-title-${id}`}>\n          {titulo}\n        </CardTitle>\n        <CardDescription className=\"text-xs text-muted-foreground\">\n          Por {autorNombre} • {tiempoRelativo}\n        </CardDescription>\n      </CardHeader>\n\n      <CardContent className=\"flex-1\">\n        <p className=\"text-sm text-muted-foreground line-clamp-3\" data-testid={`text-proposal-description-${id}`}>\n          {descripcion}\n        </p>\n      </CardContent>\n\n      <CardFooter className=\"flex-none flex-col gap-3\">\n        {/* Estadísticas de apoyo */}\n        <div className=\"flex items-center justify-between w-full text-sm\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"flex items-center gap-1 text-muted-foreground\">\n              <TrendingUp className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n              <span className=\"font-mono font-semibold\" data-testid={`text-support-tp-${id}`}>\n                {apoyosTP}\n              </span>\n              <span className=\"text-xs\">TP</span>\n            </div>\n            <div className=\"flex items-center gap-1 text-muted-foreground\">\n              <Coins className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n              <span className=\"font-mono font-semibold\" data-testid={`text-support-ta-${id}`}>\n                {apoyosTA}\n              </span>\n              <span className=\"text-xs\">TA</span>\n            </div>\n            <div className=\"flex items-center gap-1 text-muted-foreground\">\n              <MessageSquare className=\"h-4 w-4\" />\n              <span className=\"font-mono\" data-testid={`text-comments-${id}`}>\n                {numComentarios}\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Acciones */}\n        <div className=\"flex items-center gap-2 w-full\">\n          <Link href={`/propuestas/${id}`} className=\"flex-1\">\n            <Button variant=\"outline\" className=\"w-full\" data-testid={`button-view-proposal-${id}`}>\n              Ver Detalles\n            </Button>\n          </Link>\n          <Button \n            variant=\"default\" \n            size=\"icon\" \n            onClick={() => setIsDonateModalOpen(true)}\n            data-testid={`button-donate-${id}`}\n          >\n            <Heart className=\"h-4 w-4\" />\n          </Button>\n          <Button \n            variant=\"default\" \n            size=\"icon\" \n            onClick={handleSupport}\n            disabled={supportMutation.isPending || !userId || !hasEnoughTokens}\n            data-testid={`button-support-${id}`}\n            title={!hasEnoughTokens ? \"Tokens insuficientes\" : \"Apoyar con 1 TP\"}\n          >\n            <ThumbsUp className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </CardFooter>\n\n      {/* Modal de donación */}\n      <DonateModal\n        isOpen={isDonateModalOpen}\n        onClose={() => setIsDonateModalOpen(false)}\n        proposalId={id}\n        proposalTitle={titulo}\n      />\n    </Card>\n  );\n}\n","size_bytes":6981},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5741},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/pages/not-found.tsx":{"content":"// Página 404 para Neurolex\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Home, Search } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex flex-col items-center justify-center bg-gradient-to-br from-primary/5 via-background to-background p-4\">\n      <div className=\"text-center max-w-md\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-9xl font-bold font-mono text-primary mb-4\">404</h1>\n          <h2 className=\"text-3xl font-bold font-[Poppins] mb-2\">\n            Página no encontrada\n          </h2>\n          <p className=\"text-muted-foreground\">\n            Lo sentimos, la página que buscas no existe o ha sido movida.\n          </p>\n        </div>\n\n        <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n          <Link href=\"/\">\n            <Button size=\"lg\" data-testid=\"button-home\">\n              <Home className=\"h-4 w-4 mr-2\" />\n              Volver al Inicio\n            </Button>\n          </Link>\n          <Link href=\"/propuestas\">\n            <Button size=\"lg\" variant=\"outline\" data-testid=\"button-explore\">\n              <Search className=\"h-4 w-4 mr-2\" />\n              Explorar Propuestas\n            </Button>\n          </Link>\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1340},"server/blockchain-verifier.ts":{"content":"// Servicio para verificar transacciones blockchain en Sepolia testnet\nimport { JsonRpcProvider, TransactionResponse } from \"ethers\";\nimport { BLOCKCHAIN_CONFIG, calculateETHPrice } from \"../shared/blockchain-config\";\n\n// Configurar provider de Sepolia\nconst provider = new JsonRpcProvider(\"https://sepolia.infura.io/v3/\");\n\n// Caché de transacciones verificadas (evitar duplicados)\nconst verifiedTxHashes = new Set<string>();\n\ninterface VerificationResult {\n  valid: boolean;\n  error?: string;\n  transaction?: TransactionResponse;\n}\n\n/**\n * Verifica que una transacción blockchain sea válida\n * @param txHash - Hash de la transacción\n * @param expectedAmount - Cantidad esperada en ETH\n * @param expectedTo - Dirección esperada del receptor\n * @param expectedFrom - Dirección esperada del remitente (wallet del usuario)\n * @returns Resultado de la verificación\n */\nexport async function verifyTransaction(\n  txHash: string,\n  expectedAmount: string,\n  expectedTo: string,\n  expectedFrom: string\n): Promise<VerificationResult> {\n  try {\n    // 1. Validar formato del hash\n    if (!txHash || !txHash.startsWith(\"0x\") || txHash.length !== 66) {\n      return {\n        valid: false,\n        error: \"Formato de hash de transacción inválido\",\n      };\n    }\n\n    // 2. Verificar que no haya sido usado antes\n    if (verifiedTxHashes.has(txHash)) {\n      return {\n        valid: false,\n        error: \"Esta transacción ya fue procesada anteriormente\",\n      };\n    }\n\n    // 3. Obtener transacción de la blockchain\n    const tx = await provider.getTransaction(txHash);\n    \n    if (!tx) {\n      return {\n        valid: false,\n        error: \"Transacción no encontrada en la blockchain\",\n      };\n    }\n\n    // 4. Verificar que la transacción esté confirmada\n    const receipt = await provider.getTransactionReceipt(txHash);\n    if (!receipt) {\n      return {\n        valid: false,\n        error: \"Transacción aún no confirmada. Por favor espera unos minutos.\",\n      };\n    }\n\n    // 5. Verificar que la transacción fue exitosa\n    if (receipt.status !== 1) {\n      return {\n        valid: false,\n        error: \"La transacción falló en la blockchain\",\n      };\n    }\n\n    // 6. Verificar el receptor (wallet de la plataforma)\n    if (tx.to?.toLowerCase() !== expectedTo.toLowerCase()) {\n      return {\n        valid: false,\n        error: `Dirección de destino incorrecta. Se esperaba ${expectedTo} pero se recibió ${tx.to}`,\n      };\n    }\n\n    // 6.5 CRÍTICO: Verificar el remitente (wallet del usuario que hace la compra)\n    if (tx.from?.toLowerCase() !== expectedFrom.toLowerCase()) {\n      return {\n        valid: false,\n        error: `La transacción no fue enviada desde tu wallet. Se esperaba ${expectedFrom} pero se recibió ${tx.from}`,\n      };\n    }\n\n    // 7. Verificar el monto (con tolerancia de ±0.0001 ETH por fees)\n    const actualETH = parseFloat((Number(tx.value) / 1e18).toFixed(6));\n    const expectedETH = parseFloat(expectedAmount);\n    const tolerance = 0.0001;\n\n    if (Math.abs(actualETH - expectedETH) > tolerance) {\n      return {\n        valid: false,\n        error: `Monto incorrecto. Se esperaba ${expectedETH} ETH pero se recibió ${actualETH} ETH`,\n      };\n    }\n\n    // 8. Marcar como verificado para evitar duplicados\n    verifiedTxHashes.add(txHash);\n\n    return {\n      valid: true,\n      transaction: tx,\n    };\n  } catch (error: any) {\n    console.error(\"Error al verificar transacción blockchain:\", error);\n    return {\n      valid: false,\n      error: `Error al verificar transacción: ${error.message}`,\n    };\n  }\n}\n\n/**\n * Valida los parámetros de compra de tokens\n * @param taAmount - Cantidad de TA tokens a comprar\n * @param ethAmount - Cantidad en ETH\n * @returns true si es válido, string con error si no\n */\nexport function validatePurchaseParams(\n  taAmount: number,\n  ethAmount: string\n): { valid: boolean; error?: string } {\n  // Validar cantidad de TA\n  if (taAmount < BLOCKCHAIN_CONFIG.tokenPrice.minPurchase) {\n    return {\n      valid: false,\n      error: `Debes comprar al menos ${BLOCKCHAIN_CONFIG.tokenPrice.minPurchase} TA`,\n    };\n  }\n\n  if (taAmount > BLOCKCHAIN_CONFIG.tokenPrice.maxPurchase) {\n    return {\n      valid: false,\n      error: `Puedes comprar máximo ${BLOCKCHAIN_CONFIG.tokenPrice.maxPurchase} TA`,\n    };\n  }\n\n  // Validar que la cantidad sea entera y positiva\n  if (!Number.isInteger(taAmount) || taAmount <= 0) {\n    return {\n      valid: false,\n      error: \"La cantidad de TA debe ser un número entero positivo\",\n    };\n  }\n\n  // Validar congruencia entre TA y ETH\n  const expectedETH = calculateETHPrice(taAmount);\n  const providedETH = parseFloat(ethAmount);\n  const tolerance = 0.0001;\n\n  if (Math.abs(providedETH - parseFloat(expectedETH)) > tolerance) {\n    return {\n      valid: false,\n      error: `Cantidad ETH incorrecta. Para ${taAmount} TA se requieren ${expectedETH} ETH`,\n    };\n  }\n\n  return { valid: true };\n}\n","size_bytes":4935},"client/src/pages/Admin.tsx":{"content":"// Panel de Administración - Dashboard principal\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { \n  Users, \n  Newspaper, \n  FileText, \n  BarChart3, \n  Shield, \n  AlertCircle,\n  Loader2,\n  MessageSquare \n} from \"lucide-react\";\nimport { useEffect } from \"react\";\nimport { useLocation, Link } from \"wouter\";\n\nexport default function Admin() {\n  const [, setLocation] = useLocation();\n  const userId = localStorage.getItem(\"userId\");\n\n  // Redirigir al login si no está autenticado\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  // Cargar datos del usuario\n  const { data: user, isLoading: loadingUser } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar estadísticas (requiere ser admin)\n  const { data: stats, isLoading: loadingStats, isError } = useQuery<any>({\n    queryKey: [\"/api/admin/stats\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/admin/stats?adminId=${userId}`);\n      if (!res.ok) throw new Error(\"Error al cargar estadísticas\");\n      return res.json();\n    },\n    enabled: !!userId,\n  });\n\n  // Verificar que el usuario sea admin\n  if (loadingUser || !user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!user.isAdmin) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} />\n        <main className=\"flex-1 flex items-center justify-center bg-background\">\n          <Card className=\"max-w-md\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2 text-destructive\">\n                <AlertCircle className=\"h-5 w-5\" />\n                <CardTitle>Acceso Denegado</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                No tienes permisos para acceder al panel de administración.\n              </p>\n              <Link href=\"/dashboard\">\n                <Button>Volver al Dashboard</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Shield className=\"h-8 w-8 text-primary\" />\n              <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins]\" data-testid=\"text-admin-title\">\n                Panel de Administración\n              </h1>\n            </div>\n            <p className=\"text-muted-foreground\">\n              Gestiona el contenido y usuarios de Neurolex\n            </p>\n          </div>\n\n          {/* Estadísticas */}\n          <section className=\"mb-8\">\n            <h2 className=\"text-2xl font-semibold font-[Poppins] mb-4\">Estadísticas Generales</h2>\n            {loadingStats ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {[1, 2, 3, 4, 5, 6].map((i) => (\n                  <Card key={i} className=\"h-32 flex items-center justify-center\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                  </Card>\n                ))}\n              </div>\n            ) : isError ? (\n              <Card className=\"border-destructive\">\n                <CardContent className=\"pt-6\">\n                  <p className=\"text-destructive\">Error al cargar estadísticas</p>\n                </CardContent>\n              </Card>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                <Card className=\"hover-elevate\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                        Total de Usuarios\n                      </CardTitle>\n                      <Users className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-4xl font-bold text-blue-600 dark:text-blue-400\">\n                      {stats?.totalUsers || 0}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground mt-1\">\n                      {stats?.verifiedUsers || 0} verificados\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"hover-elevate\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                        Noticias Publicadas\n                      </CardTitle>\n                      <Newspaper className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-4xl font-bold text-green-600 dark:text-green-400\">\n                      {stats?.totalNews || 0}\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"hover-elevate\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                        Propuestas Activas\n                      </CardTitle>\n                      <FileText className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-4xl font-bold text-purple-600 dark:text-purple-400\">\n                      {stats?.totalProposals || 0}\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"hover-elevate\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                        Sondeos Totales\n                      </CardTitle>\n                      <BarChart3 className=\"h-4 w-4 text-orange-600 dark:text-orange-400\" />\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-4xl font-bold text-orange-600 dark:text-orange-400\">\n                      {stats?.totalPolls || 0}\n                    </p>\n                  </CardContent>\n                </Card>\n\n                <Card className=\"hover-elevate\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                        Administradores\n                      </CardTitle>\n                      <Shield className=\"h-4 w-4 text-red-600 dark:text-red-400\" />\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-4xl font-bold text-red-600 dark:text-red-400\">\n                      {stats?.adminUsers || 0}\n                    </p>\n                  </CardContent>\n                </Card>\n              </div>\n            )}\n          </section>\n\n          {/* Acciones Rápidas */}\n          <section>\n            <h2 className=\"text-2xl font-semibold font-[Poppins] mb-4\">Gestión de Contenido</h2>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n              <Link href=\"/admin/noticias\">\n                <Card className=\"hover-elevate cursor-pointer h-full\" data-testid=\"card-admin-news\">\n                  <CardHeader>\n                    <Newspaper className=\"h-8 w-8 text-primary mb-2\" />\n                    <CardTitle>Noticias</CardTitle>\n                    <CardDescription>\n                      Crear, editar y eliminar noticias políticas\n                    </CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n\n              <Link href=\"/admin/propuestas\">\n                <Card className=\"hover-elevate cursor-pointer h-full\" data-testid=\"card-admin-proposals\">\n                  <CardHeader>\n                    <FileText className=\"h-8 w-8 text-primary mb-2\" />\n                    <CardTitle>Propuestas</CardTitle>\n                    <CardDescription>\n                      Moderar y cambiar estados de propuestas\n                    </CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n\n              <Link href=\"/admin/sondeos\">\n                <Card className=\"hover-elevate cursor-pointer h-full\" data-testid=\"card-admin-polls\">\n                  <CardHeader>\n                    <BarChart3 className=\"h-8 w-8 text-primary mb-2\" />\n                    <CardTitle>Sondeos</CardTitle>\n                    <CardDescription>\n                      Crear y gestionar sondeos de opinión\n                    </CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n\n              <Link href=\"/admin/debates\">\n                <Card className=\"hover-elevate cursor-pointer h-full\" data-testid=\"card-admin-debates\">\n                  <CardHeader>\n                    <MessageSquare className=\"h-8 w-8 text-primary mb-2\" />\n                    <CardTitle>Debates</CardTitle>\n                    <CardDescription>\n                      Gestionar debates del foro comunitario\n                    </CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n\n              <Link href=\"/admin/usuarios\">\n                <Card className=\"hover-elevate cursor-pointer h-full\" data-testid=\"card-admin-users\">\n                  <CardHeader>\n                    <Users className=\"h-8 w-8 text-primary mb-2\" />\n                    <CardTitle>Usuarios</CardTitle>\n                    <CardDescription>\n                      Gestionar niveles y permisos de usuarios\n                    </CardDescription>\n                  </CardHeader>\n                </Card>\n              </Link>\n            </div>\n          </section>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":10986},"replit.md":{"content":"# Neurolex - Plataforma de Gobernanza y Participación Cívica\n\n## Overview\n\nNeurolex is a digital democracy platform for civic participation and community governance. It offers e-voting, citizen proposals, political news, polls, and a transparent token-based incentive system. The platform aims to foster informed deliberation and active citizen participation in democratic processes.\n\nThe full-stack web platform features a React frontend and Express backend, user authentication, gamification (karma and badges), a three-tier token economy (Participation, Support, and Governance tokens), and blockchain integration via MetaMask.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework & Build System:**\n- React 18+ with TypeScript\n- Vite for building and development\n- Wouter for client-side routing\n- TanStack Query for server state management\n\n**UI Component System:**\n- Shadcn/ui (New York style)\n- Radix UI primitives\n- Tailwind CSS with custom design tokens\n- Class Variance Authority (CVA) for component variants\n\n**Design System:**\n- Material Design adapted from GOV.UK and e-Estonia\n- Typography: Inter (primary), Poppins (headings), JetBrains Mono (data/numbers)\n- Strict spacing system\n- Custom CSS variables for theming with light/dark mode\n- WCAG 2.1 AA accessibility compliance\n\n**State Management:**\n- React Query for server state\n- React Hook Form with Zod for form state and validation\n- LocalStorage for basic session persistence (userId)\n- Context API for component-level state\n\n### Backend Architecture\n\n**Framework & Runtime:**\n- Express.js server on Node.js\n- TypeScript for type safety\n- ESM (ES Modules)\n\n**API Design:**\n- RESTful API endpoints under `/api`\n- JSON-based request/response, all in Spanish\n- Session-based authentication with cookies\n- Request logging middleware\n\n**Authentication & Security:**\n- Bcrypt for password hashing\n- Session-based authentication\n- User levels: \"basico\" and \"verificado\"\n- Admin role with `isAdmin=true` for admin panel access\n- Admin middleware for route protection\n\n**Data Validation:**\n- Zod schemas for runtime validation, shared between frontend and backend\n- Custom validation helper for user-friendly error messages\n\n### Data Storage Architecture\n\n**Database:**\n- PostgreSQL as the primary database\n- Neon Serverless PostgreSQL for cloud hosting\n- WebSocket-based connection\n\n**ORM & Schema Management:**\n- Drizzle ORM for type-safe queries\n- Schema-first approach with TypeScript type inference\n- Drizzle-kit for migration management\n- Relational data modeling\n\n**Data Models:**\n- **Users:** Authentication, profile, political affinity, karma, gamification level, admin flag.\n- **Tokens System:** Three token types (TP, TA, TGR) with balance tracking.\n- **Token Transactions:** Full transaction history with details.\n- **Content Models:** News articles, citizen proposals, polls, debates (forum system).\n- **Engagement:** Comments (supports proposals, news, and debates), votes, karma history.\n- **Gamification:** Badges and user assignments.\n- **Communication:** Contact form submissions.\n- **Admin Features:** CRUD for news, proposal moderation, poll creation, debate management, user management.\n- **Forum/Debates:** Community discussion threads with categorization, view tracking, and response counting.\n\n**Key Enumerations:**\n- User levels, token types, proposal states, news types, and transaction types defined as PostgreSQL enums.\n\n## External Dependencies\n\n**Core Infrastructure:**\n- Neon Serverless PostgreSQL\n\n**Blockchain Integration:**\n- MetaMask browser extension via Ethers.js v6\n- Web3 hook for wallet connection and account management\n- Ethereum provider detection\n\n**UI & Component Libraries:**\n- Radix UI component primitives\n- Tailwind CSS\n- Lucide React for icons\n- date-fns for date formatting\n\n**Form & Validation:**\n- React Hook Form\n- Zod\n- @hookform/resolvers for Zod integration\n\n**Development Tools:**\n- Replit-specific plugins\n- ESBuild for server-side bundling\n- PostCSS with Autoprefixer\n\n**Font Resources:**\n- Google Fonts (Inter, Poppins, etc.) via CDN\n\n**Session Management:**\n- connect-pg-simple for PostgreSQL-backed session storage\n\n**Additional Libraries:**\n- cmdk for command palette\n- vaul for drawer components\n- embla-carousel-react for carousels\n- recharts for data visualization\n- clsx and tailwind-merge for className utilities\n- nanoid for unique ID generation\n\n## Recent Changes\n\n### October 30, 2025 - Página de Detalle de Propuestas Implementada\n\n**Problema Resuelto:**\n- ❌ Al hacer clic en \"Ver Detalles\" de una propuesta, se redirigía a página 404\n- ❌ No existía ruta `/propuestas/:id` registrada en App.tsx\n- ❌ No existía componente PropuestaDetalle.tsx\n\n**Implementación:**\n- Creada página `client/src/pages/PropuestaDetalle.tsx`:\n  - Sigue el patrón de ForoDetalle.tsx para consistencia\n  - Usa `useParams` para obtener el ID de la propuesta\n  - Carga datos de propuesta con query `[\"/api/proposals\", id]`\n  - Carga comentarios con query `[\"/api/comments/proposal\", id]`\n  - Muestra título, descripción, categoría, estado, apoyos (TP/TA)\n  - Sección de comentarios con formulario para agregar nuevos\n  - Botón \"Apoyar con 1 TP\" con validación de tokens\n  - Botón \"Donar Tokens de Apoyo\" abre modal de donación\n  - Botón \"Volver a Propuestas\" para navegación\n- Registrada ruta `/propuestas/:id` en `client/src/App.tsx`\n  - Ruta específica colocada antes de `/propuestas` para correcta captura\n\n**Features Implementadas:**\n- Navegación completa desde listado de propuestas a página de detalle\n- Visualización completa de información de propuesta\n- Sistema de comentarios integrado\n- Apoyo con tokens desde página de detalle\n- Sistema de donación desde página de detalle\n- Estados de carga y error manejados correctamente\n\n**Testing:**\n- Test e2e completo ejecutado exitosamente\n- Verificado: navegación a /propuestas, clic en \"Ver Detalles\", carga de página de detalle, visualización de título/descripción/badges, sección de comentarios, navegación de regreso\n\n### October 30, 2025 - Sistema de Votación en Sondeos Implementado\n\n**Backend Implementation:**\n- Agregado endpoint `GET /api/polls/user/:userId/voted`:\n  - Devuelve array de IDs de sondeos en los que el usuario ha votado\n  - Usado para marcar hasVoted en el frontend\n- Endpoint de votación existente: `POST /api/polls/:pollId/vote`\n  - Valida que el usuario no haya votado previamente\n  - Otorga 10 TP y 5 puntos de karma por votar\n  - Actualiza contador de votos de la opción seleccionada\n\n**Frontend Implementation:**\n- `client/src/pages/Sondeos.tsx`: Sistema completo de votación\n  - Query para obtener sondeos en los que el usuario ha votado\n  - Mutation para registrar votos con invalidación automática de cache\n  - Función handleVote que maneja el proceso de votación\n  - PollCard recibe props onVote y hasVoted correctamente\n  - Lógica de filtrado mejorada: sondeos sin fechaFin se consideran siempre activos\n- Corrección de orden de parámetros en apiRequest: `(method, url, data)`\n\n**Features Implementadas:**\n- Usuarios pueden votar en sondeos activos\n- Sistema de recompensas: 10 TP + 5 karma por voto\n- Prevención de votos duplicados\n- Badge \"Ya has votado\" aparece después de votar\n- Opciones se deshabilitan automáticamente después de votar\n- Contador de votos se actualiza en tiempo real\n- Toast de confirmación al votar exitosamente\n\n**Bug Fixes:**\n- Corregido: endpoints GET /api/polls devolvían `options` en lugar de `opciones`\n- Corregido: PollCard crasheaba si opciones era undefined\n- Corregido: orden incorrecto de parámetros en llamada a apiRequest\n- Corregido: lógica de filtrado para sondeos sin fechaFin\n\n**Testing:**\n- Test e2e completo ejecutado exitosamente\n- Verificado: creación de sondeo, votación, actualización de TP/karma, deshabilitación de opciones\n\n### October 30, 2025 - Sistema CRUD Completo para Sondeos\n\n**Backend Implementation:**\n- Agregados métodos de edición y eliminación en `server/storage.ts`:\n  - `updatePoll(id, data)`: Actualiza un sondeo existente\n  - `deletePoll(id)`: Elimina un sondeo\n- Endpoints administrativos completos:\n  - `POST /api/admin/polls`: Crea sondeo con opciones\n  - `PUT /api/admin/polls/:id`: Edita sondeo existente\n  - `DELETE /api/admin/polls/:id`: Elimina sondeo\n- Conversión automática de fechas: `fechaFin` string → Date o null en backend\n\n**Frontend Implementation:**\n- `client/src/pages/AdminSondeos.tsx`: UI completa de administración\n  - Botones de editar y eliminar en cada card de sondeo\n  - Modal de edición con formulario completo\n  - Confirmación antes de eliminar\n  - Invalidación correcta del cache de TanStack Query\n- Corrección de nombres de campos para alinear con schema DB:\n  - `titulo` → `pregunta`\n  - `fechaCierre` → `fechaFin`\n\n**Features Implementadas:**\n- Edición completa de sondeos desde panel admin\n- Eliminación de sondeos con confirmación\n- Toasts de éxito/error apropiados\n- Actualización automática de la lista tras operaciones CRUD\n- Manejo correcto de tipos fecha (string → Date)\n\n**Testing:**\n- Test e2e completo ejecutado exitosamente\n- Verificado: creación, edición y eliminación de sondeos\n- Confirmada correcta invalidación de cache y actualización de UI\n\n### October 29, 2025 - Sistema de Debates/Foro Completado\n\n**Backend Implementation:**\n- Agregados métodos CRUD completos en `server/storage.ts`:\n  - `getAllDebates()`: Obtiene todos los debates con información del autor\n  - `getDebateById(id)`: Obtiene un debate específico\n  - `createDebate(data)`: Crea un nuevo debate\n  - `updateDebate(id, data)`: Actualiza un debate existente\n  - `deleteDebate(id)`: Elimina un debate\n  - `incrementDebateViews(id)`: Incrementa el contador de vistas\n  - `getCommentsByDebate(debateId)`: Obtiene comentarios de un debate\n\n**API Endpoints:**\n- Rutas públicas:\n  - `GET /api/debates`: Lista todos los debates\n  - `GET /api/debates/:id`: Obtiene detalle y auto-incrementa vistas\n  - `GET /api/debates/:id/comments`: Obtiene comentarios del debate\n  - `POST /api/debates/:id/comments`: Crea un comentario (con validación Zod)\n- Rutas administrativas:\n  - `POST /api/admin/debates`: Crea debate\n  - `PUT /api/admin/debates/:id`: Edita debate\n  - `DELETE /api/admin/debates/:id`: Elimina debate\n\n**Frontend Integration:**\n- `client/src/pages/Foro.tsx`: Actualizado para consumir datos del backend usando TanStack Query\n- `client/src/pages/ForoDetalle.tsx`: Ya configurado correctamente para consumir API\n- `client/src/components/DebateCard.tsx`: Actualizado con tipos correctos (DebateConAutor)\n\n**Features Implementadas:**\n- Sistema de karma: +2 puntos por comentar en debates\n- Contador automático de respuestas al agregar comentarios\n- Contador de vistas que se incrementa al ver un debate\n- Soporte para debates destacados\n- Categorización de debates (política, economía, social, tecnología, medioambiente, general)\n- Integración completa con sistema de comentarios existente\n\n**Testing:**\n- Test e2e completo ejecutado exitosamente\n- Verificado: creación de debates, visualización en listado, navegación a detalle, creación de comentarios, incremento de contadores, otorgamiento de karma\n\n**Bug Fixes Post-Implementación:**\n- Agregado endpoint GET `/api/admin/debates` que faltaba para listar debates en panel admin\n- Corregido problema de invalidación de cache en AdminDebates.tsx (queryKey y invalidaciones ahora coinciden)\n- Creada página `/foro/nuevo` (ForoNuevo.tsx) para crear debates desde vista pública\n- Solo administradores pueden crear debates (validación en backend y frontend con mensajes informativos)","size_bytes":11709},"client/src/hooks/useWeb3.ts":{"content":"// Hook para manejar la conexión con MetaMask y Web3\nimport { useState, useEffect } from \"react\";\nimport { BrowserProvider } from \"ethers\";\n\ninterface Web3State {\n  account: string | null;\n  provider: BrowserProvider | null;\n  isConnected: boolean;\n  isLoading: boolean;\n  error: string | null;\n}\n\nexport function useWeb3() {\n  const [state, setState] = useState<Web3State>({\n    account: null,\n    provider: null,\n    isConnected: false,\n    isLoading: false,\n    error: null,\n  });\n\n  // Verificar si MetaMask está instalado\n  const isMetaMaskInstalled = () => {\n    return typeof window !== \"undefined\" && typeof window.ethereum !== \"undefined\";\n  };\n\n  // Conectar con MetaMask\n  const connect = async () => {\n    if (!isMetaMaskInstalled()) {\n      setState((prev) => ({\n        ...prev,\n        error: \"MetaMask no está instalado. Por favor instala la extensión de MetaMask.\",\n      }));\n      return;\n    }\n\n    setState((prev) => ({ ...prev, isLoading: true, error: null }));\n\n    try {\n      // Verificar que window.ethereum existe antes de usarlo\n      if (!window.ethereum) {\n        throw new Error(\"MetaMask no está disponible\");\n      }\n      \n      const provider = new BrowserProvider(window.ethereum);\n      const accounts = await provider.send(\"eth_requestAccounts\", []);\n      \n      if (accounts.length > 0) {\n        setState({\n          account: accounts[0],\n          provider,\n          isConnected: true,\n          isLoading: false,\n          error: null,\n        });\n        \n        // Guardar en localStorage\n        localStorage.setItem(\"web3Connected\", \"true\");\n      }\n    } catch (error: any) {\n      console.error(\"Error al conectar con MetaMask:\", error);\n      setState((prev) => ({\n        ...prev,\n        isLoading: false,\n        error: error.message || \"Error al conectar con MetaMask\",\n      }));\n    }\n  };\n\n  // Desconectar\n  const disconnect = () => {\n    setState({\n      account: null,\n      provider: null,\n      isConnected: false,\n      isLoading: false,\n      error: null,\n    });\n    localStorage.removeItem(\"web3Connected\");\n  };\n\n  // Intentar reconectar automáticamente si estaba conectado\n  useEffect(() => {\n    const wasConnected = localStorage.getItem(\"web3Connected\");\n    if (wasConnected === \"true\" && isMetaMaskInstalled()) {\n      connect();\n    }\n  }, []);\n\n  // Escuchar cambios de cuenta en MetaMask\n  useEffect(() => {\n    if (!isMetaMaskInstalled() || !window.ethereum) return;\n\n    const handleAccountsChanged = (accounts: string[]) => {\n      if (accounts.length > 0) {\n        setState((prev) => ({ ...prev, account: accounts[0] }));\n      } else {\n        disconnect();\n      }\n    };\n\n    // Verificar que los métodos existen antes de usarlos\n    if (window.ethereum.on) {\n      window.ethereum.on(\"accountsChanged\", handleAccountsChanged);\n    }\n\n    return () => {\n      if (window.ethereum?.removeListener) {\n        window.ethereum.removeListener(\"accountsChanged\", handleAccountsChanged);\n      }\n    };\n  }, []);\n\n  return {\n    ...state,\n    connect,\n    disconnect,\n    isMetaMaskInstalled: isMetaMaskInstalled(),\n  };\n}\n","size_bytes":3109},"shared/blockchain-config.ts":{"content":"// Configuración de blockchain para donaciones crypto en Neurolex\n// Usamos Sepolia testnet para desarrollo y pruebas\n\nexport const BLOCKCHAIN_CONFIG = {\n  // Red de Ethereum (Sepolia testnet para desarrollo)\n  network: {\n    chainId: 11155111, // Sepolia testnet\n    chainName: \"Sepolia\",\n    rpcUrl: \"https://sepolia.infura.io/v3/\",\n    blockExplorer: \"https://sepolia.etherscan.io\",\n  },\n\n  // Wallet de la plataforma (dirección que recibe las compras de tokens)\n  platformWallet: \"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb\",\n\n  // Precio de conversión: 1 TA = 0.001 ETH (ajustable)\n  tokenPrice: {\n    ethPerTA: \"0.001\", // 1 TA cuesta 0.001 ETH\n    minPurchase: 10, // Mínimo 10 TA por compra\n    maxPurchase: 10000, // Máximo 10,000 TA por compra\n  },\n\n  // Gas limit para transacciones\n  gasLimit: 21000,\n};\n\n// Función helper para calcular precio en ETH\nexport function calculateETHPrice(taAmount: number): string {\n  const ethAmount = taAmount * parseFloat(BLOCKCHAIN_CONFIG.tokenPrice.ethPerTA);\n  return ethAmount.toFixed(6);\n}\n\n// Función helper para calcular cantidad de TA\nexport function calculateTAAmount(ethAmount: string): number {\n  const eth = parseFloat(ethAmount);\n  const ta = eth / parseFloat(BLOCKCHAIN_CONFIG.tokenPrice.ethPerTA);\n  return Math.floor(ta);\n}\n","size_bytes":1291},"client/src/components/DonateModal.tsx":{"content":"// Modal para donar tokens de apoyo (TA) a propuestas\nimport { useState } from \"react\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Coins, Heart, AlertCircle, Loader2 } from \"lucide-react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface DonateModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  proposalId: string;\n  proposalTitle: string;\n}\n\nexport function DonateModal({ isOpen, onClose, proposalId, proposalTitle }: DonateModalProps) {\n  const [amount, setAmount] = useState(10);\n  const { toast } = useToast();\n  const userId = localStorage.getItem(\"userId\");\n\n  // Cargar balance de tokens del usuario\n  const { data: tokensBalance } = useQuery<any>({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId && isOpen,\n  });\n\n  const taBalance = tokensBalance?.tokensApoyo || 0;\n\n  // Mutación para donar\n  const donateMutation = useMutation({\n    mutationFn: async (data: { userId: string; proposalId: string; amount: number }) => {\n      return apiRequest(\"POST\", \"/api/proposals/donate\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens\", userId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\", proposalId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\", userId] });\n      \n      toast({\n        title: \"¡Donación exitosa!\",\n        description: `Has donado ${amount} TA a esta propuesta`,\n      });\n      \n      onClose();\n      setAmount(10);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error al donar\",\n        description: error.message || \"No se pudo procesar la donación\",\n      });\n    },\n  });\n\n  const handleDonate = () => {\n    if (!userId) {\n      toast({\n        variant: \"destructive\",\n        title: \"No autenticado\",\n        description: \"Debes iniciar sesión para donar\",\n      });\n      return;\n    }\n\n    if (amount <= 0) {\n      toast({\n        variant: \"destructive\",\n        title: \"Cantidad inválida\",\n        description: \"La cantidad debe ser mayor a 0\",\n      });\n      return;\n    }\n\n    if (amount > taBalance) {\n      toast({\n        variant: \"destructive\",\n        title: \"Saldo insuficiente\",\n        description: \"No tienes suficientes TA tokens\",\n      });\n      return;\n    }\n\n    donateMutation.mutate({ userId, proposalId, amount });\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md\" data-testid=\"modal-donate\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Heart className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n            Donar a Propuesta\n          </DialogTitle>\n          <DialogDescription className=\"line-clamp-2\">\n            {proposalTitle}\n          </DialogDescription>\n        </DialogHeader>\n\n        <div className=\"space-y-4 py-4\">\n          {/* Balance actual */}\n          <div className=\"p-3 bg-muted rounded-lg\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm text-muted-foreground\">Tu balance de TA</span>\n              <div className=\"flex items-center gap-1\">\n                <Coins className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                <span className=\"font-mono font-semibold text-lg\">{taBalance}</span>\n                <span className=\"text-xs text-muted-foreground\">TA</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Input de cantidad */}\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"donate-amount\">Cantidad a Donar</Label>\n            <Input\n              id=\"donate-amount\"\n              type=\"number\"\n              value={amount}\n              onChange={(e) => setAmount(parseInt(e.target.value) || 0)}\n              min={1}\n              max={taBalance}\n              data-testid=\"input-donate-amount\"\n            />\n            <p className=\"text-xs text-muted-foreground\">\n              Puedes donar hasta {taBalance} TA tokens\n            </p>\n          </div>\n\n          {/* Cantidades sugeridas */}\n          <div className=\"space-y-2\">\n            <Label>Cantidades Sugeridas</Label>\n            <div className=\"flex gap-2\">\n              {[10, 50, 100, 500].map((suggested) => (\n                <Button\n                  key={suggested}\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setAmount(Math.min(suggested, taBalance))}\n                  disabled={suggested > taBalance}\n                  data-testid={`button-suggested-${suggested}`}\n                >\n                  {suggested} TA\n                </Button>\n              ))}\n            </div>\n          </div>\n\n          {/* Advertencia si no tiene saldo */}\n          {taBalance === 0 && (\n            <div className=\"flex items-start gap-2 p-3 bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800 rounded-lg\">\n              <AlertCircle className=\"h-4 w-4 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5\" />\n              <div className=\"text-sm\">\n                <p className=\"font-medium text-yellow-800 dark:text-yellow-200 mb-1\">\n                  No tienes TA tokens\n                </p>\n                <p className=\"text-yellow-700 dark:text-yellow-300\">\n                  Puedes comprar TA tokens con criptomonedas en la sección de Monedero.\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n\n        <DialogFooter className=\"gap-2\">\n          <Button variant=\"outline\" onClick={onClose} data-testid=\"button-cancel-donate\">\n            Cancelar\n          </Button>\n          <Button\n            onClick={handleDonate}\n            disabled={donateMutation.isPending || amount <= 0 || amount > taBalance}\n            data-testid=\"button-confirm-donate\"\n          >\n            {donateMutation.isPending ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                Donando...\n              </>\n            ) : (\n              <>\n                <Heart className=\"mr-2 h-4 w-4\" />\n                Donar {amount} TA\n              </>\n            )}\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":6772},"client/src/pages/ComprarTokens.tsx":{"content":"// Página para comprar Tokens de Apoyo (TA) con criptomonedas\nimport { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useWeb3 } from \"@/hooks/useWeb3\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Coins, Wallet, ArrowRight, AlertCircle, CheckCircle, Loader2, ExternalLink } from \"lucide-react\";\nimport { parseEther } from \"ethers\";\nimport { BLOCKCHAIN_CONFIG, calculateETHPrice, calculateTAAmount } from \"@shared/blockchain-config\";\n\nexport default function ComprarTokens() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const userId = localStorage.getItem(\"userId\");\n\n  const [taAmount, setTaAmount] = useState(100);\n  const [ethAmount, setEthAmount] = useState(calculateETHPrice(100));\n  const [txHash, setTxHash] = useState<string | null>(null);\n  const [isLinkingWallet, setIsLinkingWallet] = useState(false);\n\n  // Redirigir al login si no está autenticado\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  // Cargar datos del usuario\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens\n  const { data: tokensBalance } = useQuery<any>({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  // Web3/MetaMask\n  const { account, isConnected, connect, isLoading: loadingWeb3, error: web3Error, isMetaMaskInstalled } = useWeb3();\n\n  // Vincular wallet al usuario con firma criptográfica\n  useEffect(() => {\n    const linkWalletWithSignature = async () => {\n      if (isConnected && account && userId && !user?.walletAddress && !isLinkingWallet) {\n        setIsLinkingWallet(true);\n        try {\n          // 1. Crear mensaje para firmar\n          const message = `Vincular wallet a Neurolex\\nUsuario: ${userId}\\nWallet: ${account}\\nFecha: ${new Date().toISOString()}`;\n          \n          // 2. Solicitar firma al usuario con MetaMask\n          const signature = await window.ethereum?.request({\n            method: \"personal_sign\",\n            params: [message, account],\n          });\n\n          // 3. Enviar firma al backend para verificar y vincular\n          await apiRequest(\"POST\", `/api/users/${userId}/link-wallet`, {\n            walletAddress: account,\n            message,\n            signature,\n          });\n\n          // Refrescar datos del usuario para mostrar wallet vinculada\n          queryClient.invalidateQueries({ queryKey: [\"/api/users/me\", userId] });\n          \n          toast({\n            title: \"Wallet vinculada\",\n            description: \"Tu wallet de MetaMask ha sido vinculada exitosamente\",\n          });\n        } catch (error: any) {\n          console.error(\"Error al vincular wallet:\", error);\n          toast({\n            variant: \"destructive\",\n            title: \"Error al vincular wallet\",\n            description: error.message || \"No se pudo vincular la wallet\",\n          });\n        } finally {\n          setIsLinkingWallet(false);\n        }\n      }\n    };\n\n    linkWalletWithSignature();\n  }, [isConnected, account, userId, user?.walletAddress, toast, isLinkingWallet]);\n\n  // Mutación para registrar la compra en el backend\n  const purchaseMutation = useMutation({\n    mutationFn: async (data: { userId: string; taAmount: number; ethAmount: string; txHash: string }) => {\n      return apiRequest(\"POST\", \"/api/tokens/purchase\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens\", userId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/transactions\", userId] });\n      toast({\n        title: \"¡Compra exitosa!\",\n        description: `Has adquirido ${taAmount} Tokens de Apoyo`,\n      });\n      setTaAmount(100);\n      setTxHash(null);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error en la compra\",\n        description: error.message || \"No se pudo procesar la transacción\",\n      });\n    },\n  });\n\n  // Actualizar precio en ETH cuando cambia la cantidad de TA\n  const handleTAChange = (value: string) => {\n    const ta = parseInt(value) || 0;\n    setTaAmount(ta);\n    setEthAmount(calculateETHPrice(ta));\n  };\n\n  // Actualizar cantidad de TA cuando cambia el precio en ETH\n  const handleETHChange = (value: string) => {\n    setEthAmount(value);\n    const ta = calculateTAAmount(value);\n    setTaAmount(ta);\n  };\n\n  // Procesar compra con MetaMask\n  const handlePurchase = async () => {\n    if (!isConnected || !account || !window.ethereum) {\n      toast({\n        variant: \"destructive\",\n        title: \"MetaMask no conectado\",\n        description: \"Por favor conecta tu billetera MetaMask\",\n      });\n      return;\n    }\n\n    if (!user?.walletAddress) {\n      toast({\n        variant: \"destructive\",\n        title: \"Wallet no vinculada\",\n        description: \"Espera a que se vincule tu wallet automáticamente\",\n      });\n      return;\n    }\n\n    if (taAmount < BLOCKCHAIN_CONFIG.tokenPrice.minPurchase) {\n      toast({\n        variant: \"destructive\",\n        title: \"Cantidad mínima no alcanzada\",\n        description: `Debes comprar al menos ${BLOCKCHAIN_CONFIG.tokenPrice.minPurchase} TA`,\n      });\n      return;\n    }\n\n    if (taAmount > BLOCKCHAIN_CONFIG.tokenPrice.maxPurchase) {\n      toast({\n        variant: \"destructive\",\n        title: \"Cantidad máxima excedida\",\n        description: `Puedes comprar máximo ${BLOCKCHAIN_CONFIG.tokenPrice.maxPurchase} TA`,\n      });\n      return;\n    }\n\n    try {\n      // Preparar transacción\n      const tx = {\n        from: account,\n        to: BLOCKCHAIN_CONFIG.platformWallet,\n        value: parseEther(ethAmount).toString(),\n        gasLimit: BLOCKCHAIN_CONFIG.gasLimit,\n      };\n\n      // Enviar transacción con MetaMask\n      const txHash = await window.ethereum.request({\n        method: \"eth_sendTransaction\",\n        params: [tx],\n      });\n\n      setTxHash(txHash as string);\n\n      toast({\n        title: \"Transacción enviada\",\n        description: \"Esperando confirmación en la blockchain...\",\n      });\n\n      // Registrar la compra en el backend\n      purchaseMutation.mutate({\n        userId: userId!,\n        taAmount,\n        ethAmount,\n        txHash: txHash as string,\n      });\n\n    } catch (error: any) {\n      console.error(\"Error en la transacción:\", error);\n      toast({\n        variant: \"destructive\",\n        title: \"Error en la transacción\",\n        description: error.message || \"La transacción fue rechazada\",\n      });\n    }\n  };\n\n  if (!userId) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-4xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-2\" data-testid=\"text-page-title\">\n              Comprar Tokens de Apoyo\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Adquiere TA tokens con Ethereum para donar a propuestas y partidos políticos\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Formulario de compra */}\n            <div className=\"lg:col-span-2 space-y-6\">\n              {/* Conexión MetaMask */}\n              {!isMetaMaskInstalled ? (\n                <Card className=\"border-yellow-200 dark:border-yellow-800\">\n                  <CardContent className=\"pt-6\">\n                    <div className=\"flex items-start gap-3\">\n                      <AlertCircle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400 flex-shrink-0 mt-0.5\" />\n                      <div>\n                        <p className=\"font-medium text-yellow-800 dark:text-yellow-200 mb-2\">\n                          MetaMask requerido\n                        </p>\n                        <p className=\"text-sm text-yellow-700 dark:text-yellow-300 mb-3\">\n                          Necesitas instalar MetaMask para comprar tokens con criptomonedas.\n                        </p>\n                        <a\n                          href=\"https://metamask.io/download/\"\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"inline-flex items-center gap-2 text-sm text-primary hover:underline\"\n                        >\n                          Instalar MetaMask\n                          <ExternalLink className=\"h-3 w-3\" />\n                        </a>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ) : !isConnected ? (\n                <Card>\n                  <CardContent className=\"pt-6\">\n                    <div className=\"text-center space-y-4\">\n                      <Wallet className=\"h-12 w-12 mx-auto text-muted-foreground\" />\n                      <div>\n                        <h3 className=\"font-semibold mb-2\">Conecta tu billetera</h3>\n                        <p className=\"text-sm text-muted-foreground mb-4\">\n                          Conecta MetaMask para comprar tokens\n                        </p>\n                      </div>\n                      <Button onClick={connect} disabled={loadingWeb3} data-testid=\"button-connect-wallet\">\n                        {loadingWeb3 ? (\n                          <>\n                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                            Conectando...\n                          </>\n                        ) : (\n                          <>\n                            <Wallet className=\"mr-2 h-4 w-4\" />\n                            Conectar MetaMask\n                          </>\n                        )}\n                      </Button>\n                      {web3Error && (\n                        <p className=\"text-sm text-destructive\">{web3Error}</p>\n                      )}\n                    </div>\n                  </CardContent>\n                </Card>\n              ) : (\n                <>\n                  {/* Wallet conectada */}\n                  <Card>\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle>Billetera Conectada</CardTitle>\n                        <Badge variant=\"outline\" className=\"bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300\">\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\n                          {user?.walletAddress ? \"Vinculada\" : \"Vinculando...\"}\n                        </Badge>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"font-mono text-sm\" data-testid=\"text-wallet-address\">\n                        {account}\n                      </p>\n                      {isLinkingWallet && (\n                        <p className=\"text-xs text-muted-foreground mt-2\">\n                          Firmando mensaje para vincular wallet...\n                        </p>\n                      )}\n                    </CardContent>\n                  </Card>\n\n                  {/* Calculadora de compra */}\n                  <Card>\n                    <CardHeader>\n                      <CardTitle>Cantidad a Comprar</CardTitle>\n                      <CardDescription>\n                        1 TA = {BLOCKCHAIN_CONFIG.tokenPrice.ethPerTA} ETH\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"space-y-4\">\n                      {/* Cantidad de TA */}\n                      <div>\n                        <Label htmlFor=\"ta-amount\">Tokens de Apoyo (TA)</Label>\n                        <Input\n                          id=\"ta-amount\"\n                          type=\"number\"\n                          value={taAmount}\n                          onChange={(e) => handleTAChange(e.target.value)}\n                          min={BLOCKCHAIN_CONFIG.tokenPrice.minPurchase}\n                          max={BLOCKCHAIN_CONFIG.tokenPrice.maxPurchase}\n                          data-testid=\"input-ta-amount\"\n                        />\n                        <p className=\"text-xs text-muted-foreground mt-1\">\n                          Mínimo: {BLOCKCHAIN_CONFIG.tokenPrice.minPurchase} TA | Máximo: {BLOCKCHAIN_CONFIG.tokenPrice.maxPurchase} TA\n                        </p>\n                      </div>\n\n                      <ArrowRight className=\"h-5 w-5 text-muted-foreground mx-auto\" />\n\n                      {/* Precio en ETH */}\n                      <div>\n                        <Label htmlFor=\"eth-amount\">Precio en Ethereum (ETH)</Label>\n                        <Input\n                          id=\"eth-amount\"\n                          type=\"text\"\n                          value={ethAmount}\n                          onChange={(e) => handleETHChange(e.target.value)}\n                          data-testid=\"input-eth-amount\"\n                        />\n                      </div>\n\n                      <Button\n                        className=\"w-full\"\n                        size=\"lg\"\n                        onClick={handlePurchase}\n                        disabled={purchaseMutation.isPending || taAmount < BLOCKCHAIN_CONFIG.tokenPrice.minPurchase || !user?.walletAddress}\n                        data-testid=\"button-purchase\"\n                      >\n                        {purchaseMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                            Procesando...\n                          </>\n                        ) : (\n                          <>\n                            <Coins className=\"mr-2 h-4 w-4\" />\n                            Comprar {taAmount} TA por {ethAmount} ETH\n                          </>\n                        )}\n                      </Button>\n\n                      {txHash && (\n                        <div className=\"p-3 bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 rounded-lg\">\n                          <p className=\"text-sm text-green-800 dark:text-green-200 mb-1\">\n                            Transacción enviada\n                          </p>\n                          <a\n                            href={`${BLOCKCHAIN_CONFIG.network.blockExplorer}/tx/${txHash}`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"text-xs text-primary hover:underline inline-flex items-center gap-1\"\n                          >\n                            Ver en Etherscan\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </a>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                </>\n              )}\n            </div>\n\n            {/* Información lateral */}\n            <div className=\"space-y-6\">\n              {/* Balance actual */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Tu Balance Actual</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    <div>\n                      <p className=\"text-sm text-muted-foreground\">Tokens de Apoyo</p>\n                      <p className=\"text-2xl font-bold text-green-600 dark:text-green-400\">\n                        {tokensBalance?.tokensApoyo || 0} TA\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Información */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">¿Cómo funciona?</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3 text-sm\">\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\n                      1\n                    </div>\n                    <p>Conecta tu billetera MetaMask</p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\n                      2\n                    </div>\n                    <p>Firma un mensaje para vincular tu wallet (seguridad)</p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\n                      3\n                    </div>\n                    <p>Elige la cantidad de TA tokens a comprar</p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\n                      4\n                    </div>\n                    <p>Confirma la transacción en MetaMask</p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-xs font-bold\">\n                      5\n                    </div>\n                    <p>Tus tokens se acreditarán automáticamente</p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Red de prueba */}\n              <Card className=\"border-blue-200 dark:border-blue-800\">\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex items-start gap-2\">\n                    <AlertCircle className=\"h-4 w-4 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5\" />\n                    <div>\n                      <p className=\"text-xs text-blue-800 dark:text-blue-200\">\n                        <strong>Red de prueba:</strong> Estamos usando Sepolia testnet. Los ETH son de prueba y no tienen valor real.\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":19138},"client/src/pages/Monedero.tsx":{"content":"// Página de Monedero con historial de transacciones e integración MetaMask\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { TokenCard } from \"@/components/TokenCard\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { Loader2, Wallet, ArrowUpCircle, ArrowDownCircle, AlertCircle, ShoppingCart } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useWeb3 } from \"@/hooks/useWeb3\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\nexport default function Monedero() {\n  const [, setLocation] = useLocation();\n  const userId = localStorage.getItem(\"userId\");\n\n  // Redirigir al login si no está autenticado\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  // Cargar datos del usuario\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar balance de tokens\n  const { data: tokensBalance, isLoading: loadingTokens } = useQuery<any>({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar historial de transacciones\n  const { data: transactions = [], isLoading: loadingTransactions, isError, error } = useQuery<any[]>({\n    queryKey: [\"/api/transactions\", userId],\n    enabled: !!userId,\n  });\n\n  // Web3/MetaMask\n  const { account, isConnected, connect, disconnect, isLoading: loadingWeb3, error: web3Error, isMetaMaskInstalled } = useWeb3();\n\n  // Formatear dirección de wallet (mostrar solo primeros y últimos caracteres)\n  const formatAddress = (address: string) => {\n    return `${address.substring(0, 6)}...${address.substring(address.length - 4)}`;\n  };\n\n  // Mapeo de tipos de token a colores\n  const tokenColors: Record<string, string> = {\n    TP: \"bg-blue-100 text-blue-700 dark:bg-blue-950 dark:text-blue-300\",\n    TA: \"bg-green-100 text-green-700 dark:bg-green-950 dark:text-green-300\",\n    TGR: \"bg-purple-100 text-purple-700 dark:bg-purple-950 dark:text-purple-300\",\n  };\n\n  if (!userId) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-2\" data-testid=\"text-monedero-title\">\n              Mi Monedero\n            </h1>\n            <p className=\"text-muted-foreground\">\n              Gestiona tus tokens y revisa tu historial de transacciones\n            </p>\n          </div>\n\n          {/* Sección de MetaMask */}\n          <Card className=\"mb-8\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Wallet className=\"h-5 w-5\" />\n                    Billetera Web3\n                  </CardTitle>\n                  <CardDescription>\n                    Conecta tu billetera MetaMask para interacciones blockchain\n                  </CardDescription>\n                </div>\n                {isConnected ? (\n                  <Button \n                    variant=\"outline\" \n                    onClick={disconnect}\n                    data-testid=\"button-disconnect-wallet\"\n                  >\n                    Desconectar\n                  </Button>\n                ) : (\n                  <Button \n                    onClick={connect} \n                    disabled={loadingWeb3 || !isMetaMaskInstalled}\n                    data-testid=\"button-connect-wallet\"\n                  >\n                    {loadingWeb3 ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Conectando...\n                      </>\n                    ) : (\n                      <>\n                        <Wallet className=\"mr-2 h-4 w-4\" />\n                        Conectar MetaMask\n                      </>\n                    )}\n                  </Button>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              {!isMetaMaskInstalled ? (\n                <div className=\"flex items-center gap-2 p-4 bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800 rounded-lg\">\n                  <AlertCircle className=\"h-5 w-5 text-yellow-600 dark:text-yellow-400\" />\n                  <div>\n                    <p className=\"font-medium text-yellow-800 dark:text-yellow-200\">\n                      MetaMask no detectado\n                    </p>\n                    <p className=\"text-sm text-yellow-700 dark:text-yellow-300\">\n                      Por favor instala la extensión de MetaMask para conectar tu billetera.\n                    </p>\n                  </div>\n                </div>\n              ) : isConnected && account ? (\n                <div className=\"flex items-center gap-4\">\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm text-muted-foreground mb-1\">Dirección conectada</p>\n                    <p className=\"font-mono text-lg\" data-testid=\"text-wallet-address\">\n                      {formatAddress(account)}\n                    </p>\n                  </div>\n                  <Badge variant=\"outline\" className=\"bg-green-50 dark:bg-green-950 text-green-700 dark:text-green-300\">\n                    Conectado\n                  </Badge>\n                </div>\n              ) : web3Error ? (\n                <div className=\"flex items-center gap-2 p-4 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg\">\n                  <AlertCircle className=\"h-5 w-5 text-red-600 dark:text-red-400\" />\n                  <p className=\"text-sm text-red-800 dark:text-red-200\">{web3Error}</p>\n                </div>\n              ) : (\n                <p className=\"text-muted-foreground\">\n                  No hay billetera conectada. Haz clic en \"Conectar MetaMask\" para vincular tu cuenta.\n                </p>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Saldos de Tokens */}\n          <section className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-2xl font-semibold font-[Poppins]\">Mis Tokens</h2>\n              <Link href=\"/comprar-tokens\">\n                <Button data-testid=\"button-buy-tokens\">\n                  <ShoppingCart className=\"mr-2 h-4 w-4\" />\n                  Comprar Tokens\n                </Button>\n              </Link>\n            </div>\n            {loadingTokens ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                {[1, 2, 3].map((i) => (\n                  <Card key={i} className=\"h-32 flex items-center justify-center\">\n                    <Loader2 className=\"h-6 w-6 animate-spin text-primary\" />\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <TokenCard\n                  tipo=\"TP\"\n                  cantidad={tokensBalance?.tokensParticipacion || 0}\n                  descripcion=\"Ganados por participación activa\"\n                />\n                <TokenCard\n                  tipo=\"TA\"\n                  cantidad={tokensBalance?.tokensApoyo || 0}\n                  descripcion=\"Comprados para apoyar propuestas\"\n                />\n                <TokenCard\n                  tipo=\"TGR\"\n                  cantidad={tokensBalance?.tokensGobernanza || 0}\n                  descripcion=\"Ganados por contribuciones destacadas\"\n                />\n              </div>\n            )}\n          </section>\n\n          {/* Historial de Transacciones */}\n          <section>\n            <h2 className=\"text-2xl font-semibold font-[Poppins] mb-4\">Historial de Transacciones</h2>\n            <Card>\n              <CardContent className=\"p-0\">\n                {loadingTransactions ? (\n                  <div className=\"flex justify-center py-12\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                  </div>\n                ) : isError ? (\n                  <div className=\"flex flex-col items-center gap-2 py-12\">\n                    <AlertCircle className=\"h-12 w-12 text-destructive\" />\n                    <p className=\"text-destructive font-medium\">Error al cargar transacciones</p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {error instanceof Error ? error.message : \"Por favor intenta de nuevo más tarde\"}\n                    </p>\n                  </div>\n                ) : transactions.length === 0 ? (\n                  <div className=\"flex flex-col items-center gap-2 py-12\">\n                    <Wallet className=\"h-12 w-12 text-muted-foreground\" />\n                    <p className=\"text-muted-foreground\">No hay transacciones aún</p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Tus movimientos de tokens aparecerán aquí\n                    </p>\n                  </div>\n                ) : (\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Fecha</TableHead>\n                        <TableHead>Token</TableHead>\n                        <TableHead>Tipo</TableHead>\n                        <TableHead className=\"text-right\">Cantidad</TableHead>\n                        <TableHead>Descripción</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {transactions.map((tx: any) => (\n                        <TableRow key={tx.id} data-testid={`row-transaction-${tx.id}`}>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {formatDistanceToNow(new Date(tx.createdAt), {\n                              addSuffix: true,\n                              locale: es,\n                            })}\n                          </TableCell>\n                          <TableCell>\n                            <Badge className={tokenColors[tx.tipoToken]} variant=\"outline\">\n                              {tx.tipoToken}\n                            </Badge>\n                          </TableCell>\n                          <TableCell className=\"text-sm capitalize\">\n                            {tx.tipoTransaccion.replace(/_/g, \" \")}\n                          </TableCell>\n                          <TableCell className=\"text-right font-mono\">\n                            <span className={tx.cantidad > 0 ? \"text-green-600 dark:text-green-400\" : \"text-red-600 dark:text-red-400\"}>\n                              {tx.cantidad > 0 ? (\n                                <ArrowUpCircle className=\"inline h-4 w-4 mr-1\" />\n                              ) : (\n                                <ArrowDownCircle className=\"inline h-4 w-4 mr-1\" />\n                              )}\n                              {tx.cantidad > 0 ? \"+\" : \"\"}\n                              {tx.cantidad}\n                            </span>\n                          </TableCell>\n                          <TableCell className=\"text-sm\">{tx.descripcion}</TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                )}\n              </CardContent>\n            </Card>\n          </section>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":12085},"client/src/types/global.d.ts":{"content":"// Tipos globales para la aplicación Neurolex\nimport { Eip1193Provider } from \"ethers\";\n\ndeclare global {\n  interface Window {\n    ethereum?: Eip1193Provider & {\n      on?: (event: string, handler: (...args: any[]) => void) => void;\n      removeListener?: (event: string, handler: (...args: any[]) => void) => void;\n    };\n  }\n}\n\nexport {};\n","size_bytes":342},"client/src/pages/AdminNoticias.tsx":{"content":"// Panel de Administración - Gestión de Noticias\nimport { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Newspaper, Plus, Pencil, Trash2, Loader2, ArrowLeft, Eye } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { format } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\nexport default function AdminNoticias() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const userId = localStorage.getItem(\"userId\");\n  \n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingNews, setEditingNews] = useState<any>(null);\n  const [formData, setFormData] = useState({\n    titulo: \"\",\n    contenido: \"\",\n    tipo: \"nacional\" as \"nacional\" | \"internacional\" | \"economia\" | \"social\" | \"tecnologia\" | \"otro\",\n    partidoAsociado: \"\",\n    imagenUrl: \"\",\n  });\n\n  // Redirigir al login si no está autenticado\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  // Cargar usuario\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar noticias\n  const { data: news = [], isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/news\"],\n    enabled: !!user?.isAdmin,\n  });\n\n  // Crear/editar noticia\n  const createOrUpdateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (editingNews) {\n        return apiRequest(\"PUT\", `/api/admin/news/${editingNews.id}`, {\n          ...data,\n          adminId: userId,\n        });\n      } else {\n        return apiRequest(\"POST\", \"/api/admin/news\", {\n          ...data,\n          adminId: userId,\n        });\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/news\"] });\n      toast({\n        title: editingNews ? \"Noticia actualizada\" : \"Noticia creada\",\n        description: `La noticia ha sido ${editingNews ? \"actualizada\" : \"creada\"} correctamente`,\n      });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo guardar la noticia\",\n      });\n    },\n  });\n\n  // Eliminar noticia\n  const deleteMutation = useMutation({\n    mutationFn: async (newsId: string) => {\n      return apiRequest(\"DELETE\", `/api/admin/news/${newsId}?adminId=${userId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/news\"] });\n      toast({\n        title: \"Noticia eliminada\",\n        description: \"La noticia ha sido eliminada correctamente\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo eliminar la noticia\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    createOrUpdateMutation.mutate(formData);\n  };\n\n  const handleEdit = (newsItem: any) => {\n    setEditingNews(newsItem);\n    setFormData({\n      titulo: newsItem.titulo,\n      contenido: newsItem.contenido,\n      tipo: newsItem.tipo,\n      partidoAsociado: newsItem.partidoAsociado || \"\",\n      imagenUrl: newsItem.imagenUrl || \"\",\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = (newsId: string) => {\n    if (confirm(\"¿Estás seguro de eliminar esta noticia?\")) {\n      deleteMutation.mutate(newsId);\n    }\n  };\n\n  const resetForm = () => {\n    setEditingNews(null);\n    setFormData({\n      titulo: \"\",\n      contenido: \"\",\n      tipo: \"nacional\",\n      partidoAsociado: \"\",\n      imagenUrl: \"\",\n    });\n  };\n\n  const handleDialogChange = (open: boolean) => {\n    setIsDialogOpen(open);\n    if (!open) {\n      resetForm();\n    }\n  };\n\n  // Verificar que el usuario sea admin\n  if (!user?.isAdmin) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-8\">\n            <div>\n              <Link href=\"/admin\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"mb-2\" data-testid=\"button-back-admin\">\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  Volver al Panel\n                </Button>\n              </Link>\n              <div className=\"flex items-center gap-2\">\n                <Newspaper className=\"h-8 w-8 text-primary\" />\n                <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins]\" data-testid=\"text-admin-news-title\">\n                  Gestión de Noticias\n                </h1>\n              </div>\n            </div>\n            \n            <Dialog open={isDialogOpen} onOpenChange={handleDialogChange}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-create-news\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Nueva Noticia\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingNews ? \"Editar Noticia\" : \"Crear Nueva Noticia\"}\n                  </DialogTitle>\n                  <DialogDescription>\n                    Completa los datos de la noticia política\n                  </DialogDescription>\n                </DialogHeader>\n                \n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                  <div>\n                    <Label htmlFor=\"titulo\">Título *</Label>\n                    <Input\n                      id=\"titulo\"\n                      value={formData.titulo}\n                      onChange={(e) => setFormData({ ...formData, titulo: e.target.value })}\n                      placeholder=\"Título de la noticia\"\n                      required\n                      data-testid=\"input-news-title\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"contenido\">Contenido *</Label>\n                    <Textarea\n                      id=\"contenido\"\n                      value={formData.contenido}\n                      onChange={(e) => setFormData({ ...formData, contenido: e.target.value })}\n                      placeholder=\"Contenido completo de la noticia\"\n                      rows={6}\n                      required\n                      data-testid=\"input-news-content\"\n                    />\n                  </div>\n\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div>\n                      <Label htmlFor=\"tipo\">Tipo de Noticia *</Label>\n                      <Select\n                        value={formData.tipo}\n                        onValueChange={(value: any) => setFormData({ ...formData, tipo: value })}\n                      >\n                        <SelectTrigger id=\"tipo\" data-testid=\"select-news-type\">\n                          <SelectValue placeholder=\"Selecciona tipo\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"nacional\">Nacional</SelectItem>\n                          <SelectItem value=\"internacional\">Internacional</SelectItem>\n                          <SelectItem value=\"economia\">Economía</SelectItem>\n                          <SelectItem value=\"social\">Social</SelectItem>\n                          <SelectItem value=\"tecnologia\">Tecnología</SelectItem>\n                          <SelectItem value=\"otro\">Otro</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div>\n                      <Label htmlFor=\"partidoAsociado\">Partido Asociado</Label>\n                      <Input\n                        id=\"partidoAsociado\"\n                        value={formData.partidoAsociado}\n                        onChange={(e) => setFormData({ ...formData, partidoAsociado: e.target.value })}\n                        placeholder=\"Ej: PSOE, PP, Podemos...\"\n                        data-testid=\"input-news-party\"\n                      />\n                    </div>\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"imagenUrl\">URL de Imagen</Label>\n                    <Input\n                      id=\"imagenUrl\"\n                      value={formData.imagenUrl}\n                      onChange={(e) => setFormData({ ...formData, imagenUrl: e.target.value })}\n                      placeholder=\"https://ejemplo.com/imagen.jpg\"\n                      type=\"url\"\n                      data-testid=\"input-news-image\"\n                    />\n                  </div>\n\n                  <DialogFooter>\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setIsDialogOpen(false)}\n                      data-testid=\"button-cancel-news\"\n                    >\n                      Cancelar\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      disabled={createOrUpdateMutation.isPending}\n                      data-testid=\"button-save-news\"\n                    >\n                      {createOrUpdateMutation.isPending ? (\n                        <>\n                          <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                          Guardando...\n                        </>\n                      ) : (\n                        editingNews ? \"Actualizar\" : \"Crear\"\n                      )}\n                    </Button>\n                  </DialogFooter>\n                </form>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {/* Lista de Noticias */}\n          <div className=\"space-y-4\">\n            {isLoading ? (\n              <div className=\"flex items-center justify-center py-12\">\n                <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n              </div>\n            ) : news.length === 0 ? (\n              <Card>\n                <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                  No hay noticias creadas. Crea la primera noticia.\n                </CardContent>\n              </Card>\n            ) : (\n              news.map((newsItem: any) => (\n                <Card key={newsItem.id} className=\"hover-elevate\" data-testid={`card-news-${newsItem.id}`}>\n                  <CardHeader>\n                    <div className=\"flex items-start justify-between gap-4\">\n                      <div className=\"flex-1\">\n                        <CardTitle className=\"text-xl mb-2\">\n                          {newsItem.titulo}\n                        </CardTitle>\n                        <div className=\"flex flex-wrap items-center gap-3 text-sm text-muted-foreground\">\n                          <span className=\"px-2 py-1 rounded-md bg-primary/10 text-primary font-medium\">\n                            {newsItem.tipo}\n                          </span>\n                          {newsItem.partidoAsociado && (\n                            <span className=\"px-2 py-1 rounded-md bg-secondary\">\n                              {newsItem.partidoAsociado}\n                            </span>\n                          )}\n                          <span>\n                            {format(new Date(newsItem.createdAt), \"d 'de' MMMM, yyyy\", { locale: es })}\n                          </span>\n                        </div>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Link href=\"/noticias\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            data-testid={`button-view-news-${newsItem.id}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                        </Link>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => handleEdit(newsItem)}\n                          data-testid={`button-edit-news-${newsItem.id}`}\n                        >\n                          <Pencil className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"destructive\"\n                          size=\"sm\"\n                          onClick={() => handleDelete(newsItem.id)}\n                          disabled={deleteMutation.isPending}\n                          data-testid={`button-delete-news-${newsItem.id}`}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-muted-foreground line-clamp-3\">\n                      {newsItem.contenido}\n                    </p>\n                  </CardContent>\n                </Card>\n              ))\n            )}\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":14117},"client/src/components/DebateCard.tsx":{"content":"import { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { MessageSquare, Eye, Clock } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport { Link } from \"wouter\";\nimport type { Debate } from \"@shared/schema\";\n\nexport interface DebateConAutor extends Debate {\n  autorNombre?: string;\n}\n\nexport type DebateCardProps = DebateConAutor;\n\nconst categoriaColors: Record<string, string> = {\n  politica: \"bg-red-100 text-red-800 dark:bg-red-950 dark:text-red-300\",\n  economia: \"bg-green-100 text-green-800 dark:bg-green-950 dark:text-green-300\",\n  social: \"bg-blue-100 text-blue-800 dark:bg-blue-950 dark:text-blue-300\",\n  tecnologia: \"bg-purple-100 text-purple-800 dark:bg-purple-950 dark:text-purple-300\",\n  medioambiente: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-950 dark:text-emerald-300\",\n  general: \"bg-gray-100 text-gray-800 dark:bg-gray-950 dark:text-gray-300\",\n};\n\nexport function DebateCard(debate: DebateCardProps) {\n  const {\n    id,\n    titulo,\n    categoria,\n    autorNombre = \"Anónimo\",\n    createdAt,\n    numRespuestas,\n    numVistas,\n    destacado = false,\n  } = debate;\n\n  const tiempoRelativo = formatDistanceToNow(new Date(createdAt), { addSuffix: true, locale: es });\n\n  return (\n    <Link href={`/foro/${id}`}>\n      <Card\n        className={`hover-elevate p-4 cursor-pointer transition-all ${\n          destacado ? \"border-l-4 border-l-primary bg-primary/5\" : \"\"\n        }`}\n        data-testid={`card-debate-${id}`}\n      >\n        <div className=\"flex items-start gap-4\">\n          {/* Icono de categoría */}\n          <div className=\"flex-shrink-0\">\n            <Badge\n              className={categoriaColors[categoria] || categoriaColors.general}\n              data-testid={`badge-category-${id}`}\n            >\n              {categoria}\n            </Badge>\n          </div>\n\n          {/* Contenido principal */}\n          <div className=\"flex-1 min-w-0\">\n            <h3\n              className=\"text-base font-semibold mb-1 line-clamp-2 hover:text-primary transition-colors\"\n              data-testid={`text-debate-title-${id}`}\n            >\n              {titulo}\n            </h3>\n            <div className=\"flex flex-wrap items-center gap-3 text-xs text-muted-foreground\">\n              <span data-testid={`text-author-${id}`}>\n                Por <span className=\"font-medium\">{autorNombre}</span>\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Clock className=\"h-3 w-3\" />\n                {tiempoRelativo}\n              </span>\n            </div>\n          </div>\n\n          {/* Estadísticas */}\n          <div className=\"flex-shrink-0 flex flex-col items-end gap-2 text-sm\">\n            <div\n              className=\"flex items-center gap-1 text-muted-foreground\"\n              data-testid={`text-replies-${id}`}\n            >\n              <MessageSquare className=\"h-4 w-4\" />\n              <span className=\"font-mono font-semibold\">{numRespuestas}</span>\n            </div>\n            <div\n              className=\"flex items-center gap-1 text-muted-foreground text-xs\"\n              data-testid={`text-views-${id}`}\n            >\n              <Eye className=\"h-3 w-3\" />\n              <span className=\"font-mono\">{numVistas}</span>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </Link>\n  );\n}\n","size_bytes":3417},"client/src/pages/AdminUsuarios.tsx":{"content":"// Panel de Administración - Gestión de Usuarios\nimport { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Switch } from \"@/components/ui/switch\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLocation, Link } from \"wouter\";\nimport { Users, Loader2, Shield, AlertCircle, ArrowLeft } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\nexport default function AdminUsuarios() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const userId = localStorage.getItem(\"userId\");\n\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  const { data: currentUser } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: users, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/admin/users\"],\n    queryFn: async () => {\n      const res = await fetch(`/api/admin/users?adminId=${userId}`);\n      if (!res.ok) throw new Error(\"Error al cargar usuarios\");\n      return res.json();\n    },\n    enabled: !!userId,\n  });\n\n  const updateUserMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      return apiRequest(\"PUT\", `/api/admin/users/${id}`, {\n        adminId: userId,\n        ...data,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/users\"] });\n      toast({\n        title: \"Usuario actualizado\",\n        description: \"Los datos del usuario han sido actualizados\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo actualizar el usuario\",\n      });\n    },\n  });\n\n  const handleLevelChange = (id: string, nivel: string) => {\n    updateUserMutation.mutate({ id, data: { nivel } });\n  };\n\n  const handleAdminToggle = (id: string, isAdmin: boolean) => {\n    updateUserMutation.mutate({ id, data: { isAdmin } });\n  };\n\n  if (!currentUser) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!currentUser.isAdmin) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={currentUser} />\n        <main className=\"flex-1 flex items-center justify-center bg-background\">\n          <Card className=\"max-w-md\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2 text-destructive\">\n                <AlertCircle className=\"h-5 w-5\" />\n                <CardTitle>Acceso Denegado</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                No tienes permisos para acceder al panel de administración.\n              </p>\n              <Link href=\"/dashboard\">\n                <Button>Volver al Dashboard</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={currentUser} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          <div className=\"mb-6\">\n            <Link href=\"/admin\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Volver al Panel\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Users className=\"h-8 w-8 text-primary\" />\n              <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins]\" data-testid=\"text-admin-users-title\">\n                Gestión de Usuarios\n              </h1>\n            </div>\n            <p className=\"text-muted-foreground\">\n              Administra niveles de acceso y permisos de usuarios\n            </p>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Todos los Usuarios</CardTitle>\n              <CardDescription>\n                {users?.length || 0} usuarios registrados\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : !users || users.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  No hay usuarios registrados\n                </p>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Usuario</TableHead>\n                        <TableHead>Email</TableHead>\n                        <TableHead>Registro</TableHead>\n                        <TableHead>Karma</TableHead>\n                        <TableHead>Nivel</TableHead>\n                        <TableHead>Administrador</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {users.map((user: any) => (\n                        <TableRow key={user.id}>\n                          <TableCell className=\"font-medium\">\n                            <div className=\"flex items-center gap-2\">\n                              {user.username}\n                              {user.isAdmin && (\n                                <Shield className=\"h-3 w-3 text-primary\" />\n                              )}\n                            </div>\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {user.email}\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {user.fechaRegistro \n                              ? format(new Date(user.fechaRegistro), \"dd MMM yyyy\", { locale: es })\n                              : \"N/A\"}\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"secondary\">{user.karma || 0} pts</Badge>\n                          </TableCell>\n                          <TableCell>\n                            <Select\n                              value={user.nivel}\n                              onValueChange={(value) => handleLevelChange(user.id, value)}\n                              disabled={updateUserMutation.isPending || user.id === userId}\n                            >\n                              <SelectTrigger className=\"w-32\" data-testid={`select-level-${user.id}`}>\n                                <SelectValue>\n                                  <Badge variant={user.nivel === \"verificado\" ? \"default\" : \"outline\"}>\n                                    {user.nivel === \"verificado\" ? \"Verificado\" : \"Básico\"}\n                                  </Badge>\n                                </SelectValue>\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"basico\">Básico</SelectItem>\n                                <SelectItem value=\"verificado\">Verificado</SelectItem>\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex items-center gap-2\">\n                              <Switch\n                                checked={user.isAdmin}\n                                onCheckedChange={(checked) => handleAdminToggle(user.id, checked)}\n                                disabled={updateUserMutation.isPending || user.id === userId}\n                                data-testid={`switch-admin-${user.id}`}\n                              />\n                              <span className=\"text-sm text-muted-foreground\">\n                                {user.isAdmin ? \"Sí\" : \"No\"}\n                              </span>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":9235},"client/src/pages/Foro.tsx":{"content":"import { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { DebateCard, type DebateConAutor } from \"@/components/DebateCard\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Plus, TrendingUp, MessageSquare } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Loader2 } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Foro() {\n  const userId = localStorage.getItem(\"userId\");\n\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: debates = [], isLoading: debatesLoading } = useQuery<DebateConAutor[]>({\n    queryKey: [\"/api/debates\"],\n  });\n\n  const debatesTrending = debates\n    .sort((a, b) => (b.numRespuestas || 0) - (a.numRespuestas || 0))\n    .slice(0, 3);\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"flex items-start justify-between mb-8 gap-4\">\n            <div>\n              <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-2\" data-testid=\"text-page-title\">\n                Foro de Debates\n              </h1>\n              <p className=\"text-muted-foreground\">\n                Participa en discusiones sobre temas políticos y sociales\n              </p>\n            </div>\n            <Link href=\"/foro/nuevo\">\n              <Button className=\"flex-shrink-0\" data-testid=\"button-create-debate\">\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Nuevo Debate\n              </Button>\n            </Link>\n          </div>\n\n          {/* Barra de búsqueda */}\n          <div className=\"relative mb-8\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              placeholder=\"Buscar debates...\"\n              className=\"pl-10\"\n              data-testid=\"input-search-debates\"\n            />\n          </div>\n\n          {/* Layout: Feed principal + Sidebar */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            {/* Feed principal */}\n            <div className=\"lg:col-span-2 space-y-4\">\n              {debatesLoading ? (\n                <div className=\"flex justify-center items-center py-12\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : debates.length === 0 ? (\n                <div className=\"text-center py-12\">\n                  <p className=\"text-muted-foreground\">No hay debates disponibles</p>\n                </div>\n              ) : (\n                debates.map((debate) => (\n                  <DebateCard key={debate.id} {...debate} />\n                ))\n              )}\n\n              {/* Paginación */}\n              <div className=\"mt-8 flex justify-center gap-2\">\n                <Button variant=\"outline\" disabled data-testid=\"button-prev-page\">\n                  Anterior\n                </Button>\n                <Button variant=\"default\">1</Button>\n                <Button variant=\"outline\">2</Button>\n                <Button variant=\"outline\">3</Button>\n                <Button variant=\"outline\" data-testid=\"button-next-page\">\n                  Siguiente\n                </Button>\n              </div>\n            </div>\n\n            {/* Sidebar derecho */}\n            <div className=\"space-y-6\">\n              {/* Debates Trending */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2 text-lg\">\n                    <TrendingUp className=\"h-5 w-5 text-primary\" />\n                    Debates Populares\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  {debatesTrending.map((debate, index) => (\n                    <Link key={debate.id} href={`/foro/${debate.id}`}>\n                      <div\n                        className=\"flex items-start gap-3 p-2 rounded-lg hover-elevate cursor-pointer\"\n                        data-testid={`trending-debate-${index + 1}`}\n                      >\n                        <div className=\"flex-shrink-0 w-6 h-6 rounded-full bg-primary/10 flex items-center justify-center\">\n                          <span className=\"text-xs font-bold text-primary\">{index + 1}</span>\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm font-medium line-clamp-2 mb-1\">{debate.titulo}</p>\n                          <div className=\"flex items-center gap-1 text-xs text-muted-foreground\">\n                            <MessageSquare className=\"h-3 w-3\" />\n                            <span>{debate.numRespuestas} respuestas</span>\n                          </div>\n                        </div>\n                      </div>\n                    </Link>\n                  ))}\n                </CardContent>\n              </Card>\n\n              {/* Categorías */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Categorías</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {[\"política\", \"economía\", \"social\", \"tecnología\", \"medioambiente\", \"general\"].map(\n                      (cat) => (\n                        <Badge\n                          key={cat}\n                          variant=\"outline\"\n                          className=\"cursor-pointer\"\n                          data-testid={`badge-category-${cat}`}\n                        >\n                          {cat.charAt(0).toUpperCase() + cat.slice(1)}\n                        </Badge>\n                      )\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Estadísticas */}\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"text-lg\">Estadísticas</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-muted-foreground\">Debates totales</span>\n                    <span className=\"font-semibold\">{debates.length}</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-muted-foreground\">Participantes activos</span>\n                    <span className=\"font-semibold\">1,234</span>\n                  </div>\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm text-muted-foreground\">Respuestas hoy</span>\n                    <span className=\"font-semibold\">89</span>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":7496},"client/src/pages/ForoDetalle.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ArrowLeft, MessageSquare, Eye, ThumbsUp, ThumbsDown, Send } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\nimport type { DebateConAutor } from \"@/components/DebateCard\";\nimport type { Comment } from \"@shared/schema\";\n\ninterface ComentarioConAutor extends Comment {\n  autorNombre?: string;\n}\n\nconst categoriaColors: Record<string, string> = {\n  politica: \"bg-red-100 text-red-800 dark:bg-red-950 dark:text-red-300\",\n  economia: \"bg-green-100 text-green-800 dark:bg-green-950 dark:text-green-300\",\n  social: \"bg-blue-100 text-blue-800 dark:bg-blue-950 dark:text-blue-300\",\n  tecnologia: \"bg-purple-100 text-purple-800 dark:bg-purple-950 dark:text-purple-300\",\n  medioambiente: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-950 dark:text-emerald-300\",\n  general: \"bg-gray-100 text-gray-800 dark:bg-gray-950 dark:text-gray-300\",\n};\n\nexport default function ForoDetalle() {\n  const { id } = useParams();\n  const [, navigate] = useLocation();\n  const userId = localStorage.getItem(\"userId\");\n  const { toast } = useToast();\n  const [comentario, setComentario] = useState(\"\");\n\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: debate, isLoading } = useQuery<DebateConAutor>({\n    queryKey: [\"/api/debates\", id],\n    enabled: !!id,\n  });\n\n  const { data: comentarios = [] } = useQuery<ComentarioConAutor[]>({\n    queryKey: [\"/api/debates\", id, \"comments\"],\n    enabled: !!id,\n  });\n\n  const addCommentMutation = useMutation({\n    mutationFn: async (contenido: string) => {\n      if (!userId) {\n        throw new Error(\"Debes iniciar sesión para comentar\");\n      }\n      return apiRequest(\"POST\", `/api/debates/${id}/comments`, {\n        contenido,\n        autorId: userId,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Comentario publicado\",\n        description: \"Tu comentario se ha agregado correctamente. +2 karma\",\n      });\n      setComentario(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/debates\", id, \"comments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/debates\", id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/debates\"] }); // Invalida listado de debates\n      queryClient.invalidateQueries({ queryKey: [\"/api/users/me\", userId] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmitComment = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!comentario.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"El comentario no puede estar vacío\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    addCommentMutation.mutate(comentario);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} tokensBalance={tokensBalance} />\n        <main className=\"flex-1 flex items-center justify-center\">\n          <p className=\"text-muted-foreground\">Cargando debate...</p>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!debate) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} tokensBalance={tokensBalance} />\n        <main className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl font-bold mb-2\">Debate no encontrado</h2>\n            <p className=\"text-muted-foreground mb-4\">\n              El debate que buscas no existe o ha sido eliminado\n            </p>\n            <Link href=\"/foro\">\n              <Button data-testid=\"button-back-to-forum\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Volver al Foro\n              </Button>\n            </Link>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const tiempoRelativo = debate.createdAt\n    ? formatDistanceToNow(new Date(debate.createdAt), { addSuffix: true, locale: es })\n    : \"\";\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-5xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Botón volver */}\n          <Link href=\"/foro\">\n            <Button variant=\"ghost\" className=\"mb-6\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Volver al Foro\n            </Button>\n          </Link>\n\n          {/* Contenido del debate */}\n          <Card className=\"mb-8\">\n            <CardContent className=\"p-6\">\n              {/* Header */}\n              <div className=\"flex items-start justify-between mb-4 gap-4\">\n                <Badge\n                  className={categoriaColors[debate.categoria] || categoriaColors.general}\n                  data-testid=\"badge-category\"\n                >\n                  {debate.categoria.charAt(0).toUpperCase() + debate.categoria.slice(1)}\n                </Badge>\n                <div className=\"flex items-center gap-4 text-sm text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\" data-testid=\"text-views\">\n                    <Eye className=\"h-4 w-4\" />\n                    <span className=\"font-mono\">{debate.numVistas}</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\" data-testid=\"text-replies\">\n                    <MessageSquare className=\"h-4 w-4\" />\n                    <span className=\"font-mono\">{debate.numRespuestas}</span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Título */}\n              <h1 className=\"text-2xl md:text-3xl font-bold mb-4\" data-testid=\"text-title\">\n                {debate.titulo}\n              </h1>\n\n              {/* Autor y fecha */}\n              <div className=\"flex items-center gap-3 mb-6\">\n                <Avatar className=\"h-10 w-10\">\n                  <AvatarFallback className=\"bg-primary text-primary-foreground\">\n                    {debate.autorNombre?.substring(0, 2).toUpperCase() || \"AN\"}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <p className=\"font-medium\" data-testid=\"text-author\">\n                    {debate.autorNombre || \"Anónimo\"}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\">{tiempoRelativo}</p>\n                </div>\n              </div>\n\n              <Separator className=\"mb-6\" />\n\n              {/* Contenido */}\n              <div className=\"prose dark:prose-invert max-w-none\" data-testid=\"text-content\">\n                <p className=\"whitespace-pre-wrap\">{debate.contenido}</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Sección de comentarios */}\n          <div className=\"mb-6\">\n            <h2 className=\"text-2xl font-bold mb-4 flex items-center gap-2\">\n              <MessageSquare className=\"h-6 w-6\" />\n              Respuestas ({comentarios.length})\n            </h2>\n\n            {/* Formulario de nuevo comentario */}\n            {user ? (\n              <Card className=\"mb-6\">\n                <CardContent className=\"p-4\">\n                  <form onSubmit={handleSubmitComment}>\n                    <Textarea\n                      placeholder=\"Escribe tu respuesta...\"\n                      value={comentario}\n                      onChange={(e) => setComentario(e.target.value)}\n                      className=\"mb-3 min-h-24\"\n                      data-testid=\"input-comment\"\n                    />\n                    <div className=\"flex justify-end\">\n                      <Button\n                        type=\"submit\"\n                        disabled={addCommentMutation.isPending || !comentario.trim()}\n                        data-testid=\"button-submit-comment\"\n                      >\n                        {addCommentMutation.isPending ? (\n                          \"Publicando...\"\n                        ) : (\n                          <>\n                            <Send className=\"h-4 w-4 mr-2\" />\n                            Publicar Respuesta\n                          </>\n                        )}\n                      </Button>\n                    </div>\n                  </form>\n                </CardContent>\n              </Card>\n            ) : (\n              <Card className=\"mb-6\">\n                <CardContent className=\"p-6 text-center\">\n                  <p className=\"text-muted-foreground mb-4\">Debes iniciar sesión para comentar</p>\n                  <Link href=\"/login\">\n                    <Button data-testid=\"button-login\">Iniciar Sesión</Button>\n                  </Link>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Lista de comentarios */}\n            <div className=\"space-y-4\">\n              {comentarios.length === 0 ? (\n                <Card>\n                  <CardContent className=\"p-6 text-center\">\n                    <p className=\"text-muted-foreground\">\n                      No hay respuestas aún. ¡Sé el primero en comentar!\n                    </p>\n                  </CardContent>\n                </Card>\n              ) : (\n                comentarios.map((comment: any, index: number) => {\n                  const comentarioTiempo = comment.createdAt\n                    ? formatDistanceToNow(new Date(comment.createdAt), {\n                        addSuffix: true,\n                        locale: es,\n                      })\n                    : \"\";\n\n                  return (\n                    <Card key={comment.id} data-testid={`comment-${index + 1}`}>\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-start gap-3\">\n                          <Avatar className=\"h-8 w-8\">\n                            <AvatarFallback className=\"bg-muted\">\n                              {comment.autorNombre?.substring(0, 2).toUpperCase() || \"AN\"}\n                            </AvatarFallback>\n                          </Avatar>\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <span className=\"font-medium text-sm\">{comment.autorNombre}</span>\n                              <span className=\"text-xs text-muted-foreground\">\n                                {comentarioTiempo}\n                              </span>\n                            </div>\n                            <p className=\"text-sm whitespace-pre-wrap mb-3\">{comment.contenido}</p>\n                            <div className=\"flex items-center gap-2\">\n                              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2\">\n                                <ThumbsUp className=\"h-3 w-3 mr-1\" />\n                                <span className=\"text-xs font-mono\">\n                                  {comment.votosPositivos || 0}\n                                </span>\n                              </Button>\n                              <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2\">\n                                <ThumbsDown className=\"h-3 w-3 mr-1\" />\n                                <span className=\"text-xs font-mono\">\n                                  {comment.votosNegativos || 0}\n                                </span>\n                              </Button>\n                            </div>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  );\n                })\n              )}\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":12627},"client/src/pages/NoticiaDetalle.tsx":{"content":"import { useRoute, Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useState } from \"react\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Loader2, ArrowLeft, Calendar, User, MessageSquare, Send } from \"lucide-react\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport type { Comment } from \"@shared/schema\";\n\ninterface ComentarioConAutor extends Comment {\n  autorNombre?: string;\n}\n\nconst tipoColors: Record<string, string> = {\n  nacional: \"bg-blue-100 text-blue-800 dark:bg-blue-950 dark:text-blue-300\",\n  internacional: \"bg-purple-100 text-purple-800 dark:bg-purple-950 dark:text-purple-300\",\n  economia: \"bg-green-100 text-green-800 dark:bg-green-950 dark:text-green-300\",\n  social: \"bg-orange-100 text-orange-800 dark:bg-orange-950 dark:text-orange-300\",\n  tecnologia: \"bg-cyan-100 text-cyan-800 dark:bg-cyan-950 dark:text-cyan-300\",\n  otro: \"bg-gray-100 text-gray-800 dark:bg-gray-950 dark:text-gray-300\",\n};\n\nexport default function NoticiaDetalle() {\n  const [, params] = useRoute(\"/noticias/:id\");\n  const noticiaId = params?.id;\n\n  const userId = localStorage.getItem(\"userId\");\n  const { toast } = useToast();\n  const [comentario, setComentario] = useState(\"\");\n\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: noticia, isLoading, error } = useQuery<any>({\n    queryKey: [\"/api/news\", noticiaId],\n    enabled: !!noticiaId,\n  });\n\n  const { data: comentarios = [] } = useQuery<ComentarioConAutor[]>({\n    queryKey: [\"/api/comments/news\", noticiaId],\n    enabled: !!noticiaId,\n  });\n\n  const addCommentMutation = useMutation({\n    mutationFn: async (contenido: string) => {\n      if (!userId) {\n        throw new Error(\"Debes iniciar sesión para comentar\");\n      }\n      return apiRequest(\"POST\", `/api/comments`, {\n        contenido,\n        autorId: userId,\n        noticiaId: noticiaId,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Comentario publicado\",\n        description: \"Tu comentario se ha agregado correctamente\",\n      });\n      setComentario(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/comments/news\", noticiaId] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/news\", noticiaId] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmitComment = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!comentario.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"El comentario no puede estar vacío\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    addCommentMutation.mutate(comentario);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} tokensBalance={tokensBalance} />\n        <main className=\"flex-1 flex items-center justify-center bg-background\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (error || !noticia) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} tokensBalance={tokensBalance} />\n        <main className=\"flex-1 flex items-center justify-center bg-background\">\n          <Card className=\"max-w-md\">\n            <CardContent className=\"pt-6\">\n              <p className=\"text-center text-muted-foreground mb-4\">\n                No se pudo cargar la noticia\n              </p>\n              <Link href=\"/noticias\">\n                <Button className=\"w-full\">\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  Volver a Noticias\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-4xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          <Link href=\"/noticias\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mb-6\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Volver a Noticias\n            </Button>\n          </Link>\n\n          <article>\n            {/* Imagen destacada */}\n            {noticia.imagenUrl && (\n              <div className=\"aspect-video w-full overflow-hidden rounded-lg mb-6 bg-muted\">\n                <img\n                  src={noticia.imagenUrl}\n                  alt={noticia.titulo}\n                  className=\"w-full h-full object-cover\"\n                  data-testid=\"img-news-featured\"\n                />\n              </div>\n            )}\n\n            {/* Metadata */}\n            <div className=\"flex flex-wrap items-center gap-2 mb-4\">\n              <Badge\n                className={tipoColors[noticia.tipo] || tipoColors.otro}\n                data-testid=\"badge-news-type\"\n              >\n                {noticia.tipo.charAt(0).toUpperCase() + noticia.tipo.slice(1)}\n              </Badge>\n              {noticia.partidoAsociado && (\n                <Badge variant=\"outline\" data-testid=\"badge-party\">\n                  {noticia.partidoAsociado}\n                </Badge>\n              )}\n            </div>\n\n            {/* Título */}\n            <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins] mb-4\" data-testid=\"text-news-title\">\n              {noticia.titulo}\n            </h1>\n\n            {/* Información adicional */}\n            <div className=\"flex flex-wrap items-center gap-4 text-sm text-muted-foreground mb-8\">\n              {noticia.createdAt && (\n                <div className=\"flex items-center gap-1\">\n                  <Calendar className=\"h-4 w-4\" />\n                  <span data-testid=\"text-news-date\">\n                    {format(new Date(noticia.createdAt), \"dd 'de' MMMM 'de' yyyy\", { locale: es })}\n                  </span>\n                </div>\n              )}\n              {noticia.publicadoPorNombre && (\n                <div className=\"flex items-center gap-1\">\n                  <User className=\"h-4 w-4\" />\n                  <span data-testid=\"text-news-author\">{noticia.publicadoPorNombre}</span>\n                </div>\n              )}\n            </div>\n\n            {/* Contenido */}\n            <div\n              className=\"prose prose-lg dark:prose-invert max-w-none\"\n              data-testid=\"text-news-content\"\n            >\n              <p className=\"text-lg leading-relaxed whitespace-pre-wrap\">\n                {noticia.contenido}\n              </p>\n            </div>\n          </article>\n\n          {/* Sección de comentarios */}\n          <Card className=\"mt-8\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MessageSquare className=\"h-5 w-5\" />\n                Comentarios ({comentarios.length})\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {/* Formulario para nuevo comentario */}\n              {userId ? (\n                <form onSubmit={handleSubmitComment} className=\"space-y-4\">\n                  <Textarea\n                    placeholder=\"Escribe tu comentario...\"\n                    value={comentario}\n                    onChange={(e) => setComentario(e.target.value)}\n                    className=\"min-h-[100px]\"\n                    data-testid=\"textarea-comment\"\n                  />\n                  <div className=\"flex justify-end\">\n                    <Button \n                      type=\"submit\" \n                      disabled={addCommentMutation.isPending || !comentario.trim()}\n                      data-testid=\"button-post-comment\"\n                    >\n                      <Send className=\"h-4 w-4 mr-2\" />\n                      {addCommentMutation.isPending ? \"Publicando...\" : \"Publicar Comentario\"}\n                    </Button>\n                  </div>\n                </form>\n              ) : (\n                <div className=\"text-center p-6 bg-muted rounded-lg\">\n                  <p className=\"text-muted-foreground mb-4\">\n                    Debes iniciar sesión para comentar en esta noticia\n                  </p>\n                  <Link href=\"/login\">\n                    <Button>Iniciar Sesión</Button>\n                  </Link>\n                </div>\n              )}\n\n              <Separator />\n\n              {/* Lista de comentarios */}\n              <div className=\"space-y-6\">\n                {comentarios.length === 0 ? (\n                  <p className=\"text-center text-muted-foreground py-8\">\n                    No hay comentarios aún. ¡Sé el primero en comentar!\n                  </p>\n                ) : (\n                  comentarios.map((comentario) => (\n                    <div key={comentario.id} className=\"flex gap-4\" data-testid={`comment-${comentario.id}`}>\n                      <Avatar className=\"h-10 w-10 flex-shrink-0\">\n                        <AvatarFallback>\n                          {comentario.autorNombre?.charAt(0).toUpperCase() || \"U\"}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 space-y-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-semibold text-sm\">\n                            {comentario.autorNombre || \"Usuario\"}\n                          </span>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {comentario.createdAt\n                              ? formatDistanceToNow(new Date(comentario.createdAt), {\n                                  addSuffix: true,\n                                  locale: es,\n                                })\n                              : \"\"}\n                          </span>\n                        </div>\n                        <p className=\"text-sm whitespace-pre-wrap\">{comentario.contenido}</p>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Noticias relacionadas */}\n          <div className=\"mt-12 pt-8 border-t\">\n            <h2 className=\"text-2xl font-bold font-[Poppins] mb-6\">\n              Más Noticias\n            </h2>\n            <Link href=\"/noticias\">\n              <Button variant=\"outline\" className=\"w-full md:w-auto\">\n                Ver todas las noticias\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":11427},"client/src/pages/AdminPropuestas.tsx":{"content":"// Panel de Administración - Gestión de Propuestas\nimport { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertProposalSchema } from \"@shared/schema\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Form,\n  FormControl,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLocation, Link } from \"wouter\";\nimport { FileText, Loader2, Trash2, AlertCircle, ArrowLeft, Plus, Pencil, Eye } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\nexport default function AdminPropuestas() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const userId = localStorage.getItem(\"userId\");\n  const [proposalToDelete, setProposalToDelete] = useState<string | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingProposal, setEditingProposal] = useState<any>(null);\n\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: proposals, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/proposals\"],\n    enabled: !!userId,\n  });\n\n  const form = useForm({\n    resolver: zodResolver(insertProposalSchema),\n    defaultValues: {\n      titulo: \"\",\n      descripcion: \"\",\n      contenidoCompleto: \"\",\n      estado: \"en_deliberacion\" as const,\n      categoria: \"\",\n      partidoRelacionado: \"\",\n      autorId: userId || \"\",\n    },\n  });\n\n  const createOrUpdateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (editingProposal) {\n        return apiRequest(\"PUT\", `/api/proposals/${editingProposal.id}`, {\n          ...data,\n          userId,\n        });\n      } else {\n        return apiRequest(\"POST\", \"/api/proposals\", {\n          ...data,\n          autorId: userId,\n        });\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\"] });\n      toast({\n        title: editingProposal ? \"Propuesta actualizada\" : \"Propuesta creada\",\n        description: `La propuesta ha sido ${editingProposal ? \"actualizada\" : \"creada\"} correctamente`,\n      });\n      setIsDialogOpen(false);\n      form.reset();\n      setEditingProposal(null);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo guardar la propuesta\",\n      });\n    },\n  });\n\n  const updateStatusMutation = useMutation({\n    mutationFn: async ({ id, estado }: { id: string; estado: string }) => {\n      return apiRequest(\"PUT\", `/api/admin/proposals/${id}/status`, {\n        adminId: userId,\n        estado,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\"] });\n      toast({\n        title: \"Estado actualizado\",\n        description: \"El estado de la propuesta ha sido actualizado\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo actualizar el estado\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/admin/proposals/${id}?adminId=${userId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\"] });\n      toast({\n        title: \"Propuesta eliminada\",\n        description: \"La propuesta ha sido eliminada correctamente\",\n      });\n      setProposalToDelete(null);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo eliminar la propuesta\",\n      });\n    },\n  });\n\n  const handleEdit = (proposal: any) => {\n    setEditingProposal(proposal);\n    form.reset({\n      titulo: proposal.titulo,\n      descripcion: proposal.descripcion,\n      contenidoCompleto: proposal.contenidoCompleto,\n      estado: proposal.estado,\n      categoria: proposal.categoria,\n      partidoRelacionado: proposal.partidoRelacionado || \"\",\n      autorId: proposal.autorId,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDialogChange = (open: boolean) => {\n    setIsDialogOpen(open);\n    if (!open) {\n      setEditingProposal(null);\n      form.reset();\n    }\n  };\n\n  const onSubmit = (data: any) => {\n    createOrUpdateMutation.mutate(data);\n  };\n\n  const getStatusBadgeVariant = (estado: string) => {\n    switch (estado) {\n      case \"aprobada\":\n        return \"default\";\n      case \"rechazada\":\n        return \"destructive\";\n      case \"en_deliberacion\":\n      case \"borrador\":\n        return \"secondary\";\n      case \"votacion\":\n        return \"outline\";\n      default:\n        return \"outline\";\n    }\n  };\n\n  const getStatusLabel = (estado: string) => {\n    switch (estado) {\n      case \"aprobada\":\n        return \"Aprobada\";\n      case \"rechazada\":\n        return \"Rechazada\";\n      case \"en_deliberacion\":\n        return \"En Deliberación\";\n      case \"borrador\":\n        return \"Borrador\";\n      case \"votacion\":\n        return \"En Votación\";\n      case \"archivada\":\n        return \"Archivada\";\n      default:\n        return estado;\n    }\n  };\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!user.isAdmin) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} />\n        <main className=\"flex-1 flex items-center justify-center bg-background\">\n          <Card className=\"max-w-md\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2 text-destructive\">\n                <AlertCircle className=\"h-5 w-5\" />\n                <CardTitle>Acceso Denegado</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                No tienes permisos para acceder al panel de administración.\n              </p>\n              <Link href=\"/dashboard\">\n                <Button>Volver al Dashboard</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <div>\n              <Link href=\"/admin\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\">\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  Volver al Panel\n                </Button>\n              </Link>\n              <div className=\"flex items-center gap-2 mb-2\">\n                <FileText className=\"h-8 w-8 text-primary\" />\n                <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins]\" data-testid=\"text-admin-proposals-title\">\n                  Gestión de Propuestas\n                </h1>\n              </div>\n              <p className=\"text-muted-foreground\">\n                Crea, edita, revisa, aprueba o rechaza propuestas ciudadanas\n              </p>\n            </div>\n\n            <Dialog open={isDialogOpen} onOpenChange={handleDialogChange}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-create-proposal\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Nueva Propuesta\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingProposal ? \"Editar Propuesta\" : \"Crear Nueva Propuesta\"}\n                  </DialogTitle>\n                  <DialogDescription>\n                    Completa los datos de la propuesta ciudadana\n                  </DialogDescription>\n                </DialogHeader>\n\n                <Form {...form}>\n                  <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"titulo\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Título *</FormLabel>\n                          <FormControl>\n                            <Input\n                              {...field}\n                              placeholder=\"Título de la propuesta (mínimo 10 caracteres)\"\n                              data-testid=\"input-proposal-title\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"descripcion\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Descripción *</FormLabel>\n                          <FormControl>\n                            <Textarea\n                              {...field}\n                              placeholder=\"Descripción breve (mínimo 20 caracteres)\"\n                              rows={3}\n                              data-testid=\"input-proposal-description\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"contenidoCompleto\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Contenido Completo *</FormLabel>\n                          <FormControl>\n                            <Textarea\n                              {...field}\n                              placeholder=\"Contenido detallado de la propuesta (mínimo 50 caracteres)\"\n                              rows={6}\n                              data-testid=\"input-proposal-content\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <FormField\n                        control={form.control}\n                        name=\"categoria\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Categoría *</FormLabel>\n                            <FormControl>\n                              <Input\n                                {...field}\n                                placeholder=\"Ej: Educación, Salud, Economía\"\n                                data-testid=\"input-proposal-category\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n\n                      <FormField\n                        control={form.control}\n                        name=\"partidoRelacionado\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Partido Relacionado</FormLabel>\n                            <FormControl>\n                              <Input\n                                {...field}\n                                placeholder=\"Ej: PSOE, PP, Podemos...\"\n                                data-testid=\"input-proposal-party\"\n                              />\n                            </FormControl>\n                            <FormMessage />\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n\n                    {/* Campo hidden para autorId */}\n                    <FormField\n                      control={form.control}\n                      name=\"autorId\"\n                      render={({ field }) => (\n                        <FormItem className=\"hidden\">\n                          <FormControl>\n                            <Input type=\"hidden\" {...field} />\n                          </FormControl>\n                        </FormItem>\n                      )}\n                    />\n\n                    <DialogFooter>\n                      <Button\n                        type=\"button\"\n                        variant=\"outline\"\n                        onClick={() => setIsDialogOpen(false)}\n                        data-testid=\"button-cancel-proposal\"\n                      >\n                        Cancelar\n                      </Button>\n                      <Button\n                        type=\"submit\"\n                        disabled={createOrUpdateMutation.isPending}\n                        data-testid=\"button-save-proposal\"\n                      >\n                        {createOrUpdateMutation.isPending ? (\n                          <>\n                            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                            Guardando...\n                          </>\n                        ) : (\n                          editingProposal ? \"Actualizar\" : \"Crear\"\n                        )}\n                      </Button>\n                    </DialogFooter>\n                  </form>\n                </Form>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          <Card>\n            <CardHeader>\n              <CardTitle>Todas las Propuestas</CardTitle>\n              <CardDescription>\n                {proposals?.length || 0} propuestas en total\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {isLoading ? (\n                <div className=\"flex justify-center py-8\">\n                  <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                </div>\n              ) : !proposals || proposals.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  No hay propuestas registradas. Crea la primera propuesta.\n                </p>\n              ) : (\n                <div className=\"overflow-x-auto\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead>Título</TableHead>\n                        <TableHead>Categoría</TableHead>\n                        <TableHead>Fecha</TableHead>\n                        <TableHead>Votos</TableHead>\n                        <TableHead>Estado</TableHead>\n                        <TableHead>Acciones</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {proposals.map((proposal: any) => (\n                        <TableRow key={proposal.id}>\n                          <TableCell className=\"font-medium max-w-xs\">\n                            <div className=\"truncate\" title={proposal.titulo}>\n                              {proposal.titulo}\n                            </div>\n                          </TableCell>\n                          <TableCell>\n                            <Badge variant=\"outline\">{proposal.categoria}</Badge>\n                          </TableCell>\n                          <TableCell className=\"text-sm text-muted-foreground\">\n                            {(() => {\n                              try {\n                                const date = proposal.createdAt ? new Date(proposal.createdAt) : null;\n                                return date && !isNaN(date.getTime())\n                                  ? format(date, \"dd MMM yyyy\", { locale: es })\n                                  : \"Fecha no disponible\";\n                              } catch {\n                                return \"Fecha no disponible\";\n                              }\n                            })()}\n                          </TableCell>\n                          <TableCell>{proposal.votos || 0}</TableCell>\n                          <TableCell>\n                            <Select\n                              value={proposal.estado}\n                              onValueChange={(value) =>\n                                updateStatusMutation.mutate({ id: proposal.id, estado: value })\n                              }\n                              disabled={updateStatusMutation.isPending}\n                            >\n                              <SelectTrigger className=\"w-40\" data-testid={`select-status-${proposal.id}`}>\n                                <SelectValue>\n                                  <Badge variant={getStatusBadgeVariant(proposal.estado)}>\n                                    {getStatusLabel(proposal.estado)}\n                                  </Badge>\n                                </SelectValue>\n                              </SelectTrigger>\n                              <SelectContent>\n                                <SelectItem value=\"borrador\">Borrador</SelectItem>\n                                <SelectItem value=\"en_deliberacion\">En Deliberación</SelectItem>\n                                <SelectItem value=\"votacion\">En Votación</SelectItem>\n                                <SelectItem value=\"aprobada\">Aprobada</SelectItem>\n                                <SelectItem value=\"rechazada\">Rechazada</SelectItem>\n                                <SelectItem value=\"archivada\">Archivada</SelectItem>\n                              </SelectContent>\n                            </Select>\n                          </TableCell>\n                          <TableCell>\n                            <div className=\"flex gap-2\">\n                              <Link href=\"/propuestas\">\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"sm\"\n                                  data-testid={`button-view-${proposal.id}`}\n                                >\n                                  <Eye className=\"h-4 w-4\" />\n                                </Button>\n                              </Link>\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => handleEdit(proposal)}\n                                data-testid={`button-edit-${proposal.id}`}\n                              >\n                                <Pencil className=\"h-4 w-4\" />\n                              </Button>\n                              <Button\n                                variant=\"ghost\"\n                                size=\"sm\"\n                                onClick={() => setProposalToDelete(proposal.id)}\n                                disabled={deleteMutation.isPending}\n                                data-testid={`button-delete-${proposal.id}`}\n                              >\n                                <Trash2 className=\"h-4 w-4 text-destructive\" />\n                              </Button>\n                            </div>\n                          </TableCell>\n                        </TableRow>\n                      ))}\n                    </TableBody>\n                  </Table>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n\n      <AlertDialog open={!!proposalToDelete} onOpenChange={() => setProposalToDelete(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>¿Eliminar propuesta?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Esta acción no se puede deshacer. La propuesta será eliminada permanentemente.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancelar</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => proposalToDelete && deleteMutation.mutate(proposalToDelete)}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              Eliminar\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","size_bytes":21839},"client/src/pages/AdminSondeos.tsx":{"content":"// Panel de Administración - Gestión de Sondeos\nimport { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport {\n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLocation, Link } from \"wouter\";\nimport { BarChart3, Loader2, Plus, X, AlertCircle, ArrowLeft, Eye, Pencil, Trash2 } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\nconst pollSchema = z.object({\n  pregunta: z.string().min(5, \"La pregunta debe tener al menos 5 caracteres\"),\n  descripcion: z.string().min(10, \"La descripción debe tener al menos 10 caracteres\"),\n  fechaFin: z.string().optional(),\n});\n\ntype PollFormData = z.infer<typeof pollSchema>;\n\nexport default function AdminSondeos() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const userId = localStorage.getItem(\"userId\");\n  const [options, setOptions] = useState<string[]>([\"\", \"\"]);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [editingPoll, setEditingPoll] = useState<any>(null);\n\n  useEffect(() => {\n    if (!userId) {\n      setLocation(\"/login\");\n    }\n  }, [userId, setLocation]);\n\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: polls, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/polls\"],\n    enabled: !!userId,\n  });\n\n  const form = useForm<PollFormData>({\n    resolver: zodResolver(pollSchema),\n    defaultValues: {\n      pregunta: \"\",\n      descripcion: \"\",\n      fechaFin: \"\",\n    },\n  });\n\n  const createPollMutation = useMutation({\n    mutationFn: async (data: PollFormData & { opciones: string[] }) => {\n      return apiRequest(\"POST\", \"/api/admin/polls\", {\n        adminId: userId,\n        ...data,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      toast({\n        title: \"Sondeo creado\",\n        description: \"El sondeo ha sido creado exitosamente\",\n      });\n      form.reset();\n      setOptions([\"\", \"\"]);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo crear el sondeo\",\n      });\n    },\n  });\n\n  const updatePollMutation = useMutation({\n    mutationFn: async (data: { id: string } & Partial<PollFormData>) => {\n      const { id, ...pollData } = data;\n      return apiRequest(\"PUT\", `/api/admin/polls/${id}`, {\n        adminId: userId,\n        ...pollData,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      toast({\n        title: \"Sondeo actualizado\",\n        description: \"El sondeo ha sido actualizado exitosamente\",\n      });\n      setIsEditDialogOpen(false);\n      setEditingPoll(null);\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo actualizar el sondeo\",\n      });\n    },\n  });\n\n  const deletePollMutation = useMutation({\n    mutationFn: async (pollId: string) => {\n      return apiRequest(\"DELETE\", `/api/admin/polls/${pollId}?adminId=${userId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/polls\"] });\n      toast({\n        title: \"Sondeo eliminado\",\n        description: \"El sondeo ha sido eliminado exitosamente\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo eliminar el sondeo\",\n      });\n    },\n  });\n\n  const onSubmit = (data: PollFormData) => {\n    const validOptions = options.filter((opt) => opt.trim() !== \"\");\n    \n    if (validOptions.length < 2) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Debes agregar al menos 2 opciones\",\n      });\n      return;\n    }\n\n    createPollMutation.mutate({\n      ...data,\n      opciones: validOptions,\n    });\n  };\n\n  const addOption = () => {\n    setOptions([...options, \"\"]);\n  };\n\n  const removeOption = (index: number) => {\n    if (options.length > 2) {\n      setOptions(options.filter((_, i) => i !== index));\n    }\n  };\n\n  const updateOption = (index: number, value: string) => {\n    const newOptions = [...options];\n    newOptions[index] = value;\n    setOptions(newOptions);\n  };\n\n  const handleEdit = (poll: any) => {\n    setEditingPoll(poll);\n    setIsEditDialogOpen(true);\n  };\n\n  const handleDelete = (pollId: string) => {\n    if (confirm(\"¿Estás seguro de que deseas eliminar este sondeo?\")) {\n      deletePollMutation.mutate(pollId);\n    }\n  };\n\n  const handleUpdatePoll = (data: PollFormData) => {\n    if (!editingPoll) return;\n    updatePollMutation.mutate({\n      id: editingPoll.id,\n      ...data,\n    });\n  };\n\n  if (!user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!user.isAdmin) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} />\n        <main className=\"flex-1 flex items-center justify-center bg-background\">\n          <Card className=\"max-w-md\">\n            <CardHeader>\n              <div className=\"flex items-center gap-2 text-destructive\">\n                <AlertCircle className=\"h-5 w-5\" />\n                <CardTitle>Acceso Denegado</CardTitle>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-muted-foreground mb-4\">\n                No tienes permisos para acceder al panel de administración.\n              </p>\n              <Link href=\"/dashboard\">\n                <Button>Volver al Dashboard</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          <div className=\"mb-6\">\n            <Link href=\"/admin\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Volver al Panel\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-2 mb-2\">\n              <BarChart3 className=\"h-8 w-8 text-primary\" />\n              <h1 className=\"text-3xl md:text-4xl font-bold font-[Poppins]\" data-testid=\"text-admin-polls-title\">\n                Gestión de Sondeos\n              </h1>\n            </div>\n            <p className=\"text-muted-foreground\">\n              Crea nuevos sondeos para la participación ciudadana\n            </p>\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            {/* Formulario para crear sondeo */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Crear Nuevo Sondeo</CardTitle>\n                <CardDescription>\n                  Define el título, descripción y opciones del sondeo\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <Form {...form}>\n                  <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"pregunta\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Pregunta del Sondeo</FormLabel>\n                          <FormControl>\n                            <Input placeholder=\"¿Cuál es tu opinión sobre...?\" {...field} data-testid=\"input-poll-title\" />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"descripcion\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Descripción</FormLabel>\n                          <FormControl>\n                            <Textarea\n                              placeholder=\"Describe el contexto del sondeo...\"\n                              className=\"resize-none\"\n                              rows={3}\n                              {...field}\n                              data-testid=\"input-poll-description\"\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <FormField\n                      control={form.control}\n                      name=\"fechaFin\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Fecha de Cierre (Opcional)</FormLabel>\n                          <FormControl>\n                            <Input type=\"date\" {...field} data-testid=\"input-poll-close-date\" />\n                          </FormControl>\n                          <FormDescription>\n                            Deja vacío para mantener el sondeo abierto indefinidamente\n                          </FormDescription>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n\n                    <div className=\"space-y-3\">\n                      <div className=\"flex items-center justify-between\">\n                        <FormLabel>Opciones</FormLabel>\n                        <Button type=\"button\" size=\"sm\" variant=\"outline\" onClick={addOption} data-testid=\"button-add-option\">\n                          <Plus className=\"h-4 w-4 mr-1\" />\n                          Agregar Opción\n                        </Button>\n                      </div>\n                      {options.map((option, index) => (\n                        <div key={index} className=\"flex gap-2\">\n                          <Input\n                            placeholder={`Opción ${index + 1}`}\n                            value={option}\n                            onChange={(e) => updateOption(index, e.target.value)}\n                            data-testid={`input-option-${index}`}\n                          />\n                          {options.length > 2 && (\n                            <Button\n                              type=\"button\"\n                              size=\"icon\"\n                              variant=\"ghost\"\n                              onClick={() => removeOption(index)}\n                              data-testid={`button-remove-option-${index}`}\n                            >\n                              <X className=\"h-4 w-4\" />\n                            </Button>\n                          )}\n                        </div>\n                      ))}\n                      <p className=\"text-xs text-muted-foreground\">\n                        Mínimo 2 opciones requeridas\n                      </p>\n                    </div>\n\n                    <Button type=\"submit\" className=\"w-full\" disabled={createPollMutation.isPending} data-testid=\"button-create-poll\">\n                      {createPollMutation.isPending ? (\n                        <>\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                          Creando...\n                        </>\n                      ) : (\n                        \"Crear Sondeo\"\n                      )}\n                    </Button>\n                  </form>\n                </Form>\n              </CardContent>\n            </Card>\n\n            {/* Lista de sondeos existentes */}\n            <Card>\n              <CardHeader>\n                <CardTitle>Sondeos Existentes</CardTitle>\n                <CardDescription>\n                  {polls?.length || 0} sondeos en total\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                {isLoading ? (\n                  <div className=\"flex justify-center py-8\">\n                    <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n                  </div>\n                ) : !polls || polls.length === 0 ? (\n                  <p className=\"text-center text-muted-foreground py-8\">\n                    No hay sondeos registrados\n                  </p>\n                ) : (\n                  <div className=\"space-y-4 max-h-[600px] overflow-y-auto\">\n                    {polls.map((poll: any) => (\n                      <Card key={poll.id} className=\"hover-elevate\">\n                        <CardHeader className=\"pb-3\">\n                          <div className=\"flex items-start justify-between gap-2\">\n                            <CardTitle className=\"text-base line-clamp-1\">{poll.pregunta}</CardTitle>\n                            <div className=\"flex gap-2 flex-shrink-0\">\n                              <Badge variant={poll.activo ? \"default\" : \"secondary\"}>\n                                {poll.activo ? \"Activo\" : \"Cerrado\"}\n                              </Badge>\n                            </div>\n                          </div>\n                        </CardHeader>\n                        <CardContent className=\"space-y-3\">\n                          <p className=\"text-sm text-muted-foreground line-clamp-2\">\n                            {poll.descripcion}\n                          </p>\n                          <div className=\"text-xs text-muted-foreground\">\n                            Creado: {format(new Date(poll.createdAt || poll.fechaInicio), \"dd MMM yyyy\", { locale: es })}\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <Link href=\"/sondeos\" className=\"flex-1\">\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                className=\"w-full\"\n                                data-testid={`button-view-poll-${poll.id}`}\n                              >\n                                <Eye className=\"h-4 w-4 mr-2\" />\n                                Ver\n                              </Button>\n                            </Link>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => handleEdit(poll)}\n                              data-testid={`button-edit-poll-${poll.id}`}\n                            >\n                              <Pencil className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              onClick={() => handleDelete(poll.id)}\n                              disabled={deletePollMutation.isPending}\n                              data-testid={`button-delete-poll-${poll.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n\n      {/* Dialog de edición */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Editar Sondeo</DialogTitle>\n            <DialogDescription>\n              Modifica los detalles del sondeo\n            </DialogDescription>\n          </DialogHeader>\n          {editingPoll && (\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(handleUpdatePoll)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"pregunta\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Pregunta del Sondeo</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          defaultValue={editingPoll.pregunta}\n                          data-testid=\"input-edit-poll-title\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"descripcion\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Descripción</FormLabel>\n                      <FormControl>\n                        <Textarea\n                          {...field}\n                          defaultValue={editingPoll.descripcion}\n                          className=\"resize-none\"\n                          rows={3}\n                          data-testid=\"input-edit-poll-description\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"fechaFin\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Fecha de Cierre (Opcional)</FormLabel>\n                      <FormControl>\n                        <Input \n                          type=\"date\" \n                          {...field}\n                          defaultValue={editingPoll.fechaFin ? editingPoll.fechaFin.split('T')[0] : \"\"}\n                          data-testid=\"input-edit-poll-close-date\" \n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <div className=\"flex gap-2 justify-end\">\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    onClick={() => setIsEditDialogOpen(false)}\n                    data-testid=\"button-cancel-edit\"\n                  >\n                    Cancelar\n                  </Button>\n                  <Button \n                    type=\"submit\" \n                    disabled={updatePollMutation.isPending}\n                    data-testid=\"button-submit-edit\"\n                  >\n                    {updatePollMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Guardando...\n                      </>\n                    ) : (\n                      \"Guardar Cambios\"\n                    )}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":20121},"client/src/pages/AdminDebates.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, MessageSquare, Plus, Pencil, Trash2, Eye, Star } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\n\nexport default function AdminDebates() {\n  const userId = localStorage.getItem(\"userId\");\n  const { toast } = useToast();\n\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingDebate, setEditingDebate] = useState<any>(null);\n  const [formData, setFormData] = useState({\n    titulo: \"\",\n    contenido: \"\",\n    categoria: \"general\",\n    destacado: false,\n  });\n\n  // Cargar usuario actual\n  const { data: user } = useQuery<any>({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  // Cargar debates\n  const { data: debates = [], isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/admin/debates\", userId],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/debates?adminId=${userId}`);\n      if (!response.ok) {\n        throw new Error(\"Error al cargar debates\");\n      }\n      return response.json();\n    },\n    enabled: !!user?.isAdmin && !!userId,\n  });\n\n  // Crear/editar debate\n  const createOrUpdateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (editingDebate) {\n        return apiRequest(\"PUT\", `/api/admin/debates/${editingDebate.id}`, {\n          ...data,\n          adminId: userId,\n        });\n      } else {\n        return apiRequest(\"POST\", \"/api/admin/debates\", {\n          ...data,\n          autorId: userId,\n          adminId: userId,\n        });\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/debates\", userId] });\n      toast({\n        title: editingDebate ? \"Debate actualizado\" : \"Debate creado\",\n        description: `El debate ha sido ${editingDebate ? \"actualizado\" : \"creado\"} correctamente`,\n      });\n      setIsDialogOpen(false);\n      resetForm();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo guardar el debate\",\n      });\n    },\n  });\n\n  // Eliminar debate\n  const deleteMutation = useMutation({\n    mutationFn: async (debateId: string) => {\n      return apiRequest(\"DELETE\", `/api/admin/debates/${debateId}?adminId=${userId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/debates\", userId] });\n      toast({\n        title: \"Debate eliminado\",\n        description: \"El debate ha sido eliminado correctamente\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo eliminar el debate\",\n      });\n    },\n  });\n\n  // Toggle destacado\n  const toggleDestacadoMutation = useMutation({\n    mutationFn: async ({ id, destacado }: { id: string; destacado: boolean }) => {\n      return apiRequest(\"PUT\", `/api/admin/debates/${id}`, {\n        destacado: !destacado,\n        adminId: userId,\n      });\n    },\n    onSuccess: async () => {\n      await queryClient.invalidateQueries({ queryKey: [\"/api/admin/debates\", userId] });\n      await queryClient.refetchQueries({ queryKey: [\"/api/admin/debates\", userId] });\n      toast({\n        title: \"Debate actualizado\",\n        description: \"El estado destacado ha sido cambiado\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo actualizar el debate\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setFormData({\n      titulo: \"\",\n      contenido: \"\",\n      categoria: \"general\",\n      destacado: false,\n    });\n    setEditingDebate(null);\n  };\n\n  const handleDialogChange = (open: boolean) => {\n    setIsDialogOpen(open);\n    if (!open) {\n      resetForm();\n    }\n  };\n\n  const handleEdit = (debate: any) => {\n    setEditingDebate(debate);\n    setFormData({\n      titulo: debate.titulo,\n      contenido: debate.contenido,\n      categoria: debate.categoria,\n      destacado: debate.destacado,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    createOrUpdateMutation.mutate(formData);\n  };\n\n  const handleDelete = async (debateId: string) => {\n    if (window.confirm(\"¿Estás seguro de que deseas eliminar este debate?\")) {\n      deleteMutation.mutate(debateId);\n    }\n  };\n\n  const handleToggleDestacado = async (id: string, destacado: boolean) => {\n    toggleDestacadoMutation.mutate({ id, destacado });\n  };\n\n  // Verificar si es admin\n  if (!user?.isAdmin) {\n    return null;\n  }\n\n  const categoriaColors: Record<string, string> = {\n    politica: \"bg-red-100 text-red-800 dark:bg-red-950 dark:text-red-300\",\n    economia: \"bg-green-100 text-green-800 dark:bg-green-950 dark:text-green-300\",\n    social: \"bg-blue-100 text-blue-800 dark:bg-blue-950 dark:text-blue-300\",\n    tecnologia: \"bg-purple-100 text-purple-800 dark:bg-purple-950 dark:text-purple-300\",\n    medioambiente: \"bg-emerald-100 text-emerald-800 dark:bg-emerald-950 dark:text-emerald-300\",\n    general: \"bg-gray-100 text-gray-800 dark:bg-gray-950 dark:text-gray-300\",\n  };\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"flex items-center justify-between mb-8\">\n            <div>\n              <Link href=\"/admin\">\n                <Button variant=\"ghost\" size=\"sm\" className=\"mb-2\" data-testid=\"button-back-admin\">\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  Volver al Panel\n                </Button>\n              </Link>\n              <div className=\"flex items-center gap-2\">\n                <MessageSquare className=\"h-8 w-8 text-primary\" />\n                <h1\n                  className=\"text-3xl md:text-4xl font-bold font-[Poppins]\"\n                  data-testid=\"text-admin-debates-title\"\n                >\n                  Gestión de Debates\n                </h1>\n              </div>\n            </div>\n\n            <Dialog open={isDialogOpen} onOpenChange={handleDialogChange}>\n              <DialogTrigger asChild>\n                <Button data-testid=\"button-create-debate\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Nuevo Debate\n                </Button>\n              </DialogTrigger>\n              <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n                <DialogHeader>\n                  <DialogTitle>\n                    {editingDebate ? \"Editar Debate\" : \"Crear Nuevo Debate\"}\n                  </DialogTitle>\n                  <DialogDescription>\n                    Completa los datos del debate del foro\n                  </DialogDescription>\n                </DialogHeader>\n\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\n                  <div>\n                    <Label htmlFor=\"titulo\">Título *</Label>\n                    <Input\n                      id=\"titulo\"\n                      value={formData.titulo}\n                      onChange={(e) => setFormData({ ...formData, titulo: e.target.value })}\n                      placeholder=\"Título del debate\"\n                      required\n                      data-testid=\"input-debate-title\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"contenido\">Contenido *</Label>\n                    <Textarea\n                      id=\"contenido\"\n                      value={formData.contenido}\n                      onChange={(e) => setFormData({ ...formData, contenido: e.target.value })}\n                      placeholder=\"Contenido completo del debate\"\n                      rows={8}\n                      required\n                      data-testid=\"input-debate-content\"\n                    />\n                  </div>\n\n                  <div>\n                    <Label htmlFor=\"categoria\">Categoría *</Label>\n                    <Select\n                      value={formData.categoria}\n                      onValueChange={(value) => setFormData({ ...formData, categoria: value })}\n                    >\n                      <SelectTrigger id=\"categoria\" data-testid=\"select-debate-category\">\n                        <SelectValue placeholder=\"Selecciona categoría\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"politica\">Política</SelectItem>\n                        <SelectItem value=\"economia\">Economía</SelectItem>\n                        <SelectItem value=\"social\">Social</SelectItem>\n                        <SelectItem value=\"tecnologia\">Tecnología</SelectItem>\n                        <SelectItem value=\"medioambiente\">Medioambiente</SelectItem>\n                        <SelectItem value=\"general\">General</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"flex items-center gap-2\">\n                    <input\n                      type=\"checkbox\"\n                      id=\"destacado\"\n                      checked={formData.destacado}\n                      onChange={(e) => setFormData({ ...formData, destacado: e.target.checked })}\n                      className=\"h-4 w-4\"\n                      data-testid=\"input-debate-featured\"\n                    />\n                    <Label htmlFor=\"destacado\">Marcar como destacado</Label>\n                  </div>\n\n                  <div className=\"flex justify-end gap-2 pt-4\">\n                    <Button\n                      type=\"button\"\n                      variant=\"outline\"\n                      onClick={() => setIsDialogOpen(false)}\n                      data-testid=\"button-cancel\"\n                    >\n                      Cancelar\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      disabled={createOrUpdateMutation.isPending}\n                      data-testid=\"button-save-debate\"\n                    >\n                      {createOrUpdateMutation.isPending\n                        ? \"Guardando...\"\n                        : editingDebate\n                        ? \"Actualizar\"\n                        : \"Crear\"}\n                    </Button>\n                  </div>\n                </form>\n              </DialogContent>\n            </Dialog>\n          </div>\n\n          {/* Estadísticas */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4 mb-8\">\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  Total Debates\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">{debates.length}</div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  Debates Destacados\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">\n                  {debates.filter((d: any) => d.destacado).length}\n                </div>\n              </CardContent>\n            </Card>\n            <Card>\n              <CardHeader className=\"pb-3\">\n                <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                  Total Respuestas\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-2xl font-bold\">\n                  {debates.reduce((sum: number, d: any) => sum + (d.numRespuestas || 0), 0)}\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Lista de debates */}\n          <div className=\"space-y-4\">\n            {isLoading ? (\n              <Card>\n                <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                  Cargando debates...\n                </CardContent>\n              </Card>\n            ) : debates.length === 0 ? (\n              <Card>\n                <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                  No hay debates creados. Crea el primer debate.\n                </CardContent>\n              </Card>\n            ) : (\n              debates.map((debate: any) => {\n                const tiempoRelativo = debate.createdAt\n                  ? formatDistanceToNow(new Date(debate.createdAt), {\n                      addSuffix: true,\n                      locale: es,\n                    })\n                  : \"\";\n\n                return (\n                  <Card\n                    key={debate.id}\n                    className=\"hover-elevate\"\n                    data-testid={`card-debate-${debate.id}`}\n                  >\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between gap-4\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <Badge\n                              className={\n                                categoriaColors[debate.categoria] || categoriaColors.general\n                              }\n                            >\n                              {debate.categoria.charAt(0).toUpperCase() +\n                                debate.categoria.slice(1)}\n                            </Badge>\n                            {debate.destacado && (\n                              <Badge variant=\"default\" className=\"flex items-center gap-1\">\n                                <Star className=\"h-3 w-3 fill-current\" />\n                                Destacado\n                              </Badge>\n                            )}\n                          </div>\n                          <CardTitle className=\"text-xl mb-2\">{debate.titulo}</CardTitle>\n                          <div className=\"flex flex-wrap items-center gap-4 text-sm text-muted-foreground\">\n                            <span>Por {debate.autorNombre || \"Admin\"}</span>\n                            <span>{tiempoRelativo}</span>\n                            <span className=\"flex items-center gap-1\">\n                              <MessageSquare className=\"h-4 w-4\" />\n                              {debate.numRespuestas} respuestas\n                            </span>\n                            <span className=\"flex items-center gap-1\">\n                              <Eye className=\"h-4 w-4\" />\n                              {debate.numVistas} vistas\n                            </span>\n                          </div>\n                        </div>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleToggleDestacado(debate.id, debate.destacado)}\n                            title={debate.destacado ? \"Quitar destacado\" : \"Marcar como destacado\"}\n                            data-testid={`button-toggle-featured-${debate.id}`}\n                          >\n                            <Star\n                              className={`h-4 w-4 ${\n                                debate.destacado ? \"fill-yellow-400 text-yellow-400\" : \"\"\n                              }`}\n                            />\n                          </Button>\n                          <Link href={`/foro/${debate.id}`}>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              data-testid={`button-view-debate-${debate.id}`}\n                            >\n                              <Eye className=\"h-4 w-4\" />\n                            </Button>\n                          </Link>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(debate)}\n                            data-testid={`button-edit-debate-${debate.id}`}\n                          >\n                            <Pencil className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(debate.id)}\n                            disabled={deleteMutation.isPending}\n                            data-testid={`button-delete-debate-${debate.id}`}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground line-clamp-3\">{debate.contenido}</p>\n                    </CardContent>\n                  </Card>\n                );\n              })\n            )}\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":18262},"client/src/pages/ForoNuevo.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { ArrowLeft, MessageSquare } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\n\nexport default function ForoNuevo() {\n  const userId = localStorage.getItem(\"userId\");\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n\n  const [formData, setFormData] = useState({\n    titulo: \"\",\n    contenido: \"\",\n    categoria: \"general\",\n  });\n\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const createDebateMutation = useMutation({\n    mutationFn: async (data: any) => {\n      if (!userId) {\n        throw new Error(\"Debes iniciar sesión para crear un debate\");\n      }\n\n      if (user?.isAdmin) {\n        return apiRequest(\"POST\", \"/api/admin/debates\", {\n          ...data,\n          autorId: userId,\n          adminId: userId,\n        });\n      } else {\n        throw new Error(\"Solo los administradores pueden crear debates\");\n      }\n    },\n    onSuccess: (debate: any) => {\n      toast({\n        title: \"Debate creado\",\n        description: \"Tu debate ha sido publicado correctamente\",\n      });\n      navigate(`/foro/${debate.id}`);\n    },\n    onError: (error: Error) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo crear el debate\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    if (!userId) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Debes iniciar sesión para crear un debate\",\n      });\n      return;\n    }\n\n    if (!formData.titulo.trim() || !formData.contenido.trim()) {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"El título y contenido son obligatorios\",\n      });\n      return;\n    }\n\n    createDebateMutation.mutate(formData);\n  };\n\n  if (!userId) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} tokensBalance={tokensBalance} />\n        <main className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <MessageSquare className=\"h-12 w-12 text-muted-foreground mx-auto mb-4\" />\n            <h2 className=\"text-2xl font-bold mb-2\">Inicia Sesión</h2>\n            <p className=\"text-muted-foreground mb-4\">\n              Debes iniciar sesión para crear debates\n            </p>\n            <Link href=\"/login\">\n              <Button>Iniciar Sesión</Button>\n            </Link>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-4xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Header */}\n          <div className=\"mb-8\">\n            <Link href=\"/foro\">\n              <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\" data-testid=\"button-back-to-forum\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Volver al Foro\n              </Button>\n            </Link>\n            <h1\n              className=\"text-3xl md:text-4xl font-bold font-[Poppins]\"\n              data-testid=\"text-page-title\"\n            >\n              Crear Nuevo Debate\n            </h1>\n            <p className=\"text-muted-foreground mt-2\">\n              Inicia una discusión sobre un tema que te interese\n            </p>\n          </div>\n\n          {/* Formulario */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Detalles del Debate</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-6\">\n                <div>\n                  <Label htmlFor=\"titulo\">Título del Debate *</Label>\n                  <Input\n                    id=\"titulo\"\n                    value={formData.titulo}\n                    onChange={(e) => setFormData({ ...formData, titulo: e.target.value })}\n                    placeholder=\"¿Cuál es tu pregunta o tema de debate?\"\n                    required\n                    data-testid=\"input-debate-title\"\n                    className=\"mt-2\"\n                  />\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Escribe un título claro y descriptivo\n                  </p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"contenido\">Contenido *</Label>\n                  <Textarea\n                    id=\"contenido\"\n                    value={formData.contenido}\n                    onChange={(e) => setFormData({ ...formData, contenido: e.target.value })}\n                    placeholder=\"Describe tu tema de debate, proporciona contexto y argumentos...\"\n                    rows={10}\n                    required\n                    data-testid=\"input-debate-content\"\n                    className=\"mt-2\"\n                  />\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Explica tu punto de vista y proporciona contexto relevante\n                  </p>\n                </div>\n\n                <div>\n                  <Label htmlFor=\"categoria\">Categoría *</Label>\n                  <Select\n                    value={formData.categoria}\n                    onValueChange={(value) => setFormData({ ...formData, categoria: value })}\n                  >\n                    <SelectTrigger id=\"categoria\" data-testid=\"select-debate-category\" className=\"mt-2\">\n                      <SelectValue placeholder=\"Selecciona una categoría\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"politica\">Política</SelectItem>\n                      <SelectItem value=\"economia\">Economía</SelectItem>\n                      <SelectItem value=\"social\">Social</SelectItem>\n                      <SelectItem value=\"tecnologia\">Tecnología</SelectItem>\n                      <SelectItem value=\"medioambiente\">Medioambiente</SelectItem>\n                      <SelectItem value=\"general\">General</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <p className=\"text-sm text-muted-foreground mt-1\">\n                    Elige la categoría que mejor represente tu debate\n                  </p>\n                </div>\n\n                <div className=\"flex justify-end gap-3 pt-4\">\n                  <Link href=\"/foro\">\n                    <Button type=\"button\" variant=\"outline\" data-testid=\"button-cancel\">\n                      Cancelar\n                    </Button>\n                  </Link>\n                  <Button\n                    type=\"submit\"\n                    disabled={createDebateMutation.isPending}\n                    data-testid=\"button-submit\"\n                  >\n                    {createDebateMutation.isPending ? \"Publicando...\" : \"Publicar Debate\"}\n                  </Button>\n                </div>\n              </form>\n            </CardContent>\n          </Card>\n\n          {/* Nota informativa */}\n          {!user?.isAdmin && (\n            <Card className=\"mt-6 border-amber-200 bg-amber-50 dark:bg-amber-950 dark:border-amber-800\">\n              <CardContent className=\"pt-6\">\n                <p className=\"text-sm text-amber-800 dark:text-amber-200\">\n                  ℹ️ Actualmente, solo los administradores pueden crear debates públicos. \n                  Si deseas proponer un debate, contacta con un administrador.\n                </p>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n","size_bytes":8512},"client/src/pages/PropuestaDetalle.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Navbar } from \"@/components/Navbar\";\nimport { Footer } from \"@/components/Footer\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ArrowLeft, MessageSquare, TrendingUp, Coins, Heart, ThumbsUp, Send } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { es } from \"date-fns/locale\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Link } from \"wouter\";\nimport { DonateModal } from \"@/components/DonateModal\";\nimport type { Comment } from \"@shared/schema\";\n\ninterface PropuestaDetalle {\n  id: string;\n  titulo: string;\n  descripcion: string;\n  categoria: string;\n  estado: string;\n  apoyosTP: number;\n  apoyosTA: number;\n  autorNombre: string;\n  createdAt: Date;\n  numComentarios?: number;\n}\n\ninterface ComentarioConAutor extends Comment {\n  autorNombre?: string;\n}\n\nconst estadoConfig: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  borrador: { label: \"Borrador\", variant: \"secondary\" },\n  en_deliberacion: { label: \"En Deliberación\", variant: \"default\" },\n  votacion: { label: \"En Votación\", variant: \"default\" },\n  aprobada: { label: \"Aprobada\", variant: \"default\" },\n  rechazada: { label: \"Rechazada\", variant: \"destructive\" },\n  archivada: { label: \"Archivada\", variant: \"outline\" },\n};\n\nexport default function PropuestaDetalle() {\n  const { id } = useParams();\n  const [, navigate] = useLocation();\n  const userId = localStorage.getItem(\"userId\");\n  const { toast } = useToast();\n  const [comentario, setComentario] = useState(\"\");\n  const [isDonateModalOpen, setIsDonateModalOpen] = useState(false);\n\n  const { data: user } = useQuery({\n    queryKey: [\"/api/users/me\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: tokensBalance } = useQuery({\n    queryKey: [\"/api/tokens\", userId],\n    enabled: !!userId,\n  });\n\n  const { data: propuesta, isLoading } = useQuery<PropuestaDetalle>({\n    queryKey: [\"/api/proposals\", id],\n    enabled: !!id,\n  });\n\n  const { data: comentarios = [] } = useQuery<ComentarioConAutor[]>({\n    queryKey: [\"/api/comments/proposal\", id],\n    enabled: !!id,\n  });\n\n  const hasEnoughTokens = tokensBalance && tokensBalance.tokensParticipacion >= 1;\n\n  const supportMutation = useMutation({\n    mutationFn: async () => {\n      if (!userId) {\n        throw new Error(\"Debes iniciar sesión para apoyar una propuesta\");\n      }\n      return apiRequest(\"POST\", `/api/proposals/${id}/support`, {\n        userId,\n        tipoToken: \"TP\",\n        cantidad: 1,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\", id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/tokens\", userId] });\n      toast({\n        title: \"¡Apoyo enviado!\",\n        description: \"Has apoyado esta propuesta con 1 Token de Participación\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: error.message || \"No se pudo enviar el apoyo\",\n      });\n    },\n  });\n\n  const addCommentMutation = useMutation({\n    mutationFn: async (contenido: string) => {\n      if (!userId) {\n        throw new Error(\"Debes iniciar sesión para comentar\");\n      }\n      return apiRequest(\"POST\", `/api/comments`, {\n        contenido,\n        autorId: userId,\n        propuestaId: id,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Comentario publicado\",\n        description: \"Tu comentario se ha agregado correctamente\",\n      });\n      setComentario(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/comments/proposal\", id] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/proposals\", id] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmitComment = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!comentario.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"El comentario no puede estar vacío\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    addCommentMutation.mutate(comentario);\n  };\n\n  const handleSupport = () => {\n    if (!userId) {\n      toast({\n        variant: \"destructive\",\n        title: \"Inicia sesión\",\n        description: \"Debes iniciar sesión para apoyar propuestas\",\n      });\n      return;\n    }\n    if (!hasEnoughTokens) {\n      toast({\n        variant: \"destructive\",\n        title: \"Tokens insuficientes\",\n        description: \"Necesitas al menos 1 Token de Participación para apoyar una propuesta\",\n      });\n      return;\n    }\n    supportMutation.mutate();\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} tokensBalance={tokensBalance} />\n        <main className=\"flex-1 flex items-center justify-center\">\n          <p className=\"text-muted-foreground\">Cargando propuesta...</p>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  if (!propuesta) {\n    return (\n      <div className=\"min-h-screen flex flex-col\">\n        <Navbar user={user} tokensBalance={tokensBalance} />\n        <main className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <h2 className=\"text-2xl font-bold mb-2\">Propuesta no encontrada</h2>\n            <p className=\"text-muted-foreground mb-4\">\n              La propuesta que buscas no existe o ha sido eliminada\n            </p>\n            <Link href=\"/propuestas\">\n              <Button data-testid=\"button-back-to-proposals\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Volver a Propuestas\n              </Button>\n            </Link>\n          </div>\n        </main>\n        <Footer />\n      </div>\n    );\n  }\n\n  const estadoInfo = estadoConfig[propuesta.estado] || estadoConfig.borrador;\n  const tiempoRelativo = propuesta.createdAt\n    ? formatDistanceToNow(new Date(propuesta.createdAt), { addSuffix: true, locale: es })\n    : \"\";\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      <Navbar user={user} tokensBalance={tokensBalance} />\n\n      <main className=\"flex-1 bg-background\">\n        <div className=\"max-w-5xl mx-auto px-4 md:px-6 lg:px-8 py-8\">\n          {/* Botón volver */}\n          <Link href=\"/propuestas\">\n            <Button variant=\"ghost\" className=\"mb-6\" data-testid=\"button-back\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Volver a Propuestas\n            </Button>\n          </Link>\n\n          {/* Contenido de la propuesta */}\n          <Card className=\"mb-8\">\n            <CardContent className=\"p-6\">\n              {/* Header */}\n              <div className=\"flex items-start justify-between mb-4 gap-4\">\n                <Badge variant=\"outline\" data-testid=\"badge-category\">\n                  {propuesta.categoria}\n                </Badge>\n                <Badge variant={estadoInfo.variant} data-testid=\"badge-status\">\n                  {estadoInfo.label}\n                </Badge>\n              </div>\n\n              {/* Título */}\n              <h1 className=\"text-3xl font-bold font-[Poppins] mb-4\" data-testid=\"text-proposal-title\">\n                {propuesta.titulo}\n              </h1>\n\n              {/* Metadatos */}\n              <div className=\"flex items-center gap-4 text-sm text-muted-foreground mb-6\">\n                <span>Por {propuesta.autorNombre}</span>\n                <span>•</span>\n                <span>{tiempoRelativo}</span>\n              </div>\n\n              <Separator className=\"mb-6\" />\n\n              {/* Descripción */}\n              <div className=\"prose prose-sm dark:prose-invert max-w-none mb-6\" data-testid=\"text-proposal-description\">\n                <p className=\"text-base whitespace-pre-wrap\">{propuesta.descripcion}</p>\n              </div>\n\n              <Separator className=\"mb-6\" />\n\n              {/* Estadísticas de apoyo */}\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center gap-6\">\n                  <div className=\"flex items-center gap-2\">\n                    <TrendingUp className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                    <span className=\"font-mono font-semibold text-lg\" data-testid=\"text-support-tp\">\n                      {propuesta.apoyosTP}\n                    </span>\n                    <span className=\"text-sm text-muted-foreground\">TP</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Coins className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                    <span className=\"font-mono font-semibold text-lg\" data-testid=\"text-support-ta\">\n                      {propuesta.apoyosTA}\n                    </span>\n                    <span className=\"text-sm text-muted-foreground\">TA</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <MessageSquare className=\"h-5 w-5\" />\n                    <span className=\"font-mono text-lg\" data-testid=\"text-comments-count\">\n                      {comentarios.length}\n                    </span>\n                  </div>\n                </div>\n              </div>\n\n              {/* Acciones */}\n              <div className=\"flex items-center gap-3\">\n                <Button\n                  variant=\"default\"\n                  onClick={handleSupport}\n                  disabled={supportMutation.isPending || !userId || !hasEnoughTokens}\n                  data-testid=\"button-support-proposal\"\n                  className=\"gap-2\"\n                >\n                  <ThumbsUp className=\"h-4 w-4\" />\n                  Apoyar con 1 TP\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setIsDonateModalOpen(true)}\n                  data-testid=\"button-donate-proposal\"\n                  className=\"gap-2\"\n                >\n                  <Heart className=\"h-4 w-4\" />\n                  Donar Tokens de Apoyo\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Sección de comentarios */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MessageSquare className=\"h-5 w-5\" />\n                Comentarios ({comentarios.length})\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {/* Formulario para nuevo comentario */}\n              {userId ? (\n                <form onSubmit={handleSubmitComment} className=\"space-y-4\">\n                  <Textarea\n                    placeholder=\"Escribe tu comentario...\"\n                    value={comentario}\n                    onChange={(e) => setComentario(e.target.value)}\n                    className=\"min-h-[100px]\"\n                    data-testid=\"textarea-comment\"\n                  />\n                  <div className=\"flex justify-end\">\n                    <Button \n                      type=\"submit\" \n                      disabled={addCommentMutation.isPending || !comentario.trim()}\n                      data-testid=\"button-submit-comment\"\n                    >\n                      <Send className=\"h-4 w-4 mr-2\" />\n                      {addCommentMutation.isPending ? \"Publicando...\" : \"Publicar Comentario\"}\n                    </Button>\n                  </div>\n                </form>\n              ) : (\n                <div className=\"text-center p-6 bg-muted rounded-lg\">\n                  <p className=\"text-muted-foreground mb-4\">\n                    Debes iniciar sesión para comentar en esta propuesta\n                  </p>\n                  <Link href=\"/login\">\n                    <Button>Iniciar Sesión</Button>\n                  </Link>\n                </div>\n              )}\n\n              <Separator />\n\n              {/* Lista de comentarios */}\n              <div className=\"space-y-6\">\n                {comentarios.length === 0 ? (\n                  <p className=\"text-center text-muted-foreground py-8\">\n                    No hay comentarios aún. ¡Sé el primero en comentar!\n                  </p>\n                ) : (\n                  comentarios.map((comentario) => (\n                    <div key={comentario.id} className=\"flex gap-4\" data-testid={`comment-${comentario.id}`}>\n                      <Avatar className=\"h-10 w-10 flex-shrink-0\">\n                        <AvatarFallback>\n                          {comentario.autorNombre?.charAt(0).toUpperCase() || \"U\"}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 space-y-2\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"font-semibold text-sm\">\n                            {comentario.autorNombre || \"Usuario\"}\n                          </span>\n                          <span className=\"text-xs text-muted-foreground\">\n                            {comentario.createdAt\n                              ? formatDistanceToNow(new Date(comentario.createdAt), {\n                                  addSuffix: true,\n                                  locale: es,\n                                })\n                              : \"\"}\n                          </span>\n                        </div>\n                        <p className=\"text-sm whitespace-pre-wrap\">{comentario.contenido}</p>\n                      </div>\n                    </div>\n                  ))\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </main>\n\n      <Footer />\n\n      {/* Modal de donación */}\n      <DonateModal\n        isOpen={isDonateModalOpen}\n        onClose={() => setIsDonateModalOpen(false)}\n        proposalId={id || \"\"}\n        proposalTitle={propuesta.titulo}\n      />\n    </div>\n  );\n}\n","size_bytes":14476}},"version":2}